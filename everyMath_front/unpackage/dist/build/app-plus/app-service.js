if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((o=>t.resolve(e()).then((()=>o))),(o=>t.resolve(e()).then((()=>{throw o}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...o){uni.__log__?uni.__log__(e,t,...o):console[e].apply(console,[...o,t])}function o(e,t){return"string"==typeof e?t:e}const a=((t,o=0)=>(o,a=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,o,a)})("onLoad",2),s=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}],n=(e,t)=>{const o=e.__vccOpts||e;for(const[a,s]of t)o[a]=s;return o},i={name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:s}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(e){this.$emit("click",e)}}};const r=n(i,[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(i.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+a.type,a.customPrefix,a.customPrefix?a.type:""]]),onClick:o[0]||(o[0]=(...e)=>i._onClick&&i._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-b25a9929"]]),c="/static/fox.png",l=()=>uni.getStorageSync("token")||"",u=()=>{try{const e=uni.getStorageSync("userData");return e?JSON.parse(e):null}catch(e){return t("error","at api/utils.js:38","获取用户信息失败:",e),null}},d=e=>{try{uni.setStorageSync("userData",JSON.stringify(e))}catch(o){t("error","at api/utils.js:51","保存用户信息失败:",o)}},p=()=>{const e=u();return e?e.id:null},h=()=>{uni.hideLoading()},m="https://qvpsztnvkjxe.sealoshzh.site/api",g="网络连接失败，请检查网络设置",f="请求超时，请稍后重试",v="服务器错误，请稍后重试",y="登录已过期，请重新登录",w="没有权限访问该资源",_="请求的资源不存在",k="请求参数错误",x="未知错误，请稍后重试",b=async(e,o={})=>{try{const t=l(),a=await uni.request({url:`${m}${e}`,method:o.method||"GET",data:o.data||{},header:{"Content-Type":"application/json",Accept:"application/json",...t&&{Authorization:`Bearer ${t}`},...o.header},timeout:1e4,...o});if(200===a.statusCode){const{data:e}=a;if(0===e.code)return e;throw new Error(e.message||x)}{const e=E(a.statusCode);throw new Error(e)}}catch(a){throw t("error","at api/index.js:58","API请求失败:",a),a.errMsg&&a.errMsg.includes("timeout")?new Error(f):a.errMsg&&a.errMsg.includes("fail")?new Error(g):a}},E=e=>{switch(e){case 400:return k;case 401:return y;case 403:return w;case 404:return _;case 500:return v;default:return x}},S=e=>b(`/questions/question-set/${e}`,{method:"GET"}),N=(e,o,a)=>(t("log","at api/index.js:357","uploadBase64File接口调用",{fileName:o,userId:a,contentLength:null==e?void 0:e.length}),b("/question-sets/upload-base64",{method:"POST",data:{fileContent:e,fileName:o,userId:a}})),C=(e,o)=>(t("log","at api/index.js:371","=== App端简化文件上传开始 ==="),t("log","at api/index.js:372","uploadFileInApp接口调用参数:",{filePath:e,userId:o}),new Promise(((a,s)=>{if(e.startsWith("content://")){t("log","at api/index.js:378","App端检测到Content URI，使用Base64上传方式:",e);try{const i=plus.android.runtimeMainActivity(),r=plus.android.importClass("android.net.Uri").parse(e);t("log","at api/index.js:387","App端URI解析成功");const c=i.getContentResolver();t("log","at api/index.js:391","App端获取ContentResolver成功");const l=plus.android.invoke(c,"openInputStream",r);if(!l)return void s(new Error("无法打开文件输入流"));t("log","at api/index.js:399","App端文件输入流打开成功");const u=plus.android.importClass("java.io.ByteArrayOutputStream"),d=plus.android.newObject("byte[]",1024),p=new u;let h=0;for(;-1!=(h=plus.android.invoke(l,"read",d));)plus.android.invoke(p,"write",d,0,h);plus.android.invoke(l,"close");const m=plus.android.invoke(p,"toByteArray");plus.android.invoke(p,"close"),t("log","at api/index.js:415","App端文件读取成功，字节长度:",m.length);const g=plus.android.importClass("android.util.Base64"),f=plus.android.invoke(g,"encodeToString",m,0);t("log","at api/index.js:421","App端Base64转换成功，长度:",f.length);let v="upload.csv";try{const e=plus.android.invoke(c,"query",r,null,null,null,null);if(e&&plus.android.invoke(e,"moveToFirst")){const t=plus.android.invoke(e,"getColumnIndex","_display_name");-1!==t&&(v=plus.android.invoke(e,"getString",t)),plus.android.invoke(e,"close")}}catch(n){t("warn","at api/index.js:435","App端获取文件名失败，使用默认名称:",n.message)}t("log","at api/index.js:438","App端文件名:",v),t("log","at api/index.js:439","App端开始Base64上传"),N(f,v,o).then(a).catch(s)}catch(n){t("error","at api/index.js:447","App端Content URI处理失败:",n),s(new Error("Content URI处理失败: "+n.message))}}else t("log","at api/index.js:452","App端普通文件路径，使用标准上传:",e),((e,o)=>(t("log","at api/index.js:317","uploadFile接口发生调用",e,o),new Promise(((t,a)=>{uni.uploadFile({url:`${m}/question-sets/upload-file`,filePath:e,name:"file",formData:{userId:o},header:{Authorization:`Bearer ${l()}`},success:e=>{try{const o=JSON.parse(e.data);0===o.code?t(o):a(new Error(o.message||"上传失败"))}catch(n){a(new Error("响应解析失败"))}},fail:e=>{a(new Error("文件上传失败"))}})}))))(e,o).then(a).catch(s)}))),T={__name:"login",setup(a){const s=e.ref(""),n=e.ref(""),i=e.ref(!1),l=e.ref(!1),u=()=>{i.value=!0},d=()=>{i.value=!1},p=()=>{l.value=!l.value},m=async()=>{var e;if(s.value&&n.value)try{((e="加载中...")=>{uni.showLoading({title:e,mask:!0})})("登录中...");const o=await(e={username:s.value,password:n.value},b("/users/login",{method:"POST",data:e}));if(h(),0===o.code){if(t("log","at pages/login/login.vue:152","登录成功，响应数据:",o),o.data&&o.data.user)t("log","at pages/login/login.vue:156","保存后端返回的用户数据:",o.data.user),uni.setStorageSync("userData",JSON.stringify(o.data.user));else{const e={id:Date.now(),username:s.value,grade:"3"};t("log","at pages/login/login.vue:165","创建默认用户数据:",e),uni.setStorageSync("userData",JSON.stringify(e))}o.data&&o.data.token&&uni.setStorageSync("token",o.data.token);t("log","at pages/login/login.vue:176","验证保存的用户数据:",uni.getStorageSync("userData")),uni.showToast({title:"登录成功",icon:"success"}),t("log","at pages/login/login.vue:182","登录成功"),setTimeout((()=>{t("log","at pages/login/login.vue:186","开始跳转到首页"),uni.redirectTo({url:"/pages/home/home",success:e=>{t("log","at pages/login/login.vue:190","跳转成功:",e)},fail:e=>{t("error","at pages/login/login.vue:193","跳转失败:",e),uni.navigateTo({url:"/pages/home/home"})}})}),1e3),t("log","at pages/login/login.vue:202","跳转指令已发出")}else uni.showToast({title:o.message||"登录失败",icon:"none"})}catch(o){h(),t("error","at pages/login/login.vue:211","登录失败:",o),uni.showToast({title:o.message||"登录失败，请稍后重试",icon:"none"})}else uni.showToast({title:"请输入用户名和密码",icon:"none"})},g=()=>{uni.navigateTo({url:"/pages/register/register"})};return(t,a)=>{const h=o(e.resolveDynamicComponent("uni-icons"),r);return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"bg-elements top"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"+"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"-"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"×"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"÷"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"+")]),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"title-decoration"},[e.createElementVNode("view",{class:"title-circle left"}),e.createElementVNode("view",{class:"title-circle right"})]),e.createElementVNode("view",{class:"header-text"},[e.createElementVNode("text",{class:"title"},[e.createElementVNode("span",{class:"title-char"},"天"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.2s"}},"天"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.4s"}},"口"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.6s"}},"算")]),e.createElementVNode("image",{src:"/static/fox_header.png",mode:"widthFix",class:"fox-header"}),e.createElementVNode("text",{class:"subtitle"},"加减乘除乐无限，数学天地任我闯！"),e.createElementVNode("text",{class:"subtitle"},"天天口算，欢迎超级小英雄！")])]),e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("image",{class:e.normalizeClass(["fox-image",{show:i.value}]),src:c,mode:"widthFix"},null,2),e.createElementVNode("view",{class:"login-form"},[e.createElementVNode("view",{class:"input-group"},[e.createVNode(h,{type:"person-filled",size:"22",color:"#1e40af",class:"input-icon"}),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text",placeholder:"请输入用户名","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),onFocus:u,onBlur:d},null,544),[[e.vModelText,s.value]])]),e.createElementVNode("view",{class:"input-group"},[e.createVNode(h,{type:"locked-filled",size:"22",color:"#1e40af",class:"input-icon"}),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:l.value?"text":"password",placeholder:"请输入密码","onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),onFocus:u,onBlur:d},null,40,["type"]),[[e.vModelDynamic,n.value]]),e.withDirectives(e.createVNode(h,{type:l.value?"eye-slash-filled":"eye-filled",size:"20",color:"#94a3b8",class:"password-toggle-icon",onClick:p},null,8,["type"]),[[e.vShow,n.value.length>0]])]),e.createElementVNode("button",{class:e.normalizeClass(["login-btn",{active:s.value&&n.value}]),onClick:m,disabled:!s.value||!n.value}," 登录 ",10,["disabled"]),e.createElementVNode("text",{class:"register-link",onClick:g}," 还没有账号？注册 ")])]),e.createElementVNode("view",{class:"bottom-elements"},[e.createElementVNode("view",{class:"wave-animation"}),e.createElementVNode("view",{class:"floating-numbers"},[e.createElementVNode("span",{class:"number",style:{top:"10%",left:"10%",fontSize:"60px",animationDelay:"0s"}},"1"),e.createElementVNode("span",{class:"number",style:{top:"30%",left:"30%",fontSize:"40px",animationDelay:"0.3s"}},"2"),e.createElementVNode("span",{class:"number",style:{top:"10%",left:"50%",fontSize:"50px",animationDelay:"0.6s"}},"3"),e.createElementVNode("span",{class:"number",style:{top:"20%",left:"70%",fontSize:"55px",animationDelay:"0.9s"}},"4"),e.createElementVNode("span",{class:"number",style:{top:"50%",left:"90%",fontSize:"26px",animationDelay:"1.2s"}},"5"),e.createElementVNode("span",{class:"number",style:{top:"50%",left:"20%",fontSize:"45px",animationDelay:"1.5s"}},"6"),e.createElementVNode("span",{class:"number",style:{top:"40%",left:"80%",fontSize:"35px",animationDelay:"1.8s"}},"7")])])])}}},V={__name:"register",setup(o){const a=e.ref(""),s=e.ref(""),n=e.ref(""),i=e.ref(-1),l=e.ref(""),u=e.ref(["1年级","2年级","3年级","4年级","5年级","6年级"]),d=e.ref(!1),p=e.ref(!1),h=e.ref(!1),m=e.ref(!1),g=e=>{i.value=e.detail.value,l.value=u.value[i.value]},f=()=>{p.value=!p.value},v=()=>{h.value=!h.value},y=e.computed((()=>!!(a.value.trim()&&s.value.trim()&&n.value.trim())&&(!!l.value&&s.value===n.value))),w=e=>{d.value=e},_=()=>{uni.hideLoading()},k=async()=>{if(y.value){m.value=!0;try{((e="加载中...")=>{uni.showLoading({title:e,mask:!0})})("注册中...");const t=i.value+1,o=await(e={username:a.value,password:s.value,grade:t},b("/users/register",{method:"POST",data:e}));_(),0===o.code?(uni.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>x()),1500)):uni.showToast({title:o.message||"注册失败",icon:"none"})}catch(o){_(),t("error","at pages/register/register.vue:239","注册失败:",o),uni.showToast({title:o.message||"注册失败，请稍后重试",icon:"none"})}finally{m.value=!1}var e}else uni.showToast({title:"请填写所有必填项",icon:"none"})},x=()=>{uni.redirectTo({url:"/pages/login/login"})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"10%",left:"8%",animationDelay:"0s"}},"+"),e.createElementVNode("view",{class:"math-symbol",style:{top:"60%",left:"15%",animationDelay:"0.8s"}},"-"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"85%",animationDelay:"1.2s"}},"×")]),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"header-text"},[e.createElementVNode("text",{class:"title"},[e.createElementVNode("span",{class:"title-char"},"注"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.2s"}},"册"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.4s"}},"账"),e.createElementVNode("span",{class:"title-char",style:{animationDelay:"0.6s"}},"号")])])]),e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("image",{class:e.normalizeClass(["fox-image",{show:d.value}]),src:c,mode:"widthFix"},null,2),e.createElementVNode("view",{class:"register-form"},[e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"年级选择"),e.createElementVNode("view",{class:"input-group grade-select-group"},[e.createElementVNode("picker",{class:"picker-select",mode:"selector",range:u.value,value:i.value,onChange:g},[e.createElementVNode("text",{class:"select-text"},e.toDisplayString(l.value||"请选择年级"),1)],40,["range","value"])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"用户名"),e.createElementVNode("view",{class:"input-group"},[e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text",placeholder:"请设置登录用户名","onUpdate:modelValue":o[0]||(o[0]=e=>a.value=e),onFocus:o[1]||(o[1]=e=>w(!0)),onBlur:o[2]||(o[2]=e=>w(!1))},null,544),[[e.vModelText,a.value]])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"密码"),e.createElementVNode("view",{class:"input-group password-group"},[e.withDirectives(e.createElementVNode("input",{class:"input-field",type:p.value?"text":"password",placeholder:"请设置登录密码","onUpdate:modelValue":o[3]||(o[3]=e=>s.value=e),onFocus:o[4]||(o[4]=e=>w(!0)),onBlur:o[5]||(o[5]=e=>w(!1))},null,40,["type"]),[[e.vModelDynamic,s.value]]),e.createElementVNode("view",{class:"password-toggle",onClick:f},[e.createVNode(r,{type:p.value?"eye-slash":"eye",size:"20",color:p.value?"#3b82f6":"#94a3b8"},null,8,["type","color"])])])]),e.createElementVNode("view",{class:"form-group"},[e.createElementVNode("text",{class:"form-label"},"确认密码"),e.createElementVNode("view",{class:"input-group password-group"},[e.withDirectives(e.createElementVNode("input",{class:"input-field",type:h.value?"text":"password",placeholder:"请再次输入密码","onUpdate:modelValue":o[6]||(o[6]=e=>n.value=e),onFocus:o[7]||(o[7]=e=>w(!0)),onBlur:o[8]||(o[8]=e=>w(!1))},null,40,["type"]),[[e.vModelDynamic,n.value]]),e.createElementVNode("view",{class:"password-toggle",onClick:v},[e.createVNode(r,{type:h.value?"eye-slash":"eye",size:"20",color:h.value?"#3b82f6":"#94a3b8"},null,8,["type","color"])])])]),e.createElementVNode("button",{class:e.normalizeClass(["register-btn",{active:y.value&&!m.value}]),onClick:k,disabled:!y.value||m.value},e.toDisplayString(m.value?"注册中...":"注册"),11,["disabled"]),e.createElementVNode("text",{class:"login-link",onClick:x}," 已有账号？登录 ")])]),e.createElementVNode("view",{class:"bottom-elements"},[e.createElementVNode("view",{class:"wave-animation"}),e.createElementVNode("view",{class:"floating-numbers"},[e.createElementVNode("span",{class:"number",style:{top:"20%",left:"15%",fontSize:"22px"}},"1"),e.createElementVNode("span",{class:"number",style:{top:"40%",left:"40%",fontSize:"26px"}},"2")])])]))}};class I{constructor(e,t){this.options=e,this.animation=uni.createAnimation({...e}),this.currentStepAnimates={},this.next=0,this.$=t}_nvuePushAnimates(e,t){let o=this.currentStepAnimates[this.next],a={};if(a=o||{styles:{},config:{}},A.includes(e)){a.styles.transform||(a.styles.transform="");let o="";"rotate"===e&&(o="deg"),a.styles.transform+=`${e}(${t+o}) `}else a.styles[e]=`${t}`;this.currentStepAnimates[this.next]=a}_animateRun(e={},t={}){let o=this.$.$refs.ani.ref;if(o)return new Promise(((a,s)=>{nvueAnimation.transition(o,{styles:e,...t},(e=>{a()}))}))}_nvueNextAnimate(e,t=0,o){let a=e[t];if(a){let{styles:s,config:n}=a;this._animateRun(s,n).then((()=>{t+=1,this._nvueNextAnimate(e,t,o)}))}else this.currentStepAnimates={},"function"==typeof o&&o(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const A=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function D(e,t){if(t)return clearTimeout(t.timer),new I(e,t)}A.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{I.prototype[e]=function(...t){return this.animation[e](...t),this}}));const P=n({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:0,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let o in e){t+=this.toLine(o)+":"+e[o]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=D(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){return this.animation?(Object.keys(e).forEach((t=>{const o=e[t];"function"==typeof this.animation[t]&&(Array.isArray(o)?this.animation[t](...o):this.animation[t](o))})),this.animation.step(t),this):this},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.isShow=!0,this.transform=this.styleInit(!1).transform||"",this.opacity=this.styleInit(!1).opacity||0,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=D(this.config,this),this.tranfromInit(!1).step(),this.animation.run((()=>{this.transform="",this.opacity=this.styleInit(!1).opacity||1,this.$emit("change",{detail:this.isShow})}))}),80)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:"",opacity:1};const o=(e,o)=>{const a=this.animationType(e)[o];o.startsWith("fade")?t.opacity=a:t.transform+=a+" "};return"string"==typeof this.modeClass?o(e,this.modeClass):this.modeClass.forEach((t=>o(e,t))),t},tranfromInit(e){let t=(e,t)=>{let o=null;"fade"===t?o=e?0:1:(o=e?"-100%":"0","zoom-in"===t&&(o=e?.8:1),"zoom-out"===t&&(o=e?1.2:1),"slide-right"===t&&(o=e?"100%":"0"),"slide-bottom"===t&&(o=e?"100%":"0")),this.animation[this.animationMode()[t]](o)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((o=>{t(e,o)})),this.animation},animationType:e=>({fade:e?1:0,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,o,a,s,n,i){return e.withDirectives((e.openBlock(),e.createElementBlock("view",{ref:"ani",animation:n.animationData,class:e.normalizeClass(a.customClass),style:e.normalizeStyle(i.transformStyles),onClick:o[0]||(o[0]=(...e)=>i.onClick&&i.onClick(...e))},[e.renderSlot(t.$slots,"default")],14,["animation"])),[[e.vShow,n.isShow]])}]]),L={name:"uniPopup",components:{},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let e={backgroundColor:this.bg};return this.borderRadius,e=Object.assign(e,{borderRadius:this.borderRadius}),e},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:o,safeArea:a,screenHeight:s,safeAreaInsets:n}=uni.getSystemInfoSync();this.popupWidth=e,this.popupHeight=t+(o||0),a&&this.safeArea?this.safeAreaInsets=n.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(e=!0){},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):t("error","at uni_modules/uni-popup/components/uni-popup/uni-popup.vue:310","缺少类型：",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.showPoptrans(),this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||this.showPoptrans()},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},e||this.showPoptrans()},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||this.showPoptrans()},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||this.showPoptrans()},showPoptrans(){this.$nextTick((()=>{this.showPopup=!0,this.showTrans=!0}))}}};const O=n(L,[["render",function(t,a,s,n,i,r){const c=o(e.resolveDynamicComponent("uni-transition"),P);return i.showPopup?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uni-popup",[i.popupstyle,r.isDesktop?"fixforpc-z-index":""]])},[e.createElementVNode("view",{onTouchstart:a[1]||(a[1]=(...e)=>r.touchstart&&r.touchstart(...e))},[i.maskShow?(e.openBlock(),e.createBlock(c,{key:"1",name:"mask","mode-class":"fade",styles:i.maskClass,duration:i.duration,show:i.showTrans,onClick:r.onTap},null,8,["styles","duration","show","onClick"])):e.createCommentVNode("",!0),e.createVNode(c,{key:"2","mode-class":i.ani,name:"content",styles:i.transClass,duration:i.duration,show:i.showTrans,onClick:r.onTap},{default:e.withCtx((()=>[e.createElementVNode("view",{class:e.normalizeClass(["uni-popup__wrapper",[i.popupstyle]]),style:e.normalizeStyle(r.getStyles),onClick:a[0]||(a[0]=(...e)=>r.clear&&r.clear(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)])),_:3},8,["mode-class","styles","duration","show","onClick"])],32)],2)):e.createCommentVNode("",!0)}],["__scopeId","data-v-73d3b141"]]),B=n({__name:"practice-exercise",props:{questionExpressions:{type:Array,required:!0,default:()=>[]},timeLimit:{type:Number,required:!0,default:300}},emits:["complete","exit"],setup(o,{expose:a,emit:s}){const n=o,i=s,r=e.ref([]),c=e.ref(0),l=e.ref(!1),u=e.ref(n.timeLimit),d=e.ref("forward"),h=e.ref(null),m=e.ref(null),g=e.ref(!1),f=()=>{r.value=n.questionExpressions.map(((e,t)=>{const o=v(e),a=y(o);_(a);const s=a.indexOf(o);return{id:t+1,question:e,options:a,correctAnswer:s,userAnswer:-1,answered:!1}})),c.value=0,u.value=n.timeLimit},v=e=>{try{const t=e.replace(/×/g,"*").replace(/÷/g,"/").replace(/（/g,"(").replace(/）/g,")");return Function(`"use strict"; return (${t})`)()}catch(o){return t("error","at components/practice-exercise.vue:190","表达式计算错误:",e,o),0}},y=e=>{const t=[e];for(;t.length<4;){const o=w(1,5),a=e+(Math.random()>.5?1:-1)*o;a>0&&!t.includes(a)&&t.push(a)}return t},w=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,_=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}},k=async e=>{try{if(!m.value)return void t("warn","at components/practice-exercise.vue:232","用户ID未找到，无法保存错题记录");const o={userId:m.value,question:e.question,correctAnswer:e.options[e.correctAnswer].toString(),corrected:"0"};t("log","at components/practice-exercise.vue:243","保存错题记录:",o),await(e=>b("/mistake-records",{method:"POST",data:e}))(o),t("log","at components/practice-exercise.vue:245","错题记录保存成功")}catch(o){t("error","at components/practice-exercise.vue:247","保存错题记录失败:",o)}},x=e.computed((()=>r.value[c.value]||{})),E=e.computed((()=>r.value.length)),S=e.computed({get:()=>x.value.userAnswer,set:e=>{x.value&&(x.value.userAnswer=e)}}),N=e.computed({get:()=>x.value.answered||!1,set:e=>{x.value&&(x.value.answered=e)}}),C=e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},T=()=>{c.value>0&&(d.value="backward",c.value--,l.value=!0)},V=()=>{N.value&&c.value<r.value.length-1?(d.value="forward",c.value++,l.value=!1):N.value&&c.value===r.value.length-1&&I()},I=()=>{const e=r.value.length;let t=0;r.value.forEach((e=>{e.userAnswer===e.correctAnswer&&t++}));const o={totalQuestions:e,correctCount:t,startTime:h.value||(new Date).toISOString(),timeSpent:C(n.timeLimit-u.value),timeLimit:C(n.timeLimit),timeLimitSeconds:n.timeLimit,timeSpentSeconds:n.timeLimit-u.value,questions:r.value};i("complete",o)};let A=null;const D=()=>{A&&(clearInterval(A),A=null)},P=()=>{t("log","at components/practice-exercise.vue:368","用户确认超时，返回主页"),g.value=!1,i("exit",{reason:"timeout",message:"练习时间已结束"})};return e.watch((()=>n.questionExpressions),(()=>{f()}),{immediate:!0}),e.watch((()=>n.timeLimit),(e=>{u.value=e})),e.onMounted((()=>{h.value=(new Date).toISOString();try{m.value=p(),t("log","at components/practice-exercise.vue:392","获取到用户ID:",m.value)}catch(e){t("error","at components/practice-exercise.vue:394","获取用户ID失败:",e)}f(),A=setInterval((()=>{u.value>0?u.value--:0!==u.value||g.value||(t("log","at components/practice-exercise.vue:352","练习时间到，显示超时弹窗"),g.value=!0,D())}),1e3)})),e.onUnmounted((()=>{D()})),a({resetPractice:f,getCurrentProgress:()=>({current:c.value+1,total:E.value,timeRemaining:u.value})}),(o,a)=>(e.openBlock(),e.createElementBlock("view",{class:"practice-container"},[e.createElementVNode("view",{class:"progress-timer-bar"},[e.createElementVNode("view",{class:"progress-container"},[e.createElementVNode("text",{class:"progress-text"},"第 "+e.toDisplayString(c.value+1)+" / "+e.toDisplayString(E.value)+" 题",1),e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:(c.value+1)/E.value*100+"%"})},null,4)])]),e.createElementVNode("view",{class:"timer"},[e.createElementVNode("view",{class:"timer-icon"},"⏱"),e.createElementVNode("text",{class:"timer-text"},e.toDisplayString(C(u.value)),1)])]),e.createElementVNode("view",{class:"animation-viewport"},[e.createVNode(e.Transition,{name:"slide"},{default:e.withCtx((()=>[(e.openBlock(),e.createElementBlock("view",{class:"question-options-group",key:c.value,"data-direction":d.value},[e.createElementVNode("view",{class:"question-card"},[e.createElementVNode("view",{class:"question-header"},[e.createElementVNode("text",{class:"question-tag"},"题目")]),e.createElementVNode("view",{class:"question-content"},[e.createElementVNode("text",{class:"question-text"},e.toDisplayString(x.value.question),1)])]),e.createElementVNode("view",{class:"options-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value.options,((o,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["option-item",{selected:S.value===a,correct:N.value&&a===x.value.correctAnswer,incorrect:N.value&&S.value===a&&a!==x.value.correctAnswer}]),onClick:e=>(async e=>{if(!N.value){S.value=e,N.value=!0,l.value=!1;const o=x.value;o&&e!==o.correctAnswer&&(t("log","at components/practice-exercise.vue:291","答案错误，保存错题记录..."),await k(o))}})(a),disabled:N.value||l.value,style:e.normalizeStyle({animationDelay:80*a+"ms"})},[e.createElementVNode("view",{class:"option-marker"},e.toDisplayString(String.fromCharCode(65+a)),1),e.createElementVNode("text",{class:"option-text"},e.toDisplayString(o),1),N.value&&a===x.value.correctAnswer?(e.openBlock(),e.createElementBlock("view",{key:0,class:"option-feedback"},"✓")):e.createCommentVNode("",!0),N.value&&S.value===a&&a!==x.value.correctAnswer?(e.openBlock(),e.createElementBlock("view",{key:1,class:"option-feedback incorrect"},"✗")):e.createCommentVNode("",!0)],14,["onClick","disabled"])))),128))])],8,["data-direction"]))])),_:1})]),e.createElementVNode("view",{class:"bottom-nav"},[e.createElementVNode("button",{class:"nav-btn prev-btn",onClick:T,disabled:0===c.value},[e.createElementVNode("view",{class:"nav-icon"},"←"),e.createElementVNode("text",{class:"nav-text"},"上一题")],8,["disabled"]),e.createElementVNode("button",{class:"nav-btn next-btn",onClick:V,disabled:!N.value},[e.createElementVNode("text",{class:"nav-text"},e.toDisplayString(c.value===E.value-1?"完成练习":"下一题"),1),c.value<E.value-1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"nav-icon"},"→")):e.createCommentVNode("",!0)],8,["disabled"])]),e.createElementVNode("view",{class:"decor decor-1"}),e.createElementVNode("view",{class:"decor decor-2"}),e.createElementVNode("view",{class:"decor decor-3"}),g.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"timeout-modal"},[e.createElementVNode("view",{class:"timeout-content"},[e.createElementVNode("view",{class:"timeout-icon"},"⏰"),e.createElementVNode("text",{class:"timeout-title"},"时间到了！"),e.createElementVNode("text",{class:"timeout-message"},"练习时间已结束，请返回主页重新开始"),e.createElementVNode("button",{class:"timeout-btn",onClick:P},"返回主页")])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-9c3cf8f5"]]),M=n({__name:"practice",setup(s){const n=e.ref({grade:1,questionCount:10,timeLimit:180});t("log","at pages/practice/practice.vue:162","初始化练习设置:",n.value);const i=e.ref([]),c=e.ref(null),l=e.ref(null),u=e.ref(null),d=e.ref(null),p=e.ref([{label:"一年级",value:1},{label:"二年级",value:2},{label:"三年级",value:3},{label:"四年级",value:4},{label:"五年级",value:5},{label:"六年级",value:6}]),h=e.ref([5,10,15,20,25,30]),m=e.ref(Array.from({length:16},((e,t)=>t))),g=e.ref(Array.from({length:60},((e,t)=>t)));a((e=>{t("log","at pages/practice/practice.vue:192","页面加载参数:",e);const o=(()=>{try{const e=uni.getStorageSync("userData");if(t("log","at pages/practice/practice.vue:132","原始用户数据字符串:",e),e){const o=JSON.parse(e);if(t("log","at pages/practice/practice.vue:136","解析后的用户数据:",o),o&&o.grade){const e=parseInt(o.grade)||1;return t("log","at pages/practice/practice.vue:140","解析的年级:",o.grade,"-> ",e),e}t("log","at pages/practice/practice.vue:143","用户数据中没有年级信息")}else t("log","at pages/practice/practice.vue:146","本地存储中没有用户数据")}catch(e){t("error","at pages/practice/practice.vue:149","获取用户年级失败:",e)}return t("log","at pages/practice/practice.vue:151","使用默认年级: 1"),1})();if(t("log","at pages/practice/practice.vue:196","页面加载时的用户年级:",o),n.value.grade=o,t("log","at pages/practice/practice.vue:200","设置默认年级后的练习设置:",n.value),e&&"true"===e.fromImport){const e=uni.getStorageSync("practiceQuestions"),a=uni.getStorageSync("practiceTitle"),s=uni.getStorageSync("practiceTimeLimit")||300;e&&e.length>0?(i.value=e.map((e=>e.question||e)),n.value={grade:o,questionCount:e.length,timeLimit:s},t("log","at pages/practice/practice.vue:216","导入练习设置:",n.value),a&&t("log","at pages/practice/practice.vue:220","练习标题：",a)):(uni.showToast({title:"题目数据加载失败",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500))}else if(e&&Object.keys(e).length>0){const a=parseInt(e.grade)||o,s=parseInt(e.questionCount)||10,i=parseInt(e.timeLimit)||180;n.value={grade:a,questionCount:s,timeLimit:i},t("log","at pages/practice/practice.vue:238","URL参数练习设置:",n.value),f()}else t("log","at pages/practice/practice.vue:244","无参数时的练习设置:",n.value),f()}));const f=()=>{const{grade:e,questionCount:o}=n.value;let a,s;switch(t("log","at pages/practice/practice.vue:252","生成题目 - 使用年级:",e,"题目数量:",o),i.value=[],e){case 1:a={min:1,max:10},s=["+"];break;case 2:a={min:1,max:20},s=["+","-"];break;case 3:default:a={min:1,max:100},s=["+","-","×"];break;case 4:a={min:1,max:100},s=["+","-","×","÷"];break;case 5:a={min:1,max:1e3},s=["+","-","×","÷"];break;case 6:a={min:1,max:1e4},s=["+","-","×","÷"]}for(let t=0;t<o;t++){const t=v(a,s,e);i.value.push(t)}},v=(e,t,o)=>{const a=y(o);let s;switch(a[Math.floor(Math.random()*a.length)]){case"simple":default:s=w(e,t,o);break;case"bracket":s=_(e,t,o);break;case"multi_step":s=k(e,t,o);break;case"mixed":s=x(e,t,o)}return s},y=e=>{switch(e){case 1:case 2:return["simple"];case 3:default:return["simple","bracket"];case 4:return["simple","bracket","multi_step"];case 5:case 6:return["simple","bracket","multi_step","mixed"]}},w=(e,t,o=3)=>{let a;switch(t[Math.floor(Math.random()*t.length)]){case"+":a=`${E(e.min,e.max)} + ${E(e.min,e.max)}`;break;case"-":const t=E(e.min,e.max);a=`${t} - ${E(e.min,t)}`;break;case"×":let s;s=o<=3?9:o<=4?12:Math.min(20,Math.floor(e.max/10));a=`${E(1,s)} × ${E(1,s)}`;break;case"÷":let n;n=o<=4?9:o<=5?12:Math.min(20,Math.floor(e.max/10));let i=E(2,n);a=`${i*E(1,Math.min(n,Math.floor(e.max/i)))} ÷ ${i}`;break;default:a=`${E(e.min,e.max)} + ${E(e.min,e.max)}`}return a},_=(e,t,o)=>{const a=["addition_in_bracket","subtraction_in_bracket","multiplication_first","division_first"],s=a[Math.floor(Math.random()*a.length)];let n;const i=Math.min(e.max,o<=4?50:100);switch(s){case"addition_in_bracket":n=`(${E(1,i/5)} + ${E(1,i/5)}) × ${E(2,5)}`;break;case"subtraction_in_bracket":const o=E(10,i/3);n=`(${o} - ${E(1,o-1)}) × ${E(2,5)}`;break;case"multiplication_first":n=`${E(2,8)} × (${E(1,i/10)} + ${E(1,i/10)})`;break;case"division_first":const a=E(2,6),s=E(1,8),r=E(1,8);n=`${a*(s+r)} ÷ (${s} + ${r})`;break;default:return w(e,t)}return n},k=(e,t,o)=>{const a=["three_numbers","mixed_operations","division_addition","complex_bracket"],s=a[Math.floor(Math.random()*a.length)];let n;const i=Math.min(e.max,o<=4?30:80);switch(s){case"three_numbers":const o=E(10,i),a=E(1,i/2);n=`${o} + ${a} - ${E(1,Math.min(a,i/3))}`;break;case"mixed_operations":n=`${E(2,8)} × ${E(2,8)} + ${E(1,i/4)}`;break;case"division_addition":const s=E(2,6);n=`${s*E(3,10)} ÷ ${s} + ${E(1,i/4)}`;break;case"complex_bracket":n=`(${E(1,10)} + ${E(1,10)}) × ${E(2,5)} - ${E(1,15)}`;break;default:return w(e,t)}return n},x=(e,t,o)=>{const a=["fraction_like","bracket_mixed","double_bracket","chain_operations"];let s;switch(a[Math.floor(Math.random()*a.length)]){case"fraction_like":const a=E(10,50),n=E(2,6);s=`${a} + ${n*E(2,8)} ÷ ${n}`;break;case"bracket_mixed":s=`${E(15,30)} - (${E(1,5)} + ${E(1,5)}) × ${E(2,4)}`;break;case"double_bracket":const i=E(8,20),r=E(1,i/2),c=E(4,10);s=`(${i} + ${r}) ÷ (${c} - ${E(1,c-1)})`;break;case"chain_operations":s=`${E(2,5)} × ${E(2,5)} + ${E(2,6)} × ${E(2,6)}`;break;default:return _(e,t,o)}return s},b=e=>{const t={...e,grade:n.value.grade};uni.redirectTo({url:`/pages/result/result?data=${encodeURIComponent(JSON.stringify(t))}`})},E=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,S=e=>{t("log","at pages/practice/practice.vue:584","练习退出事件:",e),e&&"timeout"===e.reason&&(t("log","at pages/practice/practice.vue:587","练习超时，返回主页"),uni.showToast({title:e.message||"练习时间已结束",icon:"none",duration:2e3})),uni.reLaunch({url:"/pages/home/home"})};return(t,a)=>{const s=o(e.resolveDynamicComponent("uni-icons"),r),f=o(e.resolveDynamicComponent("uni-popup"),O);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"navbar"},[e.createVNode(s,{type:"back",size:"24",color:"#1E90FF",onClick:S,class:"back-home-icon"}),e.createElementVNode("text",{class:"navbar-title"},"口算练习")]),i.value.length>0?(e.openBlock(),e.createBlock(B,{key:0,"question-expressions":i.value,"time-limit":n.value.timeLimit,onComplete:b,onExit:S},null,8,["question-expressions","time-limit"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-container"},[e.createElementVNode("text",{class:"loading-text"},"正在生成题目...")]))]),e.createVNode(f,{ref_key:"gradePopup",ref:c,type:"bottom"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择年级"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:t.closeGradePopup,class:"close-icon"},null,8,["onClick"])]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((o,a)=>{var s;return e.openBlock(),e.createElementBlock("view",{key:o.value,class:e.normalizeClass(["option-item",{selected:a===(null==(s=t.practiceSetupRef)?void 0:s.selectedGradeIndex)}]),onClick:e=>t.selectGrade(a)},e.toDisplayString(o.label),11,["onClick"])})),128))]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"confirm-btn",onClick:a[0]||(a[0]=(...e)=>t.closeGradePopup&&t.closeGradePopup(...e))},"确定")])])])),_:1},512),e.createVNode(f,{ref_key:"questionCountPopup",ref:l,type:"bottom"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择题目数量"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:t.closeQuestionCountPopup,class:"close-icon"},null,8,["onClick"])]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((o,a)=>{var s;return e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["option-item",{selected:a===(null==(s=t.practiceSetupRef)?void 0:s.selectedQuestionCountIndex)}]),onClick:e=>t.selectQuestionCount(a)},e.toDisplayString(o)+" 题 ",11,["onClick"])})),128))]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"confirm-btn",onClick:a[1]||(a[1]=(...e)=>t.closeQuestionCountPopup&&t.closeQuestionCountPopup(...e))},"确定")])])])),_:1},512),e.createVNode(f,{ref_key:"minutesPopup",ref:u,type:"bottom"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择分钟数"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:t.closeMinutesPopup,class:"close-icon"},null,8,["onClick"])]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,((o,a)=>{var s;return e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["option-item",{selected:a===(null==(s=t.practiceSetupRef)?void 0:s.selectedMinutesIndex)}]),onClick:e=>t.selectMinutes(a)},e.toDisplayString(o)+" 分 ",11,["onClick"])})),128))]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"confirm-btn",onClick:a[2]||(a[2]=(...e)=>t.closeMinutesPopup&&t.closeMinutesPopup(...e))},"确定")])])])),_:1},512),e.createVNode(f,{ref_key:"secondsPopup",ref:d,type:"bottom"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择秒数"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:t.closeSecondsPopup,class:"close-icon"},null,8,["onClick"])]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,((o,a)=>{var s;return e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["option-item",{selected:a===(null==(s=t.practiceSetupRef)?void 0:s.selectedSecondsIndex)}]),onClick:e=>t.selectSeconds(a)},e.toDisplayString(o)+" 秒 ",11,["onClick"])})),128))]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"confirm-btn",onClick:a[3]||(a[3]=(...e)=>t.closeSecondsPopup&&t.closeSecondsPopup(...e))},"确定")])])])),_:1},512)],64)}}},[["__scopeId","data-v-b4321ff8"]]),$=n({__name:"buttom-nav",props:{navList:{type:Array,default:()=>[{text:"首页",icon:"home",selectedIcon:"home-filled",path:"/pages/home/home"},{text:"练习",icon:"compose",selectedIcon:"compose",path:"/pages/practice/practice"},{text:"我的",icon:"contact",selectedIcon:"contact-filled",path:"/pages/profile/profile"}]},activeColor:{type:String,default:"#4299e1"},defaultColor:{type:String,default:"#999"}},emits:["show-practice-setup"],setup(t,{emit:a}){const s=t,n=a,i=e.ref([...s.navList]),c=()=>{const e=l();i.value=i.value.map((t=>({...t,selected:e.includes(t.path)})))},l=()=>{const e=getCurrentPages();if(e.length>0){const t=e[e.length-1].route||e[e.length-1].__route__||"";if(t)return"/"+t}return""},u=()=>{setTimeout((()=>{c()}),50)};return e.onMounted((()=>{c(),uni.$on("onShow",u)})),e.onUnmounted((()=>{uni.$off("onShow",u)})),(a,s)=>{const c=o(e.resolveDynamicComponent("uni-icons"),r);return e.openBlock(),e.createElementBlock("view",{class:"bottom-nav"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((o,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,onClick:e=>{return t=o.path,void("练习"!==o.text?uni.redirectTo({url:t}):n("show-practice-setup"));var t},class:e.normalizeClass(["nav-item",{"center-item":"练习"===o.text}])},["练习"===o.text?(e.openBlock(),e.createElementBlock("view",{key:0,class:"center-button",style:e.normalizeStyle({backgroundColor:o.selected?t.activeColor:"#4299e1"})},[e.createVNode(c,{type:o.selected?o.selectedIcon:o.icon,size:"32",color:"#fff"},null,8,["type"])],4)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"normal-item"},[e.createVNode(c,{type:o.selected?o.selectedIcon:o.icon,size:22,color:o.selected?t.activeColor:t.defaultColor},null,8,["type","color"]),e.createElementVNode("text",{class:"nav-text",style:e.normalizeStyle({color:o.selected?t.activeColor:t.defaultColor})},e.toDisplayString(o.text),5)]))],10,["onClick"])))),128))])}}},[["__scopeId","data-v-82952c15"]]),F=n({__name:"practice-setup",props:{visible:{type:Boolean,default:!1}},emits:["close","confirm"],setup(a,{expose:s,emit:n}){const i=a,c=n,l=e.ref(null),d=e.ref(null),p=e.ref(null),h=e.ref(null),m=e.ref(null),g=e.ref([{label:"一年级",value:1},{label:"二年级",value:2},{label:"三年级",value:3},{label:"四年级",value:4},{label:"五年级",value:5},{label:"六年级",value:6}]),f=e.ref([5,10,15,20,25,30]),v=e.ref(Array.from({length:16},((e,t)=>t))),y=e.ref(Array.from({length:60},((e,t)=>t))),w=()=>{try{const e=u();if(e&&e.grade){return(parseInt(e.grade)||1)-1}}catch(e){t("error","at components/practice-setup.vue:177","练习设置组件获取用户年级失败:",e)}return 0},_=e.ref(w()),k=e.ref(1),x=e.ref(3),b=e.ref(0);e.watch((()=>i.visible),(e=>{e?setTimeout((()=>{l.value.open()}),50):l.value.close()})),e.onMounted((()=>{const e=w();_.value=e,t("log","at components/practice-setup.vue:205","练习设置组件 - 设置默认年级索引:",e,"对应年级:",e+1)}));const E=()=>{d.value.open()},S=()=>{p.value.open()},N=()=>{h.value.open()},C=()=>{m.value.open()},T=()=>{d.value.close()},V=()=>{p.value.close()},I=()=>{h.value.close()},A=()=>{m.value.close()},D=e=>{_.value=e,T()},P=e=>{k.value=e,V()},L=e=>{x.value=e,I()},B=e=>{b.value=e,A()},M=()=>{l.value.close(),c("close")},$=()=>{const e={grade:g.value[_.value].value,questionCount:f.value[k.value],timeLimit:60*v.value[x.value]+y.value[b.value]};l.value.close(),c("confirm",e)};return s({selectGrade:D,selectQuestionCount:P,selectMinutes:L,selectSeconds:B}),(t,a)=>{const s=o(e.resolveDynamicComponent("uni-icons"),r),n=o(e.resolveDynamicComponent("uni-popup"),O);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(n,{ref_key:"mainPopup",ref:l,type:"center","mask-click":!1},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"popup-container"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"练习设置"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:M,class:"close-icon"})]),e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"setting-item"},[e.createElementVNode("text",{class:"setting-label"},"年级"),e.createElementVNode("view",{class:"picker-selector",onClick:E},[e.createElementVNode("text",null,e.toDisplayString(g.value[_.value].label),1),e.createVNode(s,{type:"arrowdown",size:"16",color:"#999"})])]),e.createElementVNode("view",{class:"setting-item"},[e.createElementVNode("text",{class:"setting-label"},"题目数量"),e.createElementVNode("view",{class:"picker-selector",onClick:S},[e.createElementVNode("text",null,e.toDisplayString(f.value[k.value])+" 题",1),e.createVNode(s,{type:"arrowdown",size:"16",color:"#999"})])]),e.createElementVNode("view",{class:"setting-item"},[e.createElementVNode("text",{class:"setting-label"},"练习时间"),e.createElementVNode("view",{class:"time-picker-container"},[e.createElementVNode("view",{class:"time-picker",onClick:N},[e.createElementVNode("text",null,e.toDisplayString(v.value[x.value])+" 分",1)]),e.createElementVNode("view",{class:"time-picker",onClick:C},[e.createElementVNode("text",null,e.toDisplayString(y.value[b.value])+" 秒",1)])])])]),e.createElementVNode("view",{class:"popup-footer"},[e.createElementVNode("button",{class:"confirm-btn",onClick:$},"开始练习")])])])),_:1},512),e.createVNode(n,{ref_key:"gradePopup",ref:d,type:"center"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择年级"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:T,class:"close-icon"})]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:t.value,class:e.normalizeClass(["option-item",{selected:o===_.value}]),onClick:e=>D(o)},e.toDisplayString(t.label),11,["onClick"])))),128))])])])),_:1},512),e.createVNode(n,{ref_key:"questionCountPopup",ref:p,type:"center"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择题目数量"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:V,class:"close-icon"})]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["option-item",{selected:o===k.value}]),onClick:e=>P(o)},e.toDisplayString(t)+" 题 ",11,["onClick"])))),128))])])])),_:1},512),e.createVNode(n,{ref_key:"minutesPopup",ref:h,type:"center"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择分钟数"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:I,class:"close-icon"})]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["option-item",{selected:o===x.value}]),onClick:e=>L(o)},e.toDisplayString(t)+" 分 ",11,["onClick"])))),128))])])])),_:1},512),e.createVNode(n,{ref_key:"secondsPopup",ref:m,type:"center"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"custom-popup"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"选择秒数"),e.createVNode(s,{type:"closeempty",size:"24",color:"#999",onClick:A,class:"close-icon"})]),e.createElementVNode("scroll-view",{class:"options-container","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["option-item",{selected:o===b.value}]),onClick:e=>B(o)},e.toDisplayString(t)+" 秒 ",11,["onClick"])))),128))])])])),_:1},512)],64)}}},[["__scopeId","data-v-8274aade"]]),R={__name:"home",setup(o){const a=e.ref(!1),s=e.ref("张三"),n=e.ref(-1),i=e.ref(!1),l=e.ref(["1年级","2年级","3年级","4年级","5年级","6年级"]),h=e.ref(""),m=e.ref(0),g=e.ref(0),f=e.ref({practiceCount:0,questionCount:0,correctCount:0,wrongCount:0,correctRate:0,totalTimeSpent:0}),v=e.ref([]),y=()=>{t("log","at pages/home/home.vue:228","快速挑战 - gradeIndex.value:",n.value);const e=n.value>=0?n.value+1:1;t("log","at pages/home/home.vue:230","快速挑战 - 使用年级:",e),uni.navigateTo({url:`/pages/practice/practice?grade=${e}&questionCount=5&timeLimit=90`})},w=()=>{uni.navigateTo({url:"/pages/import/import"})},_=()=>uni.navigateTo({url:"/pages/reviewing/reviewing"}),k=()=>uni.navigateTo({url:"/pages/analysis/analysis"}),x=()=>{f.value={practiceCount:0,questionCount:0,correctCount:0,wrongCount:0,correctRate:0,totalTimeSpent:0},m.value=0,g.value=0},E=e=>{if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return e;const o=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return`${o}-${a}-${s} ${n}:${i}:${t.getSeconds().toString().padStart(2,"0")}`}catch(o){return t("error","at pages/home/home.vue:362","时间格式化失败:",o),e}};e.onMounted((async()=>{i.value=!0;try{await(async()=>{try{const e=u();if(!e)return void uni.reLaunch({url:"/pages/login/login"});s.value=e.username||"同学",t("log","at pages/home/home.vue:258","首页加载用户数据:",e),e.grade?(n.value=parseInt(e.grade)-1,h.value=l.value[n.value]||"",t("log","at pages/home/home.vue:262","首页设置年级:",e.grade,"-> gradeIndex:",n.value)):t("log","at pages/home/home.vue:264","首页用户数据中没有年级信息")}catch(e){t("error","at pages/home/home.vue:267","加载用户信息失败:",e),uni.reLaunch({url:"/pages/login/login"})}})(),await S()}catch(e){t("error","at pages/home/home.vue:377","页面数据加载失败:",e),uni.showToast({title:"数据加载失败",icon:"none"})}finally{i.value=!1}}));const S=async()=>{try{const e=p();if(!e)return t("warn","at pages/home/home.vue:392","用户未登录，无法获取练习数据"),x(),void(v.value=[]);t("log","at pages/home/home.vue:398","正在获取用户练习数据，用户ID:",e);const o=await(e=>b(`/practice-records/user/${e}`,{method:"GET"}))(e);if(t("log","at pages/home/home.vue:402","获取到的练习记录:",o),o&&o.data&&Array.isArray(o.data)){const e=o.data,a=(e=>{const o=(new Date).toISOString().split("T")[0],a=e.filter((e=>new Date(e.createdTime).toISOString().split("T")[0]===o));if(t("log","at pages/home/home.vue:299",`今日练习记录数量: ${a.length}`,a),0===a.length)return{practiceCount:0,questionCount:0,correctCount:0,wrongCount:0,correctRate:0,totalTimeSpent:0};let s=0,n=0,i=0,r=0;a.forEach((e=>{const t=parseInt(e.questionCount)||0,o=parseInt(e.correctCount)||0,a=parseInt(e.wrongCount)||0,c=parseInt(e.timeSpent)||0;s+=t,n+=o,i+=a,r+=c}));const c=s>0?n/s*100:0;return{practiceCount:a.length,questionCount:s,correctCount:n,wrongCount:i,correctRate:Math.round(10*c)/10,totalTimeSpent:r}})(e);f.value=a,m.value=f.value.questionCount,g.value=Math.round(f.value.correctRate),v.value=e.map((e=>({startTime:E(e.createdTime),grade:`${e.grade}年级`,questionCount:parseInt(e.questionCount)||0,correctRate:Math.round(parseFloat(e.correctRate)||0),timeLimit:parseInt(e.timeLimit)||0,timeSpent:parseInt(e.timeSpent)||0}))),t("log","at pages/home/home.vue:424","今日统计:",f.value),t("log","at pages/home/home.vue:425","最近练习记录:",v.value)}else t("log","at pages/home/home.vue:427","没有获取到练习数据"),x(),v.value=[]}catch(e){t("error","at pages/home/home.vue:432","加载练习数据失败:",e),x(),v.value=[]}},N=e=>{a.value=!1,uni.navigateTo({url:`/pages/practice/practice?grade=${e.grade}&questionCount=${e.questionCount}&timeLimit=${e.timeLimit}`})},C=async e=>{const o=e.detail.value,a=o+1;try{uni.showLoading({title:"更新年级中...",mask:!0});const e=p();if(!e)throw new Error("用户ID获取失败");const t=await((e,t)=>b(`/users/grade/${e}`,{method:"PUT",data:{newGrade:t}}))(e,a);if(0!==t.code)throw new Error(t.message||"年级更新失败");{n.value=o,h.value=l.value[o];const e=u();e&&(e.grade=a,d(e)),uni.hideLoading(),uni.showToast({title:"年级更新成功",icon:"success"})}}catch(s){uni.hideLoading(),t("error","at pages/home/home.vue:489","年级更新失败:",s),uni.showToast({title:s.message||"年级更新失败，请稍后重试",icon:"none"})}};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"home-container"},[e.createElementVNode("view",{class:"bg-elements top"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"+"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"-"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"×"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"÷"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"+")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"首页"),e.createElementVNode("picker",{class:"grade-picker",mode:"selector",range:l.value,value:n.value,onChange:C},[e.createElementVNode("view",{class:"picker-view"},[e.createElementVNode("text",{class:"grade-text"},e.toDisplayString(h.value||"年级"),1),e.createVNode(r,{type:"arrowdown",size:"14",color:"#1E90FF"})])],40,["range","value"])]),e.createElementVNode("view",{class:"welcome-section"},[e.createElementVNode("image",{class:"fox-welcome",src:c,mode:"widthFix"}),e.createElementVNode("view",{class:"welcome-header"},[e.createElementVNode("text",{class:"welcome-text"},e.toDisplayString(s.value||"小朋友")+"，一起来算数学吧！",1)]),i.value?(e.openBlock(),e.createElementBlock("text",{key:1,class:"practice-stats"}," 正在加载... ")):(e.openBlock(),e.createElementBlock("text",{key:0,class:"practice-stats"}," 今天已经做了 "+e.toDisplayString(m.value)+" 道题，答对了 "+e.toDisplayString(g.value)+"%！棒棒哒！ ",1))]),e.createElementVNode("view",{class:"function-grid"},[e.createElementVNode("view",{class:"function-card",onClick:y},[e.createVNode(r,{type:"medal",size:"36",color:"#ff6b35"}),e.createElementVNode("view",{class:"card-text"},"快速挑战")]),e.createElementVNode("view",{class:"function-card",onClick:w},[e.createVNode(r,{type:"upload",size:"36",color:"#4299e1"}),e.createElementVNode("view",{class:"card-text"},"习题导入")]),e.createElementVNode("view",{class:"function-card",onClick:_},[e.createVNode(r,{type:"closeempty",size:"36",color:"#ea4335"}),e.createElementVNode("view",{class:"card-text"},"错题复习")]),e.createElementVNode("view",{class:"function-card",onClick:k},[e.createVNode(r,{type:"map",size:"36",color:"#34a853"}),e.createElementVNode("view",{class:"card-text"},"学习分析")])]),e.createElementVNode("view",{class:"daily-stats-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"今日统计")]),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-placeholder"},[e.createElementVNode("text",null,"加载中...")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"stats-grid"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-icon"},[e.createVNode(r,{type:"medal",size:"24",color:"#ff6b35"})]),e.createElementVNode("view",{class:"stat-content"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(f.value.practiceCount),1),e.createElementVNode("text",{class:"stat-label"},"练习次数")])]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-icon"},[e.createVNode(r,{type:"list",size:"24",color:"#4299e1"})]),e.createElementVNode("view",{class:"stat-content"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(f.value.questionCount),1),e.createElementVNode("text",{class:"stat-label"},"题目数量")])]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-icon"},[e.createVNode(r,{type:"checkmarkempty",size:"24",color:"#34a853"})]),e.createElementVNode("view",{class:"stat-content"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(f.value.correctRate)+"%",1),e.createElementVNode("text",{class:"stat-label"},"正确率")])]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-icon"},[e.createVNode(r,{type:"calendar",size:"24",color:"#9c27b0"})]),e.createElementVNode("view",{class:"stat-content"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(f.value.totalTimeSpent),1),e.createElementVNode("text",{class:"stat-label"},"总用时(秒)")])])]))]),e.createElementVNode("view",{class:"records-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"练习记录")]),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-placeholder"},[e.createElementVNode("text",null,"加载中...")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"records-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,o)=>{return e.openBlock(),e.createElementBlock("view",{class:"record-item",key:o},[e.createElementVNode("view",{class:"record-main"},[e.createElementVNode("view",{class:"record-info"},[e.createElementVNode("view",{class:"record-meta"},[e.createElementVNode("text",{class:"start-time"},e.toDisplayString(t.startTime),1),e.createElementVNode("view",{class:"record-details"},[e.createElementVNode("text",{class:"detail-text"},e.toDisplayString(t.grade),1),e.createElementVNode("text",{class:"detail-text"},e.toDisplayString(t.questionCount)+"题",1)])]),e.createElementVNode("view",{class:"record-stats"},[e.createElementVNode("text",{class:"stats-text"},"限时"+e.toDisplayString(t.timeLimit)+"秒",1),e.createElementVNode("text",{class:"stats-text"},"用时"+e.toDisplayString(t.timeSpent)+"秒",1)])]),e.createElementVNode("view",{class:e.normalizeClass(["accuracy-rate",(a=t.correctRate,a>=90?"excellent":a>=80?"good":a>=70?"average":a>=60?"poor":"bad")])},[e.createElementVNode("text",{class:"rate-text"},e.toDisplayString(t.correctRate)+"%",1),e.createElementVNode("text",{class:"rate-label"},"正确率")],2)])]);var a})),128)),0===v.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"暂无练习记录")])):e.createCommentVNode("",!0)]))]),e.createVNode($,{onShowPracticeSetup:o[0]||(o[0]=e=>a.value=!0)}),e.createVNode(F,{visible:a.value,onClose:o[1]||(o[1]=e=>a.value=!1),onConfirm:N},null,8,["visible"])]))}},q=n(R,[["__scopeId","data-v-0ea52dc5"]]),U={__name:"profile",setup(a){const s=e.ref(!1),n=e.ref(null),i=e.ref(""),c=e.ref(""),l=e.ref(""),h=e.ref("");e.onMounted((()=>{(()=>{try{const e=u();e?(l.value=e.username||"未设置昵称",h.value=e.id||""):uni.reLaunch({url:"/pages/login/login"})}catch(e){t("error","at pages/profile/profile.vue:143","加载用户信息失败:",e),uni.reLaunch({url:"/pages/login/login"})}})()}));const m=()=>{uni.showToast({title:"编辑头像",icon:"none"})},g=()=>{i.value=l.value,e.nextTick((()=>{n.value.open()}))},f=()=>{n.value.close()},v=async()=>{if(i.value.trim())try{uni.showLoading({title:"更新中...",mask:!0});const e=p();if(!e)throw new Error("用户ID获取失败");const t=await((e,t)=>b(`/users/username/${e}`,{method:"PUT",data:{newUsername:t}}))(e,i.value.trim());if(0!==t.code)throw new Error(t.message||"更新失败");{l.value=i.value.trim();const e=u();e&&(e.username=i.value.trim(),d(e)),f(),uni.hideLoading(),uni.showToast({title:"昵称更新成功",icon:"success"})}}catch(e){uni.hideLoading(),t("error","at pages/profile/profile.vue:222","更新昵称失败:",e),uni.showToast({title:e.message||"更新失败，请稍后重试",icon:"none"})}else uni.showToast({title:"请输入昵称",icon:"none"})},y=()=>{uni.showModal({title:"清除缓存",content:"确定要清除应用缓存吗？这将删除临时文件和数据。",success:function(e){e.confirm&&(uni.showLoading({title:"清除中...",mask:!0}),setTimeout((()=>{uni.hideLoading(),uni.showToast({title:"缓存清除成功",icon:"success"})}),1500))}})},w=()=>{uni.showLoading({title:"检查中...",mask:!0}),setTimeout((()=>{uni.hideLoading(),uni.showModal({title:"版本检查",content:"当前已是最新版本 v1.0.0",showCancel:!1,confirmText:"确定"})}),1e3)},_=()=>{uni.showModal({title:"关于我们",content:"Powered by Xanfro",showCancel:!1,confirmText:"确定"})},k=e=>{s.value=!1,uni.navigateTo({url:`/pages/practice/practice?grade=${e.grade}&questionCount=${e.questionCount}&timeLimit=${e.timeLimit}`})},x=()=>{uni.showModal({title:"退出登录",content:"确定要退出当前账号吗？",success:function(e){e.confirm&&(uni.removeStorageSync("token"),uni.removeStorageSync("userData"),uni.reLaunch({url:"/pages/login/login"}))}})};return(t,a)=>{const u=o(e.resolveDynamicComponent("uni-icons"),r),d=o(e.resolveDynamicComponent("uni-popup"),O);return e.openBlock(),e.createElementBlock("view",{class:"profile-container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"+"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"-"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"×"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"÷"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"+")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"我的")]),e.createElementVNode("view",{class:"profile-header"},[e.createElementVNode("view",{class:"avatar-container",onClick:m},[e.createElementVNode("image",{class:"avatar",src:c.value||"/static/logo.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"camera-icon"},[e.createVNode(u,{type:"camera",size:"20",color:"#fff"})])]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"username-row"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(l.value||"点击设置昵称"),1),e.createVNode(u,{type:"compose",size:"18",color:"#4299e1",onClick:g})]),e.createElementVNode("text",{class:"user-id"},"ID: "+e.toDisplayString(h.value||"获取中..."),1)])]),e.createVNode(d,{ref_key:"nicknamePopup",ref:n,type:"center"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"设置昵称"),e.createVNode(u,{type:"close",size:"24",color:"#999",onClick:f,class:"close-icon"})]),e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{class:"nickname-input","onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),placeholder:"请输入您的昵称",maxlength:"20"},null,512),[[e.vModelText,i.value]])]),e.createElementVNode("view",{class:"button-group"},[e.createElementVNode("button",{class:"cancel-btn",onClick:f},"取消"),e.createElementVNode("button",{class:"confirm-btn",onClick:v},"确定")])])])),_:1},512),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"设置")]),e.createElementVNode("view",{class:"settings-list"},[e.createElementVNode("view",{class:"setting-item",onClick:y},[e.createElementVNode("view",{class:"setting-main"},[e.createVNode(u,{type:"trash",size:"20",color:"#4299e1"}),e.createElementVNode("text",{class:"setting-text"},"清除缓存")]),e.createVNode(u,{type:"forward",size:"16",color:"#999"})]),e.createElementVNode("view",{class:"setting-item",onClick:w},[e.createElementVNode("view",{class:"setting-main"},[e.createVNode(u,{type:"loop",size:"20",color:"#4299e1"}),e.createElementVNode("text",{class:"setting-text"},"检查更新")]),e.createVNode(u,{type:"forward",size:"16",color:"#999"})]),e.createElementVNode("view",{class:"setting-item",onClick:_},[e.createElementVNode("view",{class:"setting-main"},[e.createVNode(u,{type:"info",size:"20",color:"#4299e1"}),e.createElementVNode("text",{class:"setting-text"},"关于我们")]),e.createVNode(u,{type:"forward",size:"16",color:"#999"})])])]),e.createElementVNode("view",{class:"logout-section"},[e.createElementVNode("button",{class:"logout-btn",onClick:x},"退出登录")]),e.createVNode($,{onShowPracticeSetup:a[1]||(a[1]=e=>s.value=!0)}),e.createVNode(F,{visible:s.value,onClose:a[2]||(a[2]=e=>s.value=!1),onConfirm:k},null,8,["visible"])])}}},j={pages:[{path:"pages/login/login",style:{navigationBarTitleText:"登录",navigationStyle:"custom"}},{path:"pages/register/register",style:{navigationBarTitleText:"注册",navigationStyle:"custom"}},{path:"pages/practice/practice",style:{navigationStyle:"custom"}},{path:"pages/home/home",style:{navigationStyle:"custom"}},{path:"pages/profile/profile",style:{navigationStyle:"custom"}},{path:"pages/analysis/analysis",style:{navigationStyle:"custom"}},{path:"pages/result/result",style:{navigationStyle:"custom"}},{path:"pages/reviewing/reviewing",style:{navigationStyle:"custom"}},{path:"pages/import/import",style:{navigationStyle:"custom"}}],globalStyle:{navigationBarTextStyle:"black",navigationBarTitleText:"uni-app",navigationBarBackgroundColor:"#F8F8F8",backgroundColor:"#F8F8F8"},uniIdRouter:{}};function z(e,t,o){return e(o={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&o.path)}},o.exports),o.exports}var W=z((function(e,t){var o;e.exports=(o=o||function(e,t){var o=Object.create||function(){function e(){}return function(t){var o;return e.prototype=t,o=new e,e.prototype=null,o}}(),a={},s=a.lib={},n=s.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=s.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,o=e.words,a=this.sigBytes,s=e.sigBytes;if(this.clamp(),a%4)for(var n=0;n<s;n++){var i=o[n>>>2]>>>24-n%4*8&255;t[a+n>>>2]|=i<<24-(a+n)%4*8}else for(n=0;n<s;n+=4)t[a+n>>>2]=o[n>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,o=this.sigBytes;t[o>>>2]&=4294967295<<32-o%4*8,t.length=e.ceil(o/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var o,a=[],s=function(t){var o=987654321,a=4294967295;return function(){var s=((o=36969*(65535&o)+(o>>16)&a)<<16)+(t=18e3*(65535&t)+(t>>16)&a)&a;return s/=4294967296,(s+=.5)*(e.random()>.5?1:-1)}},n=0;n<t;n+=4){var r=s(4294967296*(o||e.random()));o=987654071*r(),a.push(4294967296*r()|0)}return new i.init(a,t)}}),r=a.enc={},c=r.Hex={stringify:function(e){for(var t=e.words,o=e.sigBytes,a=[],s=0;s<o;s++){var n=t[s>>>2]>>>24-s%4*8&255;a.push((n>>>4).toString(16)),a.push((15&n).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,o=[],a=0;a<t;a+=2)o[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new i.init(o,t/2)}},l=r.Latin1={stringify:function(e){for(var t=e.words,o=e.sigBytes,a=[],s=0;s<o;s++){var n=t[s>>>2]>>>24-s%4*8&255;a.push(String.fromCharCode(n))}return a.join("")},parse:function(e){for(var t=e.length,o=[],a=0;a<t;a++)o[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new i.init(o,t)}},u=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=s.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var o=this._data,a=o.words,s=o.sigBytes,n=this.blockSize,r=s/(4*n),c=(r=t?e.ceil(r):e.max((0|r)-this._minBufferSize,0))*n,l=e.min(4*c,s);if(c){for(var u=0;u<c;u+=n)this._doProcessBlock(a,u);var d=a.splice(0,c);o.sigBytes-=l}return new i.init(d,l)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=d.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,o){return new e.init(o).finalize(t)}},_createHmacHelper:function(e){return function(t,o){return new p.HMAC.init(e,o).finalize(t)}}});var p=a.algo={};return a}(Math),o)})),K=W,H=(z((function(e,t){var o;e.exports=(o=K,function(e){var t=o,a=t.lib,s=a.WordArray,n=a.Hasher,i=t.algo,r=[];!function(){for(var t=0;t<64;t++)r[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=i.MD5=n.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var o=0;o<16;o++){var a=t+o,s=e[a];e[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var n=this._hash.words,i=e[t+0],c=e[t+1],h=e[t+2],m=e[t+3],g=e[t+4],f=e[t+5],v=e[t+6],y=e[t+7],w=e[t+8],_=e[t+9],k=e[t+10],x=e[t+11],b=e[t+12],E=e[t+13],S=e[t+14],N=e[t+15],C=n[0],T=n[1],V=n[2],I=n[3];C=l(C,T,V,I,i,7,r[0]),I=l(I,C,T,V,c,12,r[1]),V=l(V,I,C,T,h,17,r[2]),T=l(T,V,I,C,m,22,r[3]),C=l(C,T,V,I,g,7,r[4]),I=l(I,C,T,V,f,12,r[5]),V=l(V,I,C,T,v,17,r[6]),T=l(T,V,I,C,y,22,r[7]),C=l(C,T,V,I,w,7,r[8]),I=l(I,C,T,V,_,12,r[9]),V=l(V,I,C,T,k,17,r[10]),T=l(T,V,I,C,x,22,r[11]),C=l(C,T,V,I,b,7,r[12]),I=l(I,C,T,V,E,12,r[13]),V=l(V,I,C,T,S,17,r[14]),C=u(C,T=l(T,V,I,C,N,22,r[15]),V,I,c,5,r[16]),I=u(I,C,T,V,v,9,r[17]),V=u(V,I,C,T,x,14,r[18]),T=u(T,V,I,C,i,20,r[19]),C=u(C,T,V,I,f,5,r[20]),I=u(I,C,T,V,k,9,r[21]),V=u(V,I,C,T,N,14,r[22]),T=u(T,V,I,C,g,20,r[23]),C=u(C,T,V,I,_,5,r[24]),I=u(I,C,T,V,S,9,r[25]),V=u(V,I,C,T,m,14,r[26]),T=u(T,V,I,C,w,20,r[27]),C=u(C,T,V,I,E,5,r[28]),I=u(I,C,T,V,h,9,r[29]),V=u(V,I,C,T,y,14,r[30]),C=d(C,T=u(T,V,I,C,b,20,r[31]),V,I,f,4,r[32]),I=d(I,C,T,V,w,11,r[33]),V=d(V,I,C,T,x,16,r[34]),T=d(T,V,I,C,S,23,r[35]),C=d(C,T,V,I,c,4,r[36]),I=d(I,C,T,V,g,11,r[37]),V=d(V,I,C,T,y,16,r[38]),T=d(T,V,I,C,k,23,r[39]),C=d(C,T,V,I,E,4,r[40]),I=d(I,C,T,V,i,11,r[41]),V=d(V,I,C,T,m,16,r[42]),T=d(T,V,I,C,v,23,r[43]),C=d(C,T,V,I,_,4,r[44]),I=d(I,C,T,V,b,11,r[45]),V=d(V,I,C,T,N,16,r[46]),C=p(C,T=d(T,V,I,C,h,23,r[47]),V,I,i,6,r[48]),I=p(I,C,T,V,y,10,r[49]),V=p(V,I,C,T,S,15,r[50]),T=p(T,V,I,C,f,21,r[51]),C=p(C,T,V,I,b,6,r[52]),I=p(I,C,T,V,m,10,r[53]),V=p(V,I,C,T,k,15,r[54]),T=p(T,V,I,C,c,21,r[55]),C=p(C,T,V,I,w,6,r[56]),I=p(I,C,T,V,N,10,r[57]),V=p(V,I,C,T,v,15,r[58]),T=p(T,V,I,C,E,21,r[59]),C=p(C,T,V,I,g,6,r[60]),I=p(I,C,T,V,x,10,r[61]),V=p(V,I,C,T,h,15,r[62]),T=p(T,V,I,C,_,21,r[63]),n[0]=n[0]+C|0,n[1]=n[1]+T|0,n[2]=n[2]+V|0,n[3]=n[3]+I|0},_doFinalize:function(){var t=this._data,o=t.words,a=8*this._nDataBytes,s=8*t.sigBytes;o[s>>>5]|=128<<24-s%32;var n=e.floor(a/4294967296),i=a;o[15+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),o[14+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(o.length+1),this._process();for(var r=this._hash,c=r.words,l=0;l<4;l++){var u=c[l];c[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return r},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,o,a,s,n,i){var r=e+(t&o|~t&a)+s+i;return(r<<n|r>>>32-n)+t}function u(e,t,o,a,s,n,i){var r=e+(t&a|o&~a)+s+i;return(r<<n|r>>>32-n)+t}function d(e,t,o,a,s,n,i){var r=e+(t^o^a)+s+i;return(r<<n|r>>>32-n)+t}function p(e,t,o,a,s,n,i){var r=e+(o^(t|~a))+s+i;return(r<<n|r>>>32-n)+t}t.MD5=n._createHelper(c),t.HmacMD5=n._createHmacHelper(c)}(Math),o.MD5)})),z((function(e,t){var o,a,s;e.exports=(a=(o=K).lib.Base,s=o.enc.Utf8,void(o.algo.HMAC=a.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var o=e.blockSize,a=4*o;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),r=n.words,c=i.words,l=0;l<o;l++)r[l]^=1549556828,c[l]^=909522486;n.sigBytes=i.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,o=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(o))}})))})),z((function(e,t){e.exports=K.HmacMD5}))),J=z((function(e,t){e.exports=K.enc.Utf8})),G=z((function(e,t){var o,a,s;e.exports=(s=(a=o=K).lib.WordArray,a.enc.Base64={stringify:function(e){var t=e.words,o=e.sigBytes,a=this._map;e.clamp();for(var s=[],n=0;n<o;n+=3)for(var i=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,r=0;r<4&&n+.75*r<o;r++)s.push(a.charAt(i>>>6*(3-r)&63));var c=a.charAt(64);if(c)for(;s.length%4;)s.push(c);return s.join("")},parse:function(e){var t=e.length,o=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var n=0;n<o.length;n++)a[o.charCodeAt(n)]=n}var i=o.charAt(64);if(i){var r=e.indexOf(i);-1!==r&&(t=r)}return function(e,t,o){for(var a=[],n=0,i=0;i<t;i++)if(i%4){var r=o[e.charCodeAt(i-1)]<<i%4*2,c=o[e.charCodeAt(i)]>>>6-i%4*2;a[n>>>2]|=(r|c)<<24-n%4*8,n++}return s.create(a,n)}(e,t,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)}));const Q="uni_id_token",Y="uni_id_token_expired",X="FUNCTION",Z="OBJECT",ee="CLIENT_DB",te="pending",oe="rejected";function ae(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function se(e){return"object"===ae(e)}function ne(e){return"function"==typeof e}function ie(e){return function(){try{return e.apply(e,arguments)}catch(t){console.error(t)}}}const re="REJECTED",ce="NOT_PENDING";class le{constructor({createPromise:e,retryRule:t=re}={}){this.createPromise=e,this.status=null,this.promise=null,this.retryRule=t}get needRetry(){if(!this.status)return!0;switch(this.retryRule){case re:return this.status===oe;case ce:return this.status!==te}}exec(){return this.needRetry?(this.status=te,this.promise=this.createPromise().then((e=>(this.status="fulfilled",Promise.resolve(e))),(e=>(this.status=oe,Promise.reject(e)))),this.promise):this.promise}}function ue(e){return e&&"string"==typeof e?JSON.parse(e):e}const de=ue([]);ue("");const pe=ue("[]")||[];let he="";try{he="__UNI__89909D1"}catch(ot){}let me,ge={};function fe(e,t={}){var o,a;return o=ge,a=e,Object.prototype.hasOwnProperty.call(o,a)||(ge[e]=t),ge[e]}ge=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={};const ve=["invoke","success","fail","complete"],ye=fe("_globalUniCloudInterceptor");function we(e,t){ye[e]||(ye[e]={}),se(t)&&Object.keys(t).forEach((o=>{ve.indexOf(o)>-1&&function(e,t,o){let a=ye[e][t];a||(a=ye[e][t]=[]),-1===a.indexOf(o)&&ne(o)&&a.push(o)}(e,o,t[o])}))}function _e(e,t){ye[e]||(ye[e]={}),se(t)?Object.keys(t).forEach((o=>{ve.indexOf(o)>-1&&function(e,t,o){const a=ye[e][t];if(!a)return;const s=a.indexOf(o);s>-1&&a.splice(s,1)}(e,o,t[o])})):delete ye[e]}function ke(e,t){return e&&0!==e.length?e.reduce(((e,o)=>e.then((()=>o(t)))),Promise.resolve()):Promise.resolve()}function xe(e,t){return ye[e]&&ye[e][t]||[]}function be(e){we("callObject",e)}const Ee=fe("_globalUniCloudListener"),Se="response",Ne="needLogin",Ce="refreshToken",Te="clientdb",Ve="cloudfunction",Ie="cloudobject";function Ae(e){return Ee[e]||(Ee[e]=[]),Ee[e]}function De(e,t){const o=Ae(e);o.includes(t)||o.push(t)}function Pe(e,t){const o=Ae(e),a=o.indexOf(t);-1!==a&&o.splice(a,1)}function Le(e,t){const o=Ae(e);for(let a=0;a<o.length;a++)(0,o[a])(t)}let Oe,Be=!1;function Me(){return Oe||(Oe=new Promise((e=>{Be&&e(),function t(){if("function"==typeof getCurrentPages){const t=getCurrentPages();t&&t[0]&&(Be=!0,e())}Be||setTimeout((()=>{t()}),30)}()})),Oe)}function $e(e){const t={};for(const o in e){const a=e[o];ne(a)&&(t[o]=ie(a))}return t}class Fe extends Error{constructor(e){const t=e.message||e.errMsg||"unknown system error";super(t),this.errMsg=t,this.code=this.errCode=e.code||e.errCode||"SYSTEM_ERROR",this.errSubject=this.subject=e.subject||e.errSubject,this.cause=e.cause,this.requestId=e.requestId}toJson(e=0){if(!(e>=10))return e++,{errCode:this.errCode,errMsg:this.errMsg,errSubject:this.errSubject,cause:this.cause&&this.cause.toJson?this.cause.toJson(e):this.cause}}}var Re={request:e=>uni.request(e),uploadFile:e=>uni.uploadFile(e),setStorageSync:(e,t)=>uni.setStorageSync(e,t),getStorageSync:e=>uni.getStorageSync(e),removeStorageSync:e=>uni.removeStorageSync(e),clearStorageSync:()=>uni.clearStorageSync(),connectSocket:e=>uni.connectSocket(e)};function qe(e){return e&&qe(e.__v_raw)||e}function Ue(){return{token:Re.getStorageSync(Q)||Re.getStorageSync("uniIdToken"),tokenExpired:Re.getStorageSync(Y)}}function je({token:e,tokenExpired:t}={}){e&&Re.setStorageSync(Q,e),t&&Re.setStorageSync(Y,t)}let ze,We;function Ke(){return ze||(ze=uni.getSystemInfoSync()),ze}function He(){let e,t;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;const{scene:o,channel:a}=uni.getLaunchOptionsSync();e=a,t=o}}catch(o){}return{channel:e,scene:t}}let Je={};function Ge(){const e=uni.getLocale&&uni.getLocale()||"en";if(We)return{...Je,...We,locale:e,LOCALE:e};const t=Ke(),{deviceId:o,osName:a,uniPlatform:s,appId:n}=t,i=["appId","appLanguage","appName","appVersion","appVersionCode","appWgtVersion","browserName","browserVersion","deviceBrand","deviceId","deviceModel","deviceType","osName","osVersion","romName","romVersion","ua","hostName","hostVersion","uniPlatform","uniRuntimeVersion","uniRuntimeVersionCode","uniCompilerVersion","uniCompilerVersionCode"];for(const r in t)Object.hasOwnProperty.call(t,r)&&-1===i.indexOf(r)&&delete t[r];return We={PLATFORM:s,OS:a,APPID:n,DEVICEID:o,...He(),...t},{...Je,...We,locale:e,LOCALE:e}}var Qe=function(e,t){let o="";return Object.keys(e).sort().forEach((function(t){e[t]&&(o=o+"&"+t+"="+e[t])})),o=o.slice(1),H(o,t).toString()},Ye=function(e,t){return new Promise(((o,a)=>{t(Object.assign(e,{complete(e){e||(e={});const t=e.data&&e.data.header&&e.data.header["x-serverless-request-id"]||e.header&&e.header["request-id"];if(!e.statusCode||e.statusCode>=400){const o=e.data&&e.data.error&&e.data.error.code||"SYS_ERR",s=e.data&&e.data.error&&e.data.error.message||e.errMsg||"request:fail";return a(new Fe({code:o,message:s,requestId:t}))}const s=e.data;if(s.error)return a(new Fe({code:s.error.code,message:s.error.message,requestId:t}));s.result=s.data,s.requestId=t,delete s.data,o(s)}}))}))},Xe=function(e){return G.stringify(J.parse(e))},Ze={init(e){const t=new class{constructor(e){["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),this.config=Object.assign({},{endpoint:0===e.spaceId.indexOf("mp-")?"https://api.next.bspapp.com":"https://api.bspapp.com"},e),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=Re,this._getAccessTokenPromiseHub=new le({createPromise:()=>this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then((e=>{if(!e.result||!e.result.accessToken)throw new Fe({code:"AUTH_FAILED",message:"获取accessToken失败"});this.setAccessToken(e.result.accessToken)})),retryRule:ce})}get hasAccessToken(){return!!this.accessToken}setAccessToken(e){this.accessToken=e}requestWrapped(e){return Ye(e,this.adapter.request)}requestAuth(e){return this.requestWrapped(e)}request(e,t){return Promise.resolve().then((()=>this.hasAccessToken?t?this.requestWrapped(e):this.requestWrapped(e).catch((t=>new Promise(((e,o)=>{!t||"GATEWAY_INVALID_TOKEN"!==t.code&&"InvalidParameter.InvalidToken"!==t.code?o(t):e()})).then((()=>this.getAccessToken())).then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)})))):this.getAccessToken().then((()=>{const t=this.rebuildRequest(e);return this.request(t,!0)}))))}rebuildRequest(e){const t=Object.assign({},e);return t.data.token=this.accessToken,t.header["x-basement-token"]=this.accessToken,t.header["x-serverless-sign"]=Qe(t.data,this.config.clientSecret),t}setupRequest(e,t){const o=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),a={"Content-Type":"application/json"};return"auth"!==t&&(o.token=this.accessToken,a["x-basement-token"]=this.accessToken),a["x-serverless-sign"]=Qe(o,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:o,dataType:"json",header:a}}getAccessToken(){return this._getAccessTokenPromiseHub.exec()}async authorize(){await this.getAccessToken()}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request({...this.setupRequest(t),timeout:e.timeout})}getOSSUploadOptionsFromPath(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}uploadFileToOSS({url:e,formData:t,name:o,filePath:a,fileType:s,onUploadProgress:n}){return new Promise(((i,r)=>{const c=this.adapter.uploadFile({url:e,formData:t,name:o,filePath:a,fileType:s,header:{"X-OSS-server-side-encrpytion":"AES256"},success(e){e&&e.statusCode<400?i(e):r(new Fe({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){r(new Fe({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof n&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((e=>{n({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}reportOSSUpload(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}async uploadFile({filePath:e,cloudPath:t,fileType:o="image",cloudPathAsRealPath:a=!1,onUploadProgress:s,config:n}){if("string"!==ae(t))throw new Fe({code:"INVALID_PARAM",message:"cloudPath必须为字符串类型"});if(!(t=t.trim()))throw new Fe({code:"INVALID_PARAM",message:"cloudPath不可为空"});if(/:\/\//.test(t))throw new Fe({code:"INVALID_PARAM",message:"cloudPath不合法"});const i=n&&n.envType||this.config.envType;if(a&&("/"!==t[0]&&(t="/"+t),t.indexOf("\\")>-1))throw new Fe({code:"INVALID_PARAM",message:"使用cloudPath作为路径时，cloudPath不可包含“\\”"});const r=(await this.getOSSUploadOptionsFromPath({env:i,filename:a?t.split("/").pop():t,fileId:a?t:void 0})).result,c="https://"+r.cdnDomain+"/"+r.ossPath,{securityToken:l,accessKeyId:u,signature:d,host:p,ossPath:h,id:m,policy:g,ossCallbackUrl:f}=r,v={"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:u,Signature:d,host:p,id:m,key:h,policy:g,success_action_status:200};if(l&&(v["x-oss-security-token"]=l),f){const e=JSON.stringify({callbackUrl:f,callbackBody:JSON.stringify({fileId:m,spaceId:this.config.spaceId}),callbackBodyType:"application/json"});v.callback=Xe(e)}const y={url:"https://"+r.host,formData:v,fileName:"file",name:"file",filePath:e,fileType:o};if(await this.uploadFileToOSS(Object.assign({},y,{onUploadProgress:s})),f)return{success:!0,filePath:e,fileID:c};if((await this.reportOSSUpload({id:m})).success)return{success:!0,filePath:e,fileID:c};throw new Fe({code:"UPLOAD_FAILED",message:"文件上传失败"})}getTempFileURL({fileList:e}={}){return new Promise(((t,o)=>{Array.isArray(e)&&0!==e.length||o(new Fe({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"})),this.getFileInfo({fileList:e}).then((o=>{t({fileList:e.map(((e,t)=>{const a=o.fileList[t];return{fileID:e,tempFileURL:a&&a.url||e}}))})}))}))}async getFileInfo({fileList:e}={}){if(!Array.isArray(e)||0===e.length)throw new Fe({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});const t={method:"serverless.file.resource.info",params:JSON.stringify({id:e.map((e=>e.split("?")[0])).join(",")})};return{fileList:(await this.request(this.setupRequest(t))).result}}}(e),o={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return o},t.customAuth=t.auth,t}};const et="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";var tt,ot;(ot=tt||(tt={})).local="local",ot.none="none",ot.session="session";var at=function(){},st=z((function(e,t){var o;e.exports=(o=K,function(e){var t=o,a=t.lib,s=a.WordArray,n=a.Hasher,i=t.algo,r=[],c=[];!function(){function t(t){for(var o=e.sqrt(t),a=2;a<=o;a++)if(!(t%a))return!1;return!0}function o(e){return 4294967296*(e-(0|e))|0}for(var a=2,s=0;s<64;)t(a)&&(s<8&&(r[s]=o(e.pow(a,.5))),c[s]=o(e.pow(a,1/3)),s++),a++}();var l=[],u=i.SHA256=n.extend({_doReset:function(){this._hash=new s.init(r.slice(0))},_doProcessBlock:function(e,t){for(var o=this._hash.words,a=o[0],s=o[1],n=o[2],i=o[3],r=o[4],u=o[5],d=o[6],p=o[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var m=l[h-15],g=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,f=l[h-2],v=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;l[h]=g+l[h-7]+v+l[h-16]}var y=a&s^a&n^s&n,w=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),_=p+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&u^~r&d)+c[h]+l[h];p=d,d=u,u=r,r=i+_|0,i=n,n=s,s=a,a=_+(w+y)|0}o[0]=o[0]+a|0,o[1]=o[1]+s|0,o[2]=o[2]+n|0,o[3]=o[3]+i|0,o[4]=o[4]+r|0,o[5]=o[5]+u|0,o[6]=o[6]+d|0,o[7]=o[7]+p|0},_doFinalize:function(){var t=this._data,o=t.words,a=8*this._nDataBytes,s=8*t.sigBytes;return o[s>>>5]|=128<<24-s%32,o[14+(s+64>>>9<<4)]=e.floor(a/4294967296),o[15+(s+64>>>9<<4)]=a,t.sigBytes=4*o.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=n._createHelper(u),t.HmacSHA256=n._createHmacHelper(u)}(Math),o.SHA256)})),nt=st,it=z((function(e,t){e.exports=K.HmacSHA256}));const rt=()=>{let e;if(!Promise){e=()=>{},e.promise={};const t=()=>{throw new Fe({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}const t=new Promise(((t,o)=>{e=(e,a)=>e?o(e):t(a)}));return e.promise=t,e};function ct(e){return void 0===e}function lt(e){return"[object Null]"===Object.prototype.toString.call(e)}function ut(e=""){return e.replace(/([\s\S]+)\s+(请前往云开发AI小助手查看问题：.*)/,"$1")}function dt(e=32){let t="";for(let o=0;o<e;o++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}var pt;!function(e){e.WEB="web",e.WX_MP="wx_mp"}(pt||(pt={}));const ht={adapter:null,runtime:void 0},mt=["anonymousUuidKey"];class gt extends at{constructor(){super(),ht.adapter.root.tcbObject||(ht.adapter.root.tcbObject={})}setItem(e,t){ht.adapter.root.tcbObject[e]=t}getItem(e){return ht.adapter.root.tcbObject[e]}removeItem(e){delete ht.adapter.root.tcbObject[e]}clear(){delete ht.adapter.root.tcbObject}}function ft(e,t){switch(e){case"local":return t.localStorage||new gt;case"none":return new gt;default:return t.sessionStorage||new gt}}class vt{constructor(e){if(!this._storage){this._persistence=ht.adapter.primaryStorage||e.persistence,this._storage=ft(this._persistence,ht.adapter);const t=`access_token_${e.env}`,o=`access_token_expire_${e.env}`,a=`refresh_token_${e.env}`,s=`anonymous_uuid_${e.env}`,n=`login_type_${e.env}`,i="device_id",r=`token_type_${e.env}`,c=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:o,refreshTokenKey:a,anonymousUuidKey:s,loginTypeKey:n,userInfoKey:c,deviceIdKey:i,tokenTypeKey:r}}}updatePersistence(e){if(e===this._persistence)return;const t="local"===this._persistence;this._persistence=e;const o=ft(e,ht.adapter);for(const a in this.keys){const e=this.keys[a];if(t&&mt.includes(a))continue;const s=this._storage.getItem(e);ct(s)||lt(s)||(o.setItem(e,s),this._storage.removeItem(e))}this._storage=o}setStore(e,t,o){if(!this._storage)return;const a={version:o||"localCachev1",content:t},s=JSON.stringify(a);try{this._storage.setItem(e,s)}catch(n){throw n}}getStore(e,t){try{if(!this._storage)return}catch(a){return""}t=t||"localCachev1";const o=this._storage.getItem(e);return o&&o.indexOf(t)>=0?JSON.parse(o).content:""}removeStore(e){this._storage.removeItem(e)}}const yt={},wt={};function _t(e){return yt[e]}class kt{constructor(e,t){this.data=t||null,this.name=e}}class xt extends kt{constructor(e,t){super("error",{error:e,data:t}),this.error=e}}const bt=new class{constructor(){this._listeners={}}on(e,t){return o=e,a=t,(s=this._listeners)[o]=s[o]||[],s[o].push(a),this;var o,a,s}off(e,t){return function(e,t,o){if(o&&o[e]){const a=o[e].indexOf(t);-1!==a&&o[e].splice(a,1)}}(e,t,this._listeners),this}fire(e,t){if(e instanceof xt)return console.error(e.error),this;const o="string"==typeof e?new kt(e,t||{}):e,a=o.name;if(this._listens(a)){o.target=this;const e=this._listeners[a]?[...this._listeners[a]]:[];for(const t of e)t.call(this,o)}return this}_listens(e){return this._listeners[e]&&this._listeners[e].length>0}};function Et(e,t){bt.on(e,t)}function St(e,t={}){bt.fire(e,t)}function Nt(e,t){bt.off(e,t)}const Ct="loginStateChanged",Tt="loginStateExpire",Vt="loginTypeChanged",It="anonymousConverted",At="refreshAccessToken";var Dt;!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL"}(Dt||(Dt={}));class Pt{constructor(){this._fnPromiseMap=new Map}async run(e,t){let o=this._fnPromiseMap.get(e);return o||(o=new Promise((async(o,a)=>{try{await this._runIdlePromise();const a=t();o(await a)}catch(s){a(s)}finally{this._fnPromiseMap.delete(e)}})),this._fnPromiseMap.set(e,o)),o}_runIdlePromise(){return Promise.resolve()}}class Lt{constructor(e){this._singlePromise=new Pt,this._cache=_t(e.env),this._baseURL=`https://${e.env}.ap-shanghai.tcb-api.tencentcloudapi.com`,this._reqClass=new ht.adapter.reqClass({timeout:e.timeout,timeoutMsg:`请求在${e.timeout/1e3}s内未完成，已中断`,restrictedMethods:["post"]})}_getDeviceId(){if(this._deviceID)return this._deviceID;const{deviceIdKey:e}=this._cache.keys;let t=this._cache.getStore(e);return"string"==typeof t&&t.length>=16&&t.length<=48||(t=dt(),this._cache.setStore(e,t)),this._deviceID=t,t}async _request(e,t,o={}){const a={"x-request-id":dt(),"x-device-id":this._getDeviceId()};if(o.withAccessToken){const{tokenTypeKey:e}=this._cache.keys,t=await this.getAccessToken(),o=this._cache.getStore(e);a.authorization=`${o} ${t}`}return this._reqClass["get"===o.method?"get":"post"]({url:`${this._baseURL}${e}`,data:t,headers:a})}async _fetchAccessToken(){const{loginTypeKey:e,accessTokenKey:t,accessTokenExpireKey:o,tokenTypeKey:a}=this._cache.keys,s=this._cache.getStore(e);if(s&&s!==Dt.ANONYMOUS)throw new Fe({code:"INVALID_OPERATION",message:"非匿名登录不支持刷新 access token"});const n=await this._singlePromise.run("fetchAccessToken",(async()=>(await this._request("/auth/v1/signin/anonymously",{},{method:"post"})).data)),{access_token:i,expires_in:r,token_type:c}=n;return this._cache.setStore(a,c),this._cache.setStore(t,i),this._cache.setStore(o,Date.now()+1e3*r),i}isAccessTokenExpired(e,t){let o=!0;return e&&t&&(o=t<Date.now()),o}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,o=this._cache.getStore(e),a=this._cache.getStore(t);return this.isAccessTokenExpired(o,a)?this._fetchAccessToken():o}async refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,loginTypeKey:o}=this._cache.keys;return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.setStore(o,Dt.ANONYMOUS),this.getAccessToken()}async getUserInfo(){return this._singlePromise.run("getUserInfo",(async()=>(await this._request("/auth/v1/user/me",{},{withAccessToken:!0,method:"get"})).data))}}const Ot=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],Bt={"X-SDK-Version":"1.3.5"};function Mt(e,t,o){const a=e[t];e[t]=function(t){const s={},n={};o.forEach((o=>{const{data:a,headers:i}=o.call(e,t);Object.assign(s,a),Object.assign(n,i)}));const i=t.data;return i&&(()=>{var e;if(e=i,"[object FormData]"!==Object.prototype.toString.call(e))t.data={...i,...s};else for(const t in s)i.append(t,s[t])})(),t.headers={...t.headers||{},...n},a.call(e,t)}}function $t(){const e=Math.random().toString(16).slice(2);return{data:{seqId:e},headers:{...Bt,"x-seqid":e}}}class Ft{constructor(e={}){var t;this.config=e,this._reqClass=new ht.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`请求在${this.config.timeout/1e3}s内未完成，已中断`,restrictedMethods:["post"]}),this._cache=_t(this.config.env),this._localCache=(t=this.config.env,wt[t]),this.oauth=new Lt(this.config),Mt(this._reqClass,"post",[$t]),Mt(this._reqClass,"upload",[$t]),Mt(this._reqClass,"download",[$t])}async post(e){return await this._reqClass.post(e)}async upload(e){return await this._reqClass.upload(e)}async download(e){return await this._reqClass.download(e)}async refreshAccessToken(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=await this._refreshAccessTokenPromise}catch(o){t=o}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e}async _refreshAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:o,loginTypeKey:a,anonymousUuidKey:s}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let n=this._cache.getStore(o);if(!n)throw new Fe({message:"未登录CloudBase"});const i={refresh_token:n},r=await this.request("auth.fetchAccessTokenWithRefreshToken",i);if(r.data.code){const{code:e}=r.data;if("SIGN_PARAM_INVALID"===e||"REFRESH_TOKEN_EXPIRED"===e||"INVALID_REFRESH_TOKEN"===e){if(this._cache.getStore(a)===Dt.ANONYMOUS&&"INVALID_REFRESH_TOKEN"===e){const e=this._cache.getStore(s),t=this._cache.getStore(o),a=await this.send("auth.signInAnonymously",{anonymous_uuid:e,refresh_token:t});return this.setRefreshToken(a.refresh_token),this._refreshAccessToken()}St(Tt),this._cache.removeStore(o)}throw new Fe({code:r.data.code,message:`刷新access token失败：${r.data.code}`})}if(r.data.access_token)return St(At),this._cache.setStore(e,r.data.access_token),this._cache.setStore(t,r.data.access_token_expire+Date.now()),{accessToken:r.data.access_token,accessTokenExpire:r.data.access_token_expire};r.data.refresh_token&&(this._cache.removeStore(o),this._cache.setStore(o,r.data.refresh_token),this._refreshAccessToken())}async getAccessToken(){const{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:o}=this._cache.keys;if(!this._cache.getStore(o))throw new Fe({message:"refresh token不存在，登录状态异常"});let a=this._cache.getStore(e),s=this._cache.getStore(t),n=!0;return this._shouldRefreshAccessTokenHook&&!(await this._shouldRefreshAccessTokenHook(a,s))&&(n=!1),(!a||!s||s<Date.now())&&n?this.refreshAccessToken():{accessToken:a,accessTokenExpire:s}}async request(e,t,o){const a=`x-tcb-trace_${this.config.env}`;let s="application/x-www-form-urlencoded";const n={action:e,env:this.config.env,dataVersion:"2019-08-16",...t};let i;if(-1===Ot.indexOf(e)&&(this._cache.keys,n.access_token=await this.oauth.getAccessToken()),"storage.uploadFile"===e){i=new FormData;for(let e in i)i.hasOwnProperty(e)&&void 0!==i[e]&&i.append(e,n[e]);s="multipart/form-data"}else{s="application/json",i={};for(let e in n)void 0!==n[e]&&(i[e]=n[e])}let r={headers:{"content-type":s}};o&&o.timeout&&(r.timeout=o.timeout),o&&o.onUploadProgress&&(r.onUploadProgress=o.onUploadProgress);const c=this._localCache.getStore(a);c&&(r.headers["X-TCB-Trace"]=c);const{parse:l,inQuery:u,search:d}=t;let p={env:this.config.env};l&&(p.parse=!0),u&&(p={...u,...p});let h=function(e,t,o={}){const a=/\?/.test(t);let s="";for(let n in o)""===s?!a&&(t+="?"):s+="&",s+=`${n}=${encodeURIComponent(o[n])}`;return/^http(s)?\:\/\//.test(t+=s)?t:`${e}${t}`}(et,"//tcb-api.tencentcloudapi.com/web",p);d&&(h+=d);const m=await this.post({url:h,data:i,...r}),g=m.header&&m.header["x-tcb-trace"];if(g&&this._localCache.setStore(a,g),200!==Number(m.status)&&200!==Number(m.statusCode)||!m.data)throw new Fe({code:"NETWORK_ERROR",message:"network request error"});return m}async send(e,t={},o={}){const a=await this.request(e,t,{...o,onUploadProgress:t.onUploadProgress});if(("ACCESS_TOKEN_DISABLED"===a.data.code||"ACCESS_TOKEN_EXPIRED"===a.data.code)&&-1===Ot.indexOf(e)){await this.oauth.refreshAccessToken();const a=await this.request(e,t,{...o,onUploadProgress:t.onUploadProgress});if(a.data.code)throw new Fe({code:a.data.code,message:ut(a.data.message)});return a.data}if(a.data.code)throw new Fe({code:a.data.code,message:ut(a.data.message)});return a.data}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:o,refreshTokenKey:a}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(o),this._cache.setStore(a,e)}}const Rt={};function qt(e){return Rt[e]}class Ut{constructor(e){this.config=e,this._cache=_t(e.env),this._request=qt(e.env)}setRefreshToken(e){const{accessTokenKey:t,accessTokenExpireKey:o,refreshTokenKey:a}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(o),this._cache.setStore(a,e)}setAccessToken(e,t){const{accessTokenKey:o,accessTokenExpireKey:a}=this._cache.keys;this._cache.setStore(o,e),this._cache.setStore(a,t)}async refreshUserInfo(){const{data:e}=await this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}}class jt{constructor(e){if(!e)throw new Fe({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=_t(this._envId),this._request=qt(this._envId),this.setUserInfo()}linkWithTicket(e){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}async getLinkedUidList(){const{data:e}=await this._request.send("auth.getLinkedUidList",{});let t=!1;const{users:o}=e;return o.forEach((e=>{e.wxOpenId&&e.wxPublicId&&(t=!0)})),{users:o,hasPrimaryUid:t}}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}async update(e){const{nickName:t,gender:o,avatarUrl:a,province:s,country:n,city:i}=e,{data:r}=await this._request.send("auth.updateUserInfo",{nickName:t,gender:o,avatarUrl:a,province:s,country:n,city:i});this.setLocalUserInfo(r)}async refresh(){const e=await this._request.oauth.getUserInfo();return this.setLocalUserInfo(e),e}setUserInfo(){const{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach((e=>{this[e]=t[e]})),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){const{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}}class zt{constructor(e){if(!e)throw new Fe({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=_t(e);const{refreshTokenKey:t,accessTokenKey:o,accessTokenExpireKey:a}=this._cache.keys,s=this._cache.getStore(t),n=this._cache.getStore(o),i=this._cache.getStore(a);this.credential={refreshToken:s,accessToken:n,accessTokenExpire:i},this.user=new jt(e)}get isAnonymousAuth(){return this.loginType===Dt.ANONYMOUS}get isCustomAuth(){return this.loginType===Dt.CUSTOM}get isWeixinAuth(){return this.loginType===Dt.WECHAT||this.loginType===Dt.WECHAT_OPEN||this.loginType===Dt.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}class Wt extends Ut{async signIn(){this._cache.updatePersistence("local"),await this._request.oauth.getAccessToken(),St(Ct),St(Vt,{env:this.config.env,loginType:Dt.ANONYMOUS,persistence:"local"});const e=new zt(this.config.env);return await e.user.refresh(),e}async linkAndRetrieveDataWithTicket(e){const{anonymousUuidKey:t,refreshTokenKey:o}=this._cache.keys,a=this._cache.getStore(t),s=this._cache.getStore(o),n=await this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:a,refresh_token:s,ticket:e});if(n.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(n.refresh_token),await this._request.refreshAccessToken(),St(It,{env:this.config.env}),St(Vt,{loginType:Dt.CUSTOM,persistence:"local"}),{credential:{refreshToken:n.refresh_token}};throw new Fe({message:"匿名转化失败"})}_setAnonymousUUID(e){const{anonymousUuidKey:t,loginTypeKey:o}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(o,Dt.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}}class Kt extends Ut{async signIn(e){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"ticket must be a string"});const{refreshTokenKey:t}=this._cache.keys,o=await this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(o.refresh_token)return this.setRefreshToken(o.refresh_token),await this._request.refreshAccessToken(),St(Ct),St(Vt,{env:this.config.env,loginType:Dt.CUSTOM,persistence:this.config.persistence}),await this.refreshUserInfo(),new zt(this.config.env);throw new Fe({message:"自定义登录失败"})}}class Ht extends Ut{async signIn(e,t){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"email must be a string"});const{refreshTokenKey:o}=this._cache.keys,a=await this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(o)||""}),{refresh_token:s,access_token:n,access_token_expire:i}=a;if(s)return this.setRefreshToken(s),n&&i?this.setAccessToken(n,i):await this._request.refreshAccessToken(),await this.refreshUserInfo(),St(Ct),St(Vt,{env:this.config.env,loginType:Dt.EMAIL,persistence:this.config.persistence}),new zt(this.config.env);throw a.code?new Fe({code:a.code,message:`邮箱登录失败: ${a.message}`}):new Fe({message:"邮箱登录失败"})}async activate(e){return this._request.send("auth.activateEndUserMail",{token:e})}async resetPasswordWithToken(e,t){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})}}class Jt extends Ut{async signIn(e,t){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"username must be a string"});"string"!=typeof t&&(t="",console.warn("password is empty"));const{refreshTokenKey:o}=this._cache.keys,a=await this._request.send("auth.signIn",{loginType:Dt.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(o)||""}),{refresh_token:s,access_token_expire:n,access_token:i}=a;if(s)return this.setRefreshToken(s),i&&n?this.setAccessToken(i,n):await this._request.refreshAccessToken(),await this.refreshUserInfo(),St(Ct),St(Vt,{env:this.config.env,loginType:Dt.USERNAME,persistence:this.config.persistence}),new zt(this.config.env);throw a.code?new Fe({code:a.code,message:`用户名密码登录失败: ${a.message}`}):new Fe({message:"用户名密码登录失败"})}}class Gt{constructor(e){this.config=e,this._cache=_t(e.env),this._request=qt(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),Et(Vt,this._onLoginTypeChanged)}get currentUser(){const e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new Wt(this.config)}customAuthProvider(){return new Kt(this.config)}emailAuthProvider(){return new Ht(this.config)}usernameAuthProvider(){return new Jt(this.config)}async signInAnonymously(){return new Wt(this.config).signIn()}async signInWithEmailAndPassword(e,t){return new Ht(this.config).signIn(e,t)}signInWithUsernameAndPassword(e,t){return new Jt(this.config).signIn(e,t)}async linkAndRetrieveDataWithTicket(e){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new Wt(this.config)),Et(It,this._onAnonymousConverted),await this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)}async signOut(){if(this.loginType===Dt.ANONYMOUS)throw new Fe({message:"匿名用户不支持登出操作"});const{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:o}=this._cache.keys,a=this._cache.getStore(e);if(!a)return;const s=await this._request.send("auth.logout",{refresh_token:a});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(o),St(Ct),St(Vt,{env:this.config.env,loginType:Dt.NULL,persistence:this.config.persistence}),s}async signUpWithEmailAndPassword(e,t){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})}async sendPasswordResetEmail(e){return this._request.send("auth.sendPasswordResetEmail",{email:e})}onLoginStateChanged(e){Et(Ct,(()=>{const t=this.hasLoginState();e.call(this,t)}));const t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){Et(Tt,e.bind(this))}onAccessTokenRefreshed(e){Et(At,e.bind(this))}onAnonymousConverted(e){Et(It,e.bind(this))}onLoginTypeChanged(e){Et(Vt,(()=>{const t=this.hasLoginState();e.call(this,t)}))}async getAccessToken(){return{accessToken:(await this._request.getAccessToken()).accessToken,env:this.config.env}}hasLoginState(){const{accessTokenKey:e,accessTokenExpireKey:t}=this._cache.keys,o=this._cache.getStore(e),a=this._cache.getStore(t);return this._request.oauth.isAccessTokenExpired(o,a)?null:new zt(this.config.env)}async isUsernameRegistered(e){if("string"!=typeof e)throw new Fe({code:"PARAM_ERROR",message:"username must be a string"});const{data:t}=await this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered}getLoginState(){return Promise.resolve(this.hasLoginState())}async signInWithTicket(e){return new Kt(this.config).signIn(e)}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then((e=>e.code?e:{...e.data,requestId:e.seqId}))}getAuthHeader(){const{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,o=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+o}}_onAnonymousConverted(e){const{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){const{loginType:t,persistence:o,env:a}=e.data;a===this.config.env&&(this._cache.updatePersistence(o),this._cache.setStore(this._cache.keys.loginTypeKey,t))}}const Qt=function(e,t){t=t||rt();const o=qt(this.config.env),{cloudPath:a,filePath:s,onUploadProgress:n,fileType:i="image"}=e;return o.send("storage.getUploadMetadata",{path:a}).then((e=>{const{data:{url:r,authorization:c,token:l,fileId:u,cosFileId:d},requestId:p}=e,h={key:a,signature:c,"x-cos-meta-fileid":d,success_action_status:"201","x-cos-security-token":l};o.upload({url:r,data:h,file:s,name:a,fileType:i,onUploadProgress:n}).then((e=>{201===e.statusCode?t(null,{fileID:u,requestId:p}):t(new Fe({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${e.data}`}))})).catch((e=>{t(e)}))})).catch((e=>{t(e)})),t.promise},Yt=function(e,t){t=t||rt();const o=qt(this.config.env),{cloudPath:a}=e;return o.send("storage.getUploadMetadata",{path:a}).then((e=>{t(null,e)})).catch((e=>{t(e)})),t.promise},Xt=function({fileList:e},t){if(t=t||rt(),!e||!Array.isArray(e))return{code:"INVALID_PARAM",message:"fileList必须是非空的数组"};for(let a of e)if(!a||"string"!=typeof a)return{code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"};const o={fileid_list:e};return qt(this.config.env).send("storage.batchDeleteFile",o).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},Zt=function({fileList:e},t){t=t||rt(),e&&Array.isArray(e)||t(null,{code:"INVALID_PARAM",message:"fileList必须是非空的数组"});let o=[];for(let s of e)"object"==typeof s?(s.hasOwnProperty("fileID")&&s.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是包含fileID和maxAge的对象"}),o.push({fileid:s.fileID,max_age:s.maxAge})):"string"==typeof s?o.push({fileid:s}):t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是字符串"});const a={file_list:o};return qt(this.config.env).send("storage.batchGetDownloadUrl",a).then((e=>{e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((e=>{t(e)})),t.promise},eo=async function({fileID:e},t){const o=(await Zt.call(this,{fileList:[{fileID:e,maxAge:600}]})).fileList[0];if("SUCCESS"!==o.code)return t?t(o):new Promise((e=>{e(o)}));const a=qt(this.config.env);let s=o.download_url;if(s=encodeURI(s),!t)return a.download({url:s});t(await a.download({url:s}))},to=function({name:e,data:t,query:o,parse:a,search:s,timeout:n},i){const r=i||rt();let c;try{c=t?JSON.stringify(t):""}catch(u){return Promise.reject(u)}if(!e)return Promise.reject(new Fe({code:"PARAM_ERROR",message:"函数名不能为空"}));const l={inQuery:o,parse:a,search:s,function_name:e,request_data:c};return qt(this.config.env).send("functions.invokeFunction",l,{timeout:n}).then((e=>{if(e.code)r(null,e);else{let o=e.data.response_data;if(a)r(null,{result:o,requestId:e.requestId});else try{o=JSON.parse(e.data.response_data),r(null,{result:o,requestId:e.requestId})}catch(t){r(new Fe({message:"response data must be json"}))}}return r.promise})).catch((e=>{r(e)})),r.promise},oo={timeout:15e3,persistence:"session"},ao=6e5,so={};class no{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(ht.adapter||(this.requestClient=new ht.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`请求在${(e.timeout||5e3)/1e3}s内未完成，已中断`})),this.config={...oo,...e},!0){case this.config.timeout>ao:console.warn("timeout大于可配置上限[10分钟]，已重置为上限数值"),this.config.timeout=ao;break;case this.config.timeout<100:console.warn("timeout小于可配置下限[100ms]，已重置为下限数值"),this.config.timeout=100}return new no(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;const t=e||ht.adapter.primaryStorage||oo.persistence;var o;return t!==this.config.persistence&&(this.config.persistence=t),function(e){const{env:t}=e;yt[t]=new vt(e),wt[t]=new vt({...e,persistence:"local"})}(this.config),o=this.config,Rt[o.env]=new Ft(o),this.authObj=new Gt(this.config),this.authObj}on(e,t){return Et.apply(this,[e,t])}off(e,t){return Nt.apply(this,[e,t])}callFunction(e,t){return to.apply(this,[e,t])}deleteFile(e,t){return Xt.apply(this,[e,t])}getTempFileURL(e,t){return Zt.apply(this,[e,t])}downloadFile(e,t){return eo.apply(this,[e,t])}uploadFile(e,t){return Qt.apply(this,[e,t])}getUploadMetadata(e,t){return Yt.apply(this,[e,t])}registerExtension(e){so[e.name]=e}async invokeExtension(e,t){const o=so[e];if(!o)throw new Fe({message:`扩展${e} 必须先注册`});return await o.invoke(t,this)}useAdapters(e){const{adapter:t,runtime:o}=function(e){const t=(o=e,"[object Array]"===Object.prototype.toString.call(o)?e:[e]);var o;for(const a of t){const{isMatch:e,genAdapter:t,runtime:o}=a;if(e())return{adapter:t(),runtime:o}}}(e)||{};t&&(ht.adapter=t),o&&(ht.runtime=o)}}var io=new no;function ro(e,t,o){void 0===o&&(o={});var a=/\?/.test(t),s="";for(var n in o)""===s?!a&&(t+="?"):s+="&",s+=n+"="+encodeURIComponent(o[n]);return/^http(s)?:\/\//.test(t+=s)?t:""+e+t}class co{get(e){const{url:t,data:o,headers:a,timeout:s}=e;return new Promise(((e,n)=>{Re.request({url:ro("https:",t),data:o,method:"GET",header:a,timeout:s,success(t){e(t)},fail(e){n(e)}})}))}post(e){const{url:t,data:o,headers:a,timeout:s}=e;return new Promise(((e,n)=>{Re.request({url:ro("https:",t),data:o,method:"POST",header:a,timeout:s,success(t){e(t)},fail(e){n(e)}})}))}upload(e){return new Promise(((t,o)=>{const{url:a,file:s,data:n,headers:i,fileType:r}=e,c=Re.uploadFile({url:ro("https:",a),name:"file",formData:Object.assign({},n),filePath:s,fileType:r,header:i,success(e){const o={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&n.success_action_status&&(o.statusCode=parseInt(n.success_action_status,10)),t(o)},fail(e){o(new Error(e.errMsg||"uploadFile:fail"))}});"function"==typeof e.onUploadProgress&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((t=>{e.onUploadProgress({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend})}))}))}}const lo={setItem(e,t){Re.setStorageSync(e,t)},getItem:e=>Re.getStorageSync(e),removeItem(e){Re.removeStorageSync(e)},clear(){Re.clearStorageSync()}};var uo={genAdapter:function(){return{root:{},reqClass:co,localStorage:lo,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};io.useAdapters(uo);const po=io,ho=po.init;po.init=function(e){e.env=e.spaceId;const t=ho.call(this,e);t.config.provider="tencent",t.config.spaceId=e.spaceId;const o=t.auth;return t.auth=function(e){const t=o.call(this,e);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach((e=>{var o;t[e]=(o=t[e],function(e){e=e||{};const{success:t,fail:a,complete:s}=$e(e);if(!(t||a||s))return o.call(this,e);o.call(this,e).then((e=>{t&&t(e),s&&s(e)}),(e=>{a&&a(e),s&&s(e)}))}).bind(t)})),t},t.customAuth=t.auth,t};var mo=po;async function go(e,t){const o=`http://${e}:${t}/system/ping`;try{const e=await(a={url:o,timeout:500},new Promise(((e,t)=>{Re.request({...a,success(t){e(t)},fail(e){t(e)}})})));return!(!e.data||0!==e.data.code)}catch(s){return!1}var a}const fo={"serverless.file.resource.generateProximalSign":"storage/generate-proximal-sign","serverless.file.resource.report":"storage/report","serverless.file.resource.delete":"storage/delete","serverless.file.resource.getTempFileURL":"storage/get-temp-file-url"};var vo={init(e){const t=new class{constructor(e){if(["spaceId","clientSecret"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),!e.endpoint)throw new Error("集群空间未配置ApiEndpoint，配置后需要重新关联服务空间后生效");this.config=Object.assign({},e),this.config.provider="dcloud",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.adapter=Re}async request(e,t=!0){return e=this.setupRequest(e),Promise.resolve().then((()=>Ye(e,this.adapter.request)))}requestLocal(e){return new Promise(((t,o)=>{this.adapter.request(Object.assign(e,{complete(e){if(e||(e={}),!e.statusCode||e.statusCode>=400){const t=e.data&&e.data.code||"SYS_ERR",a=e.data&&e.data.message||"request:fail";return o(new Fe({code:t,message:a}))}t({success:!0,result:e.data})}}))}))}setupRequest(e){const t=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),o={"Content-Type":"application/json"};o["x-serverless-sign"]=Qe(t,this.config.clientSecret);const a=Ge();o["x-client-info"]=encodeURIComponent(JSON.stringify(a));const{token:s}=Ue();return o["x-client-token"]=s,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(o))}}async setupLocalRequest(e){const t=Ge(),{token:o}=Ue(),a=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now(),clientInfo:t,token:o}),{address:s,servePort:n}=this.__dev__&&this.__dev__.debugInfo||{},{address:i}=await async function(e,t){let o;for(let a=0;a<e.length;a++){const s=e[a];if(await go(s,t)){o=s;break}}return{address:o,port:t}}(s,n);return{url:`http://${i}:${n}/${fo[e.method]}`,method:"POST",data:a,dataType:"json",header:JSON.parse(JSON.stringify({"Content-Type":"application/json"}))}}callFunction(e){const t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(t,!1)}getUploadFileOptions(e){const t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(t)}reportUploadFile(e){const t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(t)}uploadFile({filePath:e,cloudPath:t,fileType:o="image",onUploadProgress:a}){if(!t)throw new Fe({code:"CLOUDPATH_REQUIRED",message:"cloudPath不可为空"});let s;return this.getUploadFileOptions({cloudPath:t}).then((t=>{const{url:n,formData:i,name:r}=t.result;return s=t.result.fileUrl,new Promise(((t,s)=>{const c=this.adapter.uploadFile({url:n,formData:i,name:r,filePath:e,fileType:o,success(e){e&&e.statusCode<400?t(e):s(new Fe({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){s(new Fe({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof a&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((e=>{a({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))})).then((()=>this.reportUploadFile({cloudPath:t}))).then((t=>new Promise(((o,a)=>{t.success?o({success:!0,filePath:e,fileID:s}):a(new Fe({code:"UPLOAD_FAILED",message:"文件上传失败"}))}))))}deleteFile({fileList:e}){const t={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:e})};return this.request(t).then((e=>{if(e.success)return e.result;throw new Fe({code:"DELETE_FILE_FAILED",message:"删除文件失败"})}))}getTempFileURL({fileList:e,maxAge:t}={}){if(!Array.isArray(e)||0===e.length)throw new Fe({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});const o={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:e,maxAge:t})};return this.request(o).then((e=>{if(e.success)return{fileList:e.result.fileList.map((e=>({fileID:e.fileID,tempFileURL:e.tempFileURL})))};throw new Fe({code:"GET_TEMP_FILE_URL_FAILED",message:"获取临时文件链接失败"})}))}}(e),o={signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return o},t.customAuth=t.auth,t}},yo=z((function(e,t){e.exports=K.enc.Hex}));function wo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function _o(e="",t={}){const{data:o,functionName:a,method:s,headers:n,signHeaderKeys:i=[],config:r}=t,c=String(Date.now()),l=wo(),u=Object.assign({},n,{"x-from-app-id":r.spaceAppId,"x-from-env-id":r.spaceId,"x-to-env-id":r.spaceId,"x-from-instance-id":c,"x-from-function-name":a,"x-client-timestamp":c,"x-alipay-source":"client","x-request-id":l,"x-alipay-callid":l,"x-trace-id":l}),d=["x-from-app-id","x-from-env-id","x-to-env-id","x-from-instance-id","x-from-function-name","x-client-timestamp"].concat(i),[p="",h=""]=e.split("?")||[],m=function(e){const t="HMAC-SHA256",o=e.signedHeaders.join(";"),a=e.signedHeaders.map((t=>`${t.toLowerCase()}:${e.headers[t]}\n`)).join(""),s=nt(e.body).toString(yo),n=`${e.method.toUpperCase()}\n${e.path}\n${e.query}\n${a}\n${o}\n${s}\n`,i=nt(n).toString(yo),r=`${t}\n${e.timestamp}\n${i}\n`,c=it(r,e.secretKey).toString(yo);return`${t} Credential=${e.secretId}, SignedHeaders=${o}, Signature=${c}`}({path:p,query:h,method:s,headers:u,timestamp:c,body:JSON.stringify(o),secretId:r.accessKey,secretKey:r.secretKey,signedHeaders:d.sort()});return{url:`${r.endpoint}${e}`,headers:Object.assign({},u,{Authorization:m})}}function ko({url:e,data:t,method:o="POST",headers:a={},timeout:s}){return new Promise(((n,i)=>{Re.request({url:e,method:o,data:"object"==typeof t?JSON.stringify(t):t,header:a,dataType:"json",timeout:s,complete:(e={})=>{const t=a["x-trace-id"]||"";if(!e.statusCode||e.statusCode>=400){const{message:o,errMsg:a,trace_id:s}=e.data||{};return i(new Fe({code:"SYS_ERR",message:o||a||"request:fail",requestId:s||t}))}n({status:e.statusCode,data:e.data,headers:e.header,requestId:t})}})}))}function xo(e,t){const{path:o,data:a,method:s="GET"}=e,{url:n,headers:i}=_o(o,{functionName:"",data:a,method:s,headers:{"x-alipay-cloud-mode":"oss","x-data-api-type":"oss","x-expire-timestamp":Date.now()+6e4},signHeaderKeys:["x-data-api-type","x-expire-timestamp"],config:t});return ko({url:n,data:a,method:s,headers:i}).then((e=>{const t=e.data||{};if(!t.success)throw new Fe({code:e.errCode,message:e.errMsg,requestId:e.requestId});return t.data||{}})).catch((e=>{throw new Fe({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}function bo(e=""){const t=e.trim().replace(/^cloud:\/\//,""),o=t.indexOf("/");if(o<=0)throw new Fe({code:"INVALID_PARAM",message:"fileID不合法"});const a=t.substring(0,o),s=t.substring(o+1);return a!==this.config.spaceId&&console.warn("file ".concat(e," does not belong to env ").concat(this.config.spaceId)),s}function Eo(e=""){return"cloud://".concat(this.config.spaceId,"/").concat(e.replace(/^\/+/,""))}class So{constructor(e){this.config=e}signedURL(e,t={}){const o=`/ws/function/${e}`,a=this.config.wsEndpoint.replace(/^ws(s)?:\/\//,""),s=Object.assign({},t,{accessKeyId:this.config.accessKey,signatureNonce:wo(),timestamp:""+Date.now()}),n=[o,["accessKeyId","authorization","signatureNonce","timestamp"].sort().map((function(e){return s[e]?"".concat(e,"=").concat(s[e]):null})).filter(Boolean).join("&"),`host:${a}`].join("\n"),i=["HMAC-SHA256",nt(n).toString(yo)].join("\n"),r=it(i,this.config.secretKey).toString(yo),c=Object.keys(s).map((e=>`${e}=${encodeURIComponent(s[e])}`)).join("&");return`${this.config.wsEndpoint}${o}?${c}&signature=${r}`}}var No={init:e=>{e.provider="alipay";const t=new class{constructor(e){if(["spaceId","spaceAppId","accessKey","secretKey"].forEach((t=>{if(!Object.prototype.hasOwnProperty.call(e,t))throw new Error(`${t} required`)})),e.endpoint){if("string"!=typeof e.endpoint)throw new Error("endpoint must be string");if(!/^https:\/\//.test(e.endpoint))throw new Error("endpoint must start with https://");e.endpoint=e.endpoint.replace(/\/$/,"")}this.config=Object.assign({},e,{endpoint:e.endpoint||`https://${e.spaceId}.api-hz.cloudbasefunction.cn`,wsEndpoint:e.wsEndpoint||`wss://${e.spaceId}.api-hz.cloudbasefunction.cn`}),this._websocket=new So(this.config)}callFunction(e){return function(e,t){const{name:o,data:a,async:s=!1,timeout:n}=e,i="POST",r={"x-to-function-name":o};s&&(r["x-function-invoke-type"]="async");const{url:c,headers:l}=_o("/functions/invokeFunction",{functionName:o,data:a,method:i,headers:r,signHeaderKeys:["x-to-function-name"],config:t});return ko({url:c,data:a,method:i,headers:l,timeout:n}).then((e=>{let t=0;if(s){const o=e.data||{};t="200"===o.errCode?0:o.errCode,e.data=o.data||{},e.errMsg=o.errMsg}if(0!==t)throw new Fe({code:t,message:e.errMsg,requestId:e.requestId});return{errCode:t,success:0===t,requestId:e.requestId,result:e.data}})).catch((e=>{throw new Fe({code:e.errCode,message:e.errMsg,requestId:e.requestId})}))}(e,this.config)}uploadFileToOSS({url:e,filePath:t,fileType:o,formData:a,onUploadProgress:s}){return new Promise(((n,i)=>{const r=Re.uploadFile({url:e,filePath:t,fileType:o,formData:a,name:"file",success(e){e&&e.statusCode<400?n(e):i(new Fe({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail(e){i(new Fe({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof s&&r&&"function"==typeof r.onProgressUpdate&&r.onProgressUpdate((e=>{s({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}async uploadFile({filePath:e,cloudPath:t="",fileType:o="image",onUploadProgress:a}){if("string"!==ae(t))throw new Fe({code:"INVALID_PARAM",message:"cloudPath必须为字符串类型"});if(!(t=t.trim()))throw new Fe({code:"INVALID_PARAM",message:"cloudPath不可为空"});if(/:\/\//.test(t))throw new Fe({code:"INVALID_PARAM",message:"cloudPath不合法"});const s=await xo({path:"/".concat(t.replace(/^\//,""),"?post_url")},this.config),{file_id:n,upload_url:i,form_data:r}=s,c=r&&r.reduce(((e,t)=>(e[t.key]=t.value,e)),{});return this.uploadFileToOSS({url:i,filePath:e,fileType:o,formData:c,onUploadProgress:a}).then((()=>({fileID:n})))}async getTempFileURL({fileList:e}){return new Promise(((t,o)=>{(!e||e.length<0)&&t({code:"INVALID_PARAM",message:"fileList不能为空数组"}),e.length>50&&t({code:"INVALID_PARAM",message:"fileList数组长度不能超过50"});const a=[];for(const n of e){let e;"string"!==ae(n)&&t({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"});try{e=bo.call(this,n)}catch(s){console.warn(s.errCode,s.errMsg),e=n}a.push({file_id:e,expire:600})}xo({path:"/?download_url",data:{file_list:a},method:"POST"},this.config).then((e=>{const{file_list:o=[]}=e;t({fileList:o.map((e=>({fileID:Eo.call(this,e.file_id),tempFileURL:e.download_url})))})})).catch((e=>o(e)))}))}async connectWebSocket(e){const{name:t,query:o}=e;return Re.connectSocket({url:this._websocket.signedURL(t,o),complete:()=>{}})}}(e);return t.auth=function(){return{signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!0)}}},t}};function Co({data:e}){let t;t=Ge();const o=JSON.parse(JSON.stringify(e||{}));if(Object.assign(o,{clientInfo:t}),!o.uniIdToken){const{token:e}=Ue();e&&(o.uniIdToken=e)}return o}const To=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"，云函数[{functionName}]在云端不存在，请检查此云函数名称是否正确以及该云函数是否已上传到服务空间",mode:"append"}];var Vo=/[\\^$.*+?()[\]{}|]/g,Io=RegExp(Vo.source);function Ao(e,t,o){return e.replace(new RegExp((a=t)&&Io.test(a)?a.replace(Vo,"\\$&"):a,"g"),o);var a}const Do="request",Po="response",Lo="both",Oo="_globalUniCloudStatus",Bo={code:2e4,message:"System error"},Mo={code:20101,message:"Invalid client"};function $o(e){const{errSubject:t,subject:o,errCode:a,errMsg:s,code:n,message:i,cause:r}=e||{};return new Fe({subject:t||o||"uni-secure-network",code:a||n||Bo.code,message:s||i,cause:r})}let Fo;function Ro({secretType:e}={}){return e===Do||e===Po||e===Lo}function qo({name:e,data:t={}}={}){return"DCloud-clientDB"===e&&"encryption"===t.redirectTo&&"getAppClientKey"===t.action}function Uo({functionName:e,result:t,logPvd:o}){}function jo(e){const t=e.callFunction,o=function(o){const a=o.name;o.data=Co.call(e,{data:o.data});const s={aliyun:"aliyun",tencent:"tcb",tcb:"tcb",alipay:"alipay",dcloud:"dcloud"}[this.config.provider],n=Ro(o),i=qo(o),r=n||i;return t.call(this,o).then((e=>(e.errCode=0,!r&&Uo.call(this,{functionName:a,result:e,logPvd:s}),Promise.resolve(e))),(e=>(!r&&Uo.call(this,{functionName:a,result:e,logPvd:s}),e&&e.message&&(e.message=function({message:e="",extraInfo:t={},formatter:o=[]}={}){for(let a=0;a<o.length;a++){const{rule:s,content:n,mode:i}=o[a],r=e.match(s);if(!r)continue;let c=n;for(let e=1;e<r.length;e++)c=Ao(c,`{$${e}}`,r[e]);for(const e in t)c=Ao(c,`{${e}}`,t[e]);return"replace"===i?c:e+c}return e}({message:`[${o.name}]: ${e.message}`,formatter:To,extraInfo:{functionName:a}})),Promise.reject(e))))};e.callFunction=function(t){const{provider:a,spaceId:s}=e.config,n=t.name;let i,r;return t.data=t.data||{},i=o,i=i.bind(e),r=qo(t)?o.call(e,t):Ro(t)?new Fo({secretType:t.secretType,uniCloudIns:e}).wrapEncryptDataCallFunction(o.bind(e))(t):function({provider:e,spaceId:t,functionName:o}={}){const{appId:a,uniPlatform:s,osName:n}=Ke();let i=s;"app"===s&&(i=n);const r=function({provider:e,spaceId:t}={}){const o=de;if(!o)return{};e=function(e){return"tencent"===e?"tcb":e}(e);const a=o.find((o=>o.provider===e&&o.spaceId===t));return a&&a.config}({provider:e,spaceId:t});if(!r||!r.accessControl||!r.accessControl.enable)return!1;const c=r.accessControl.function||{},l=Object.keys(c);if(0===l.length)return!0;const u=function(e,t){let o,a,s;for(let n=0;n<e.length;n++){const i=e[n];i!==t?"*"!==i?i.split(",").map((e=>e.trim())).indexOf(t)>-1&&(a=i):s=i:o=i}return o||a||s}(l,o);if(!u)return!1;if((c[u]||[]).find(((e={})=>e.appId===a&&(e.platform||"").toLowerCase()===i.toLowerCase())))return!0;throw console.error(`此应用[appId: ${a}, platform: ${i}]不在云端配置的允许访问的应用列表内，参考：https://uniapp.dcloud.net.cn/uniCloud/secure-network.html#verify-client`),$o(Mo)}({provider:a,spaceId:s,functionName:n})?new Fo({secretType:t.secretType,uniCloudIns:e}).wrapVerifyClientCallFunction(o.bind(e))(t):i(t),Object.defineProperty(r,"result",{get:()=>(console.warn("当前返回结果为Promise类型，不可直接访问其result属性，详情请参考：https://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),r.then((e=>e))}}Fo=class{constructor(){throw $o({message:"Platform app is not enabled, please check whether secure network module is enabled in your manifest.json"})}};const zo=Symbol("CLIENT_DB_INTERNAL");function Wo(e,t){return e.then="DoNotReturnProxyWithAFunctionNamedThen",e._internalType=zo,e.inspect=null,e.__v_raw=void 0,new Proxy(e,{get(e,o,a){if("_uniClient"===o)return null;if("symbol"==typeof o)return e[o];if(o in e||"string"!=typeof o){const t=e[o];return"function"==typeof t?t.bind(e):t}return t.get(e,o,a)}})}function Ko(e){return{on:(t,o)=>{e[t]=e[t]||[],e[t].indexOf(o)>-1||e[t].push(o)},off:(t,o)=>{e[t]=e[t]||[];const a=e[t].indexOf(o);-1!==a&&e[t].splice(a,1)}}}const Ho=["db.Geo","db.command","command.aggregate"];function Jo(e,t){return Ho.indexOf(`${e}.${t}`)>-1}function Go(e){switch(ae(e=qe(e))){case"array":return e.map((e=>Go(e)));case"object":return e._internalType===zo||Object.keys(e).forEach((t=>{e[t]=Go(e[t])})),e;case"regexp":return{$regexp:{source:e.source,flags:e.flags}};case"date":return{$date:e.toISOString()};default:return e}}function Qo(e){return e&&e.content&&e.content.$method}class Yo{constructor(e,t,o){this.content=e,this.prevStage=t||null,this.udb=null,this._database=o}toJSON(){let e=this;const t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map((e=>({$method:e.$method,$param:Go(e.$param)})))}}toString(){return JSON.stringify(this.toJSON())}getAction(){const e=this.toJSON().$db.find((e=>"action"===e.$method));return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter((e=>"action"!==e.$method))}}get isAggregate(){let e=this;for(;e;){const t=Qo(e),o=Qo(e.prevStage);if("aggregate"===t&&"collection"===o||"pipeline"===t)return!0;e=e.prevStage}return!1}get isCommand(){let e=this;for(;e;){if("command"===Qo(e))return!0;e=e.prevStage}return!1}get isAggregateCommand(){let e=this;for(;e;){const t=Qo(e),o=Qo(e.prevStage);if("aggregate"===t&&"command"===o)return!0;e=e.prevStage}return!1}getNextStageFn(e){const t=this;return function(){return Xo({$method:e,$param:Go(Array.from(arguments))},t,t._database)}}get count(){return this.isAggregate?this.getNextStageFn("count"):function(){return this._send("count",Array.from(arguments))}}get remove(){return this.isCommand?this.getNextStageFn("remove"):function(){return this._send("remove",Array.from(arguments))}}get(){return this._send("get",Array.from(arguments))}get add(){return this.isCommand?this.getNextStageFn("add"):function(){return this._send("add",Array.from(arguments))}}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}get set(){return this.isCommand?this.getNextStageFn("set"):function(){throw new Error("JQL禁止使用set方法")}}_send(e,t){const o=this.getAction(),a=this.getCommand();return a.$db.push({$method:e,$param:Go(t)}),this._database._callCloudFunction({action:o,command:a})}}function Xo(e,t,o){return Wo(new Yo(e,t,o),{get(e,t){let a="db";return e&&e.content&&(a=e.content.$method),Jo(a,t)?Xo({$method:t},e,o):function(){return Xo({$method:t,$param:Go(Array.from(arguments))},e,o)}}})}function Zo({path:e,method:t}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...e.map((e=>({$method:e}))),{$method:t,$param:this.param}]}}toString(){return JSON.stringify(this.toJSON())}}}function ea(e,t={}){return Wo(new e(t),{get:(e,t)=>Jo("db",t)?Xo({$method:t},null,e):function(){return Xo({$method:t,$param:Go(Array.from(arguments))},null,e)}})}class ta extends class{constructor({uniClient:e={},isJQL:t=!1}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e._isDefault&&(this._dbCallBacks=fe("_globalUniCloudDatabaseCallback")),t||(this.auth=Ko(this._authCallBacks)),this._isJQL=t,Object.assign(this,Ko(this._dbCallBacks)),this.env=Wo({},{get:(e,t)=>({$env:t})}),this.Geo=Wo({},{get:(e,t)=>Zo({path:["Geo"],method:t})}),this.serverDate=Zo({path:[],method:"serverDate"}),this.RegExp=Zo({path:[],method:"RegExp"})}getCloudEnv(e){if("string"!=typeof e||!e.trim())throw new Error("getCloudEnv参数错误");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){const o=this._dbCallBacks;o[e]&&o[e].forEach((e=>{e(...t)}))}_callbackAuth(e,t){const o=this._authCallBacks;o[e]&&o[e].forEach((e=>{e(...t)}))}multiSend(){const e=Array.from(arguments),t=e.map((e=>{const t=e.getAction(),o=e.getCommand();if("getTemp"!==o.$db[o.$db.length-1].$method)throw new Error("multiSend只支持子命令内使用getTemp");return{action:t,command:o}}));return this._callCloudFunction({multiCommand:t,queryList:e})}}{_parseResult(e){return this._isJQL?e.result:e}_callCloudFunction({action:e,command:t,multiCommand:o,queryList:a}){function s(e,t){if(o&&a)for(let o=0;o<a.length;o++){const s=a[o];s.udb&&"function"==typeof s.udb.setResult&&(t?s.udb.setResult(t):s.udb.setResult(e.result.dataList[o]))}}const n=this,i=this._isJQL?"databaseForJQL":"database";function r(e){return n._callback("error",[e]),ke(xe(i,"fail"),e).then((()=>ke(xe(i,"complete"),e))).then((()=>(s(null,e),Le(Se,{type:Te,content:e}),Promise.reject(e))))}const c=ke(xe(i,"invoke")),l=this._uniClient;return c.then((()=>l.callFunction({name:"DCloud-clientDB",type:ee,data:{action:e,command:t,multiCommand:o}}))).then((e=>{const{code:t,message:o,token:a,tokenExpired:c,systemInfo:l=[]}=e.result;if(l)for(let s=0;s<l.length;s++){const{level:e,message:t,detail:o}=l[s];let a="[System Info]"+t;o&&(a=`${a}\n详细信息：${o}`),(console["warn"===e?"error":e]||console.log)(a)}if(t)return r(new Fe({code:t,message:o,requestId:e.requestId}));e.result.errCode=e.result.errCode||e.result.code,e.result.errMsg=e.result.errMsg||e.result.message,a&&c&&(je({token:a,tokenExpired:c}),this._callbackAuth("refreshToken",[{token:a,tokenExpired:c}]),this._callback("refreshToken",[{token:a,tokenExpired:c}]),Le(Ce,{token:a,tokenExpired:c}));const u=[{prop:"affectedDocs",tips:"affectedDocs不再推荐使用，请使用inserted/deleted/updated/data.length替代"},{prop:"code",tips:"code不再推荐使用，请使用errCode替代"},{prop:"message",tips:"message不再推荐使用，请使用errMsg替代"}];for(let s=0;s<u.length;s++){const{prop:t,tips:o}=u[s];if(t in e.result){const a=e.result[t];Object.defineProperty(e.result,t,{get:()=>(console.warn(o),a)})}}return d=e,ke(xe(i,"success"),d).then((()=>ke(xe(i,"complete"),d))).then((()=>{s(d,null);const e=n._parseResult(d);return Le(Se,{type:Te,content:e}),Promise.resolve(e)}));var d}),(e=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(e.message)&&console.warn("clientDB未初始化，请在web控制台保存一次schema以开启clientDB"),r(new Fe({code:e.code||"SYSTEM_ERROR",message:e.message,requestId:e.requestId})))))}}const oa="token无效，跳转登录页面",aa="token过期，跳转登录页面",sa={TOKEN_INVALID_TOKEN_EXPIRED:aa,TOKEN_INVALID_INVALID_CLIENTID:oa,TOKEN_INVALID:oa,TOKEN_INVALID_WRONG_TOKEN:oa,TOKEN_INVALID_ANONYMOUS_USER:oa},na={"uni-id-token-expired":aa,"uni-id-check-token-failed":oa,"uni-id-token-not-exist":oa,"uni-id-check-device-feature-failed":oa},ia={...sa,...na,default:"用户未登录或登录状态过期，自动跳转登录页面"};function ra(e,t){let o="";return o=e?`${e}/${t}`:t,o.replace(/^\//,"")}function ca(e=[],t=""){const o=[],a=[];return e.forEach((e=>{!0===e.needLogin?o.push(ra(t,e.path)):!1===e.needLogin&&a.push(ra(t,e.path))})),{needLoginPage:o,notNeedLoginPage:a}}function la(e){return e.split("?")[0].replace(/^\//,"")}function ua(){return function(e){let t=e&&e.$page&&e.$page.fullPath;return t?("/"!==t.charAt(0)&&(t="/"+t),t):""}(function(){const e=getCurrentPages();return e[e.length-1]}())}function da(){return la(ua())}function pa(e="",t={}){if(!e)return!1;if(!(t&&t.list&&t.list.length))return!1;const o=t.list,a=la(e);return o.some((e=>e.pagePath===a))}const ha=!!j.uniIdRouter,{loginPage:ma,routerNeedLogin:ga,resToLogin:fa,needLoginPage:va,notNeedLoginPage:ya,loginPageInTabBar:wa}=function({pages:e=[],subPackages:t=[],uniIdRouter:o={},tabBar:a={}}=j){const{loginPage:s,needLogin:n=[],resToLogin:i=!0}=o,{needLoginPage:r,notNeedLoginPage:c}=ca(e),{needLoginPage:l,notNeedLoginPage:u}=function(e=[]){const t=[],o=[];return e.forEach((e=>{const{root:a,pages:s=[]}=e,{needLoginPage:n,notNeedLoginPage:i}=ca(s,a);t.push(...n),o.push(...i)})),{needLoginPage:t,notNeedLoginPage:o}}(t);return{loginPage:s,routerNeedLogin:n,resToLogin:i,needLoginPage:[...r,...l],notNeedLoginPage:[...c,...u],loginPageInTabBar:pa(s,a)}}();if(va.indexOf(ma)>-1)throw new Error(`Login page [${ma}] should not be "needLogin", please check your pages.json`);function _a(e){const t=da();if("/"===e.charAt(0))return e;const[o,a]=e.split("?"),s=o.replace(/^\//,"").split("/"),n=t.split("/");n.pop();for(let i=0;i<s.length;i++){const e=s[i];".."===e?n.pop():"."!==e&&n.push(e)}return""===n[0]&&n.shift(),"/"+n.join("/")+(a?"?"+a:"")}function ka({redirect:e}){const t=la(e),o=la(ma);return da()!==o&&t!==o}function xa({api:e,redirect:t}={}){if(!t||!ka({redirect:t}))return;const o=(s=t,"/"!==(a=ma).charAt(0)&&(a="/"+a),s?a.indexOf("?")>-1?a+`&uniIdRedirectUrl=${encodeURIComponent(s)}`:a+`?uniIdRedirectUrl=${encodeURIComponent(s)}`:a);var a,s;wa?"navigateTo"!==e&&"redirectTo"!==e||(e="switchTab"):"switchTab"===e&&(e="navigateTo");const n={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,switchTab:uni.switchTab,reLaunch:uni.reLaunch};setTimeout((()=>{n[e]({url:o})}),0)}function ba({url:e}={}){const t={abortLoginPageJump:!1,autoToLoginPage:!1},o=function(){const{token:e,tokenExpired:t}=Ue();let o;if(e){if(t<Date.now()){const e="uni-id-token-expired";o={errCode:e,errMsg:ia[e]}}}else{const e="uni-id-check-token-failed";o={errCode:e,errMsg:ia[e]}}return o}();if(function(e){const t=la(_a(e));return!(ya.indexOf(t)>-1)&&(va.indexOf(t)>-1||ga.some((t=>{return o=e,new RegExp(t).test(o);var o})))}(e)&&o){if(o.uniIdRedirectUrl=e,Ae(Ne).length>0)return setTimeout((()=>{Le(Ne,o)}),0),t.abortLoginPageJump=!0,t;t.autoToLoginPage=!0}return t}function Ea(){!function(){const e=ua(),{abortLoginPageJump:t,autoToLoginPage:o}=ba({url:e});t||o&&xa({api:"redirectTo",redirect:e})}();const e=["navigateTo","redirectTo","reLaunch","switchTab"];for(let t=0;t<e.length;t++){const o=e[t];uni.addInterceptor(o,{invoke(e){const{abortLoginPageJump:t,autoToLoginPage:a}=ba({url:e.url});return t?e:a?(xa({api:o,redirect:_a(e.url)}),!1):e}})}}function Sa(){this.onResponse((e=>{const{type:t,content:o}=e;let a=!1;switch(t){case"cloudobject":a=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in ia}(o);break;case"clientdb":a=function(e){if("object"!=typeof e)return!1;const{errCode:t}=e||{};return t in sa}(o)}a&&function(e={}){const t=Ae(Ne);Me().then((()=>{const o=ua();if(o&&ka({redirect:o}))return t.length>0?Le(Ne,Object.assign({uniIdRedirectUrl:o},e)):void(ma&&xa({api:"navigateTo",redirect:o}))}))}(o)}))}function Na(e){var t;(t=e).onResponse=function(e){De(Se,e)},t.offResponse=function(e){Pe(Se,e)},function(e){e.onNeedLogin=function(e){De(Ne,e)},e.offNeedLogin=function(e){Pe(Ne,e)},ha&&(fe(Oo).needLoginInit||(fe(Oo).needLoginInit=!0,Me().then((()=>{Ea.call(e)})),fa&&Sa.call(e)))}(e),function(e){e.onRefreshToken=function(e){De(Ce,e)},e.offRefreshToken=function(e){Pe(Ce,e)}}(e)}let Ca;const Ta="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Va=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function Ia(){const e=Ue().token||"",t=e.split(".");if(!e||3!==t.length)return{uid:null,role:[],permission:[],tokenExpired:0};let o;try{o=JSON.parse((a=t[1],decodeURIComponent(Ca(a).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(s){throw new Error("获取当前用户信息出错，详细错误信息为："+s.message)}var a;return o.tokenExpired=1e3*o.exp,delete o.exp,delete o.iat,o}Ca="function"!=typeof atob?function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!Va.test(e))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var o,a,s="",n=0;n<e.length;)t=Ta.indexOf(e.charAt(n++))<<18|Ta.indexOf(e.charAt(n++))<<12|(o=Ta.indexOf(e.charAt(n++)))<<6|(a=Ta.indexOf(e.charAt(n++))),s+=64===o?String.fromCharCode(t>>16&255):64===a?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return s}:atob;var Aa=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(z((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const o="chooseAndUploadFile:ok",a="chooseAndUploadFile:fail";function s(e,t){return e.tempFiles.forEach(((e,o)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+o+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function n(e,t,{onChooseFile:a,onUploadProgress:s}){return t.then((e=>{if(a){const t=a(e);if(void 0!==t)return Promise.resolve(t).then((t=>void 0===t?e:t))}return e})).then((t=>!1===t?{errMsg:o,tempFilePaths:[],tempFiles:[]}:function(e,t,a=5,s){(t=Object.assign({},t)).errMsg=o;const n=t.tempFiles,i=n.length;let r=0;return new Promise((o=>{for(;r<a;)c();function c(){const a=r++;if(a>=i)return void(!n.find((e=>!e.url&&!e.errMsg))&&o(t));const l=n[a];e.uploadFile({provider:l.provider,filePath:l.path,cloudPath:l.cloudPath,fileType:l.fileType,cloudPathAsRealPath:l.cloudPathAsRealPath,onUploadProgress(e){e.index=a,e.tempFile=l,e.tempFilePath=l.path,s&&s(e)}}).then((e=>{l.url=e.fileID,a<i&&c()})).catch((e=>{l.errMsg=e.errMsg||e.message,a<i&&c()}))}}))}(e,t,5,s)))}t.initChooseAndUploadFile=function(e){return function(t={type:"all"}){return"image"===t.type?n(e,function(e){const{count:t,sizeType:o,sourceType:n=["album","camera"],extension:i}=e;return new Promise(((e,r)=>{uni.chooseImage({count:t,sizeType:o,sourceType:n,extension:i,success(t){e(s(t,"image"))},fail(e){r({errMsg:e.errMsg.replace("chooseImage:fail",a)})}})}))}(t),t):"video"===t.type?n(e,function(e){const{camera:t,compressed:o,maxDuration:n,sourceType:i=["album","camera"],extension:r}=e;return new Promise(((e,c)=>{uni.chooseVideo({camera:t,compressed:o,maxDuration:n,sourceType:i,extension:r,success(t){const{tempFilePath:o,duration:a,size:n,height:i,width:r}=t;e(s({errMsg:"chooseVideo:ok",tempFilePaths:[o],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:o,size:n,type:t.tempFile&&t.tempFile.type||"",width:r,height:i,duration:a,fileType:"video",cloudPath:""}]},"video"))},fail(e){c({errMsg:e.errMsg.replace("chooseVideo:fail",a)})}})}))}(t),t):n(e,function(e){const{count:t,extension:o}=e;return new Promise(((e,n)=>{let i=uni.chooseFile;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(i=wx.chooseMessageFile),"function"!=typeof i)return n({errMsg:a+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});i({type:"all",count:t,extension:o,success(t){e(s(t))},fail(e){n({errMsg:e.errMsg.replace("chooseFile:fail",a)})}})}))}(t),t)}}})));const Da="manual";function Pa(e){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{},mixinDatacomError:null}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach((t=>{e.push(this[t])})),e}),((e,t)=>{if(this.loadtime===Da)return;let o=!1;const a=[];for(let s=2;s<e.length;s++)e[s]!==t[s]&&(a.push(e[s]),o=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(o,a)}))},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:o}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomError=null,this.mixinDatacomGet().then((o=>{this.mixinDatacomLoading=!1;const{data:a,count:s}=o.result;this.getcount&&(this.mixinDatacomPage.count=s),this.mixinDatacomHasMore=a.length<this.pageSize;const n=e?a.length?a[0]:void 0:a;this.mixinDatacomResData=n,t&&t(n)})).catch((e=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=e,this.mixinDatacomError=e,o&&o(e)})))},mixinDatacomGet(t={}){let o;t=t||{},o="undefined"!=typeof __uniX&&__uniX?e.databaseForJQL(this.spaceInfo):e.database(this.spaceInfo);const a=t.action||this.action;a&&(o=o.action(a));const s=t.collection||this.collection;o=Array.isArray(s)?o.collection(...s):o.collection(s);const n=t.where||this.where;n&&Object.keys(n).length&&(o=o.where(n));const i=t.field||this.field;i&&(o=o.field(i));const r=t.foreignKey||this.foreignKey;r&&(o=o.foreignKey(r));const c=t.groupby||this.groupby;c&&(o=o.groupBy(c));const l=t.groupField||this.groupField;l&&(o=o.groupField(l)),!0===(void 0!==t.distinct?t.distinct:this.distinct)&&(o=o.distinct());const u=t.orderby||this.orderby;u&&(o=o.orderBy(u));const d=void 0!==t.pageCurrent?t.pageCurrent:this.mixinDatacomPage.current,p=void 0!==t.pageSize?t.pageSize:this.mixinDatacomPage.size,h=void 0!==t.getcount?t.getcount:this.getcount,m=void 0!==t.gettree?t.gettree:this.gettree,g=void 0!==t.gettreepath?t.gettreepath:this.gettreepath,f={getCount:h},v={limitLevel:void 0!==t.limitlevel?t.limitlevel:this.limitlevel,startWith:void 0!==t.startwith?t.startwith:this.startwith};return m&&(f.getTree=v),g&&(f.getTreePath=v),o=o.skip(p*(d-1)).limit(p).get(f),o}}}}function La(e){return fe("_globalUniCloudSecureNetworkCache__{spaceId}".replace("{spaceId}",e.config.spaceId))}async function Oa({openid:e,callLoginByWeixin:t=!1}={}){throw La(this),new Error("[SecureNetwork] API `initSecureNetworkByWeixin` is not supported on platform `app`")}async function Ba(e){const t=La(this);return t.initPromise||(t.initPromise=Oa.call(this,e).then((e=>e)).catch((e=>{throw delete t.initPromise,e}))),t.initPromise}function Ma(e){Je=e}function $a(e){const t={getAppBaseInfo:uni.getSystemInfo,getPushClientId:uni.getPushClientId};return function(o){return new Promise(((a,s)=>{t[e]({...o,success(e){a(e)},fail(e){s(e)}})}))}}class Fa extends class{constructor(){this._callback={}}addListener(e,t){this._callback[e]||(this._callback[e]=[]),this._callback[e].push(t)}on(e,t){return this.addListener(e,t)}removeListener(e,t){if(!t)throw new Error('The "listener" argument must be of type function. Received undefined');const o=this._callback[e];if(!o)return;const a=function(e,t){for(let o=e.length-1;o>=0;o--)if(e[o]===t)return o;return-1}(o,t);o.splice(a,1)}off(e,t){return this.removeListener(e,t)}removeAllListener(e){delete this._callback[e]}emit(e,...t){const o=this._callback[e];if(o)for(let a=0;a<o.length;a++)o[a](...t)}}{constructor(){super(),this._uniPushMessageCallback=this._receivePushMessage.bind(this),this._currentMessageId=-1,this._payloadQueue=[]}init(){return Promise.all([$a("getAppBaseInfo")(),$a("getPushClientId")()]).then((([{appId:e}={},{cid:t}={}]=[])=>{if(!e)throw new Error("Invalid appId, please check the manifest.json file");if(!t)throw new Error("Invalid push client id");this._appId=e,this._pushClientId=t,this._seqId=Date.now()+"-"+Math.floor(9e5*Math.random()+1e5),this.emit("open"),this._initMessageListener()}),(e=>{throw this.emit("error",e),this.close(),e}))}async open(){return this.init()}_isUniCloudSSE(e){if("receive"!==e.type)return!1;const t=e&&e.data&&e.data.payload;return!(!t||"UNI_CLOUD_SSE"!==t.channel||t.seqId!==this._seqId)}_receivePushMessage(e){if(!this._isUniCloudSSE(e))return;const t=e&&e.data&&e.data.payload,{action:o,messageId:a,message:s}=t;this._payloadQueue.push({action:o,messageId:a,message:s}),this._consumMessage()}_consumMessage(){for(;;){const e=this._payloadQueue.find((e=>e.messageId===this._currentMessageId+1));if(!e)break;this._currentMessageId++,this._parseMessagePayload(e)}}_parseMessagePayload(e){const{action:t,messageId:o,message:a}=e;"end"===t?this._end({messageId:o,message:a}):"message"===t&&this._appendMessage({messageId:o,message:a})}_appendMessage({messageId:e,message:t}={}){this.emit("message",t)}_end({messageId:e,message:t}={}){this.emit("end",t),this.close()}_initMessageListener(){uni.onPushMessage(this._uniPushMessageCallback)}_destroy(){uni.offPushMessage(this._uniPushMessageCallback)}toJSON(){return{appId:this._appId,pushClientId:this._pushClientId,seqId:this._seqId}}close(){this._destroy(),this.emit("close")}}const Ra={tcb:mo,tencent:mo,aliyun:Ze,private:vo,dcloud:vo,alipay:No};let qa=new class{init(e){let t={};const o=Ra[e.provider];if(!o)throw new Error("未提供正确的provider参数");var a;return t=o.init(e),function(e){e._initPromiseHub||(e._initPromiseHub=new le({createPromise:function(){let t=Promise.resolve();t=new Promise((e=>{setTimeout((()=>{e()}),1)}));const o=e.auth();return t.then((()=>o.getLoginState())).then((e=>e?Promise.resolve():o.signInAnonymously()))}}))}(t),jo(t),function(e){const t=e.uploadFile;e.uploadFile=function(e){return t.call(this,e)}}(t),(a=t).database=function(e){if(e&&Object.keys(e).length>0)return a.init(e).database();if(this._database)return this._database;const t=ea(ta,{uniClient:a});return this._database=t,t},a.databaseForJQL=function(e){if(e&&Object.keys(e).length>0)return a.init(e).databaseForJQL();if(this._databaseForJQL)return this._databaseForJQL;const t=ea(ta,{uniClient:a,isJQL:!0});return this._databaseForJQL=t,t},function(e){e.getCurrentUserInfo=Ia,e.chooseAndUploadFile=Aa.initChooseAndUploadFile(e),Object.assign(e,{get mixinDatacom(){return Pa(e)}}),e.SSEChannel=Fa,e.initSecureNetworkByWeixin=function(e){return function({openid:t,callLoginByWeixin:o=!1}={}){return Ba.call(e,{openid:t,callLoginByWeixin:o})}}(e),e.setCustomClientInfo=Ma,e.importObject=function(t){return function(o,a={}){a=function(e,t={}){return e.customUI=t.customUI||e.customUI,e.parseSystemError=t.parseSystemError||e.parseSystemError,Object.assign(e.loadingOptions,t.loadingOptions),Object.assign(e.errorOptions,t.errorOptions),"object"==typeof t.secretMethods&&(e.secretMethods=t.secretMethods),e}({customUI:!1,loadingOptions:{title:"加载中...",mask:!0},errorOptions:{type:"modal",retry:!1}},a);const{customUI:s,loadingOptions:n,errorOptions:i,parseSystemError:r}=a,c=!s;return new Proxy({},{get(s,l){switch(l){case"toString":return"[object UniCloudObject]";case"toJSON":return{}}return function({fn:e,interceptorName:t,getCallbackArgs:o}={}){return async function(...a){const s=o?o({params:a}):{};let n,i;try{return await ke(xe(t,"invoke"),{...s}),n=await e(...a),await ke(xe(t,"success"),{...s,result:n}),n}catch(r){throw i=r,await ke(xe(t,"fail"),{...s,error:i}),i}finally{await ke(xe(t,"complete"),i?{...s,error:i}:{...s,result:n})}}}({fn:async function s(...u){let d;c&&uni.showLoading({title:n.title,mask:n.mask});const p={name:o,type:Z,data:{method:l,params:u}};"object"==typeof a.secretMethods&&function(e,t){const o=t.data.method,a=e.secretMethods||{},s=a[o]||a["*"];s&&(t.secretType=s)}(a,p);let h=!1;try{d=await t.callFunction(p)}catch(e){h=!0,d={result:new Fe(e)}}const{errSubject:m,errCode:g,errMsg:f,newToken:v}=d.result||{};if(c&&uni.hideLoading(),v&&v.token&&v.tokenExpired&&(je(v),Le(Ce,{...v})),g){let e=f;if(h&&r&&(e=(await r({objectName:o,methodName:l,params:u,errSubject:m,errCode:g,errMsg:f})).errMsg||f),c)if("toast"===i.type)uni.showToast({title:e,icon:"none"});else{if("modal"!==i.type)throw new Error(`Invalid errorOptions.type: ${i.type}`);{const{confirm:t}=await async function({title:e,content:t,showCancel:o,cancelText:a,confirmText:s}={}){return new Promise(((n,i)=>{uni.showModal({title:e,content:t,showCancel:o,cancelText:a,confirmText:s,success(e){n(e)},fail(){n({confirm:!1,cancel:!0})}})}))}({title:"提示",content:e,showCancel:i.retry,cancelText:"取消",confirmText:i.retry?"重试":"确定"});if(i.retry&&t)return s(...u)}}const t=new Fe({subject:m,code:g,message:f,requestId:d.requestId});throw t.detail=d.result,Le(Se,{type:Ie,content:t}),t}return Le(Se,{type:Ie,content:d.result}),d.result},interceptorName:"callObject",getCallbackArgs:function({params:e}={}){return{objectName:o,methodName:l,params:e}}})}})}}(e)}(t),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach((e=>{if(!t[e])return;const o=t[e];t[e]=function(){return o.apply(t,Array.from(arguments))},t[e]=function(e,t){return function(o){let a=!1;if("callFunction"===t){const e=o&&o.type||X;a=e!==X}const s="callFunction"===t&&!a,n=this._initPromiseHub.exec();o=o||{};const{success:i,fail:r,complete:c}=$e(o),l=n.then((()=>a?Promise.resolve():ke(xe(t,"invoke"),o))).then((()=>e.call(this,o))).then((e=>a?Promise.resolve(e):ke(xe(t,"success"),e).then((()=>ke(xe(t,"complete"),e))).then((()=>(s&&Le(Se,{type:Ve,content:e}),Promise.resolve(e))))),(e=>a?Promise.reject(e):ke(xe(t,"fail"),e).then((()=>ke(xe(t,"complete"),e))).then((()=>(Le(Se,{type:Ve,content:e}),Promise.reject(e))))));if(!(i||r||c))return l;l.then((e=>{i&&i(e),c&&c(e),s&&Le(Se,{type:Ve,content:e})}),(e=>{r&&r(e),c&&c(e),s&&Le(Se,{type:Ve,content:e})}))}}(t[e],e).bind(t)})),t.init=this.init,t}};(()=>{const e=pe;let t={};if(e&&1===e.length)t=e[0],qa=qa.init(t),qa._isDefault=!0;else{const t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile"],o=["database","getCurrentUserInfo","importObject"];let a;a=e&&e.length>0?"应用有多个服务空间，请通过uniCloud.init方法指定要使用的服务空间":"应用未关联服务空间，请在uniCloud目录右键关联服务空间",[...t,...o].forEach((e=>{qa[e]=function(){if(console.error(a),-1===o.indexOf(e))return Promise.reject(new Fe({code:"SYS_ERR",message:a}));console.error(a)}}))}Object.assign(qa,{get mixinDatacom(){return Pa(qa)}}),Na(qa),qa.addInterceptor=we,qa.removeInterceptor=_e,qa.interceptObject=be,uni.__uniCloud=qa;{const e=me||(me=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;function e(){return this}return void 0!==e()?e():new Function("return this")()}(),me);e.uniCloud=qa,e.UniCloudError=Fe}})();var Ua=qa;const ja=n({components:{Loading1:n({name:"loading1",data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container loading1"},[e.createElementVNode("view",{class:"shape shape1"}),e.createElementVNode("view",{class:"shape shape2"}),e.createElementVNode("view",{class:"shape shape3"}),e.createElementVNode("view",{class:"shape shape4"})])}],["__scopeId","data-v-a16ea79e"]]),Loading2:n({name:"loading2",data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container loading2"},[e.createElementVNode("view",{class:"shape shape1"}),e.createElementVNode("view",{class:"shape shape2"}),e.createElementVNode("view",{class:"shape shape3"}),e.createElementVNode("view",{class:"shape shape4"})])}],["__scopeId","data-v-51d40d8b"]]),Loading3:n({name:"loading3",data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container loading3"},[e.createElementVNode("view",{class:"shape shape1"}),e.createElementVNode("view",{class:"shape shape2"}),e.createElementVNode("view",{class:"shape shape3"}),e.createElementVNode("view",{class:"shape shape4"})])}],["__scopeId","data-v-47408335"]]),Loading4:n({name:"loading5",data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container loading5"},[e.createElementVNode("view",{class:"shape shape1"}),e.createElementVNode("view",{class:"shape shape2"}),e.createElementVNode("view",{class:"shape shape3"}),e.createElementVNode("view",{class:"shape shape4"})])}],["__scopeId","data-v-49a6258a"]]),Loading5:n({name:"loading6",data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"container loading6"},[e.createElementVNode("view",{class:"shape shape1"}),e.createElementVNode("view",{class:"shape shape2"}),e.createElementVNode("view",{class:"shape shape3"}),e.createElementVNode("view",{class:"shape shape4"})])}],["__scopeId","data-v-08a06125"]])},name:"qiun-loading",props:{loadingType:{type:Number,default:2}},data:()=>({})},[["render",function(t,o,a,s,n,i){const r=e.resolveComponent("Loading1"),c=e.resolveComponent("Loading2"),l=e.resolveComponent("Loading3"),u=e.resolveComponent("Loading4"),d=e.resolveComponent("Loading5");return e.openBlock(),e.createElementBlock("view",null,[1==a.loadingType?(e.openBlock(),e.createBlock(r,{key:0})):e.createCommentVNode("",!0),2==a.loadingType?(e.openBlock(),e.createBlock(c,{key:1})):e.createCommentVNode("",!0),3==a.loadingType?(e.openBlock(),e.createBlock(l,{key:2})):e.createCommentVNode("",!0),4==a.loadingType?(e.openBlock(),e.createBlock(u,{key:3})):e.createCommentVNode("",!0),5==a.loadingType?(e.openBlock(),e.createBlock(d,{key:4})):e.createCommentVNode("",!0)])}]]);const za=n({name:"qiun-error",props:{errorMessage:{type:String,default:null}},data:()=>({})},[["render",function(t,o,a,s,n,i){return e.openBlock(),e.createElementBlock("view",{class:"chartsview"},[e.createElementVNode("view",{class:"charts-error"}),e.createElementVNode("view",{class:"charts-font"},e.toDisplayString(null==a.errorMessage?"请点击重试":a.errorMessage),1)])}],["__scopeId","data-v-af32de60"]]),Wa=["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],Ka={type:["pie","ring","rose","word","funnel","map","arcbar","line","column","mount","bar","area","radar","gauge","candle","mix","tline","tarea","scatter","bubble","demotype"],range:["饼状图","圆环图","玫瑰图","词云图","漏斗图","地图","圆弧进度条","折线图","柱状图","山峰图","条状图","区域图","雷达图","仪表盘","K线图","混合图","时间轴折线","时间轴区域","散点图","气泡图","自定义类型"],categories:["line","column","mount","bar","area","radar","gauge","candle","mix","demotype"],instance:{},option:{},formatter:{yAxisDemo1:function(e,t,o){return e+"元"},yAxisDemo2:function(e,t,o){return e.toFixed(2)},xAxisDemo1:function(e,t,o){return e+"年"},xAxisDemo2:function(e,t,o){return((e,t)=>{var o=new Date;o.setTime(1e3*e);var a=o.getFullYear(),s=o.getMonth()+1;s=s<10?"0"+s:s;var n=o.getDate();n=n<10?"0"+n:n;var i=o.getHours();i=i<10?"0"+i:i;var r=o.getMinutes(),c=o.getSeconds();return r=r<10?"0"+r:r,c=c<10?"0"+c:c,"full"==t?a+"-"+s+"-"+n+" "+i+":"+r+":"+c:"y-m-d"==t?a+"-"+s+"-"+n:"h:m"==t?i+":"+r:"h:m:s"==t?i+":"+r+":"+c:[a,s,n,i,r,c]})(e,"h:m")},seriesDemo1:function(e,t,o,a){return e+"元"},tooltipDemo1:function(e,t,o,a){return 0==o?"随便用"+e.data+"年":"其他我没改"+e.data+"天"},pieDemo:function(e,t,o,a){if(void 0!==t)return o[t].name+"："+o[t].data+"元"}},demotype:{type:"line",color:Wa,padding:[15,10,0,15],xAxis:{disableGrid:!0},yAxis:{gridType:"dash",dashLength:2},legend:{},extra:{line:{type:"curve",width:2}}},pie:{type:"pie",color:Wa,padding:[5,5,5,5],extra:{pie:{activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!0,borderWidth:3,borderColor:"#FFFFFF"}}},ring:{type:"ring",color:Wa,padding:[5,5,5,5],rotate:!1,dataLabel:!0,legend:{show:!0,position:"right",lineHeight:25},title:{name:"收益率",fontSize:15,color:"#666666"},subtitle:{name:"70%",fontSize:25,color:"#7cb5ec"},extra:{ring:{ringWidth:30,activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!0,borderWidth:3,borderColor:"#FFFFFF"}}},rose:{type:"rose",color:Wa,padding:[5,5,5,5],legend:{show:!0,position:"left",lineHeight:25},extra:{rose:{type:"area",minRadius:50,activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!1,borderWidth:2,borderColor:"#FFFFFF"}}},word:{type:"word",color:Wa,extra:{word:{type:"normal",autoColors:!1}}},funnel:{type:"funnel",color:Wa,padding:[15,15,0,15],extra:{funnel:{activeOpacity:.3,activeWidth:10,border:!0,borderWidth:2,borderColor:"#FFFFFF",fillOpacity:1,labelAlign:"right"}}},map:{type:"map",color:Wa,padding:[0,0,0,0],dataLabel:!0,extra:{map:{border:!0,borderWidth:1,borderColor:"#666666",fillOpacity:.6,activeBorderColor:"#F04864",activeFillColor:"#FACC14",activeFillOpacity:1}}},arcbar:{type:"arcbar",color:Wa,title:{name:"百分比",fontSize:25,color:"#00FF00"},subtitle:{name:"默认标题",fontSize:15,color:"#666666"},extra:{arcbar:{type:"default",width:12,backgroundColor:"#E9E9E9",startAngle:.75,endAngle:.25,gap:2}}},line:{type:"line",color:Wa,padding:[15,10,0,15],xAxis:{disableGrid:!0},yAxis:{gridType:"dash",dashLength:2},legend:{},extra:{line:{type:"straight",width:2,activeType:"hollow"}}},tline:{type:"line",color:Wa,padding:[15,10,0,15],xAxis:{disableGrid:!1,boundaryGap:"justify"},yAxis:{gridType:"dash",dashLength:2,data:[{min:0,max:80}]},legend:{},extra:{line:{type:"curve",width:2,activeType:"hollow"}}},tarea:{type:"area",color:Wa,padding:[15,10,0,15],xAxis:{disableGrid:!0,boundaryGap:"justify"},yAxis:{gridType:"dash",dashLength:2,data:[{min:0,max:80}]},legend:{},extra:{area:{type:"curve",opacity:.2,addLine:!0,width:2,gradient:!0,activeType:"hollow"}}},column:{type:"column",color:Wa,padding:[15,15,0,5],xAxis:{disableGrid:!0},yAxis:{data:[{min:0}]},legend:{},extra:{column:{type:"group",width:30,activeBgColor:"#000000",activeBgOpacity:.08}}},mount:{type:"mount",color:Wa,padding:[15,15,0,5],xAxis:{disableGrid:!0},yAxis:{data:[{min:0}]},legend:{},extra:{mount:{type:"mount",widthRatio:1.5}}},bar:{type:"bar",color:Wa,padding:[15,30,0,5],xAxis:{boundaryGap:"justify",disableGrid:!1,min:0,axisLine:!1},yAxis:{},legend:{},extra:{bar:{type:"group",width:30,meterBorde:1,meterFillColor:"#FFFFFF",activeBgColor:"#000000",activeBgOpacity:.08}}},area:{type:"area",color:Wa,padding:[15,15,0,15],xAxis:{disableGrid:!0},yAxis:{gridType:"dash",dashLength:2},legend:{},extra:{area:{type:"straight",opacity:.2,addLine:!0,width:2,gradient:!1,activeType:"hollow"}}},radar:{type:"radar",color:Wa,padding:[5,5,5,5],dataLabel:!1,legend:{show:!0,position:"right",lineHeight:25},extra:{radar:{gridType:"radar",gridColor:"#CCCCCC",gridCount:3,opacity:.2,max:200,labelShow:!0}}},gauge:{type:"gauge",color:Wa,title:{name:"66Km/H",fontSize:25,color:"#2fc25b",offsetY:50},subtitle:{name:"实时速度",fontSize:15,color:"#1890ff",offsetY:-50},extra:{gauge:{type:"default",width:30,labelColor:"#666666",startAngle:.75,endAngle:.25,startNumber:0,endNumber:100,labelFormat:"",splitLine:{fixRadius:0,splitNumber:10,width:30,color:"#FFFFFF",childNumber:5,childWidth:12},pointer:{width:24,color:"auto"}}}},candle:{type:"candle",color:Wa,padding:[15,15,0,15],enableScroll:!0,enableMarkLine:!0,dataLabel:!1,xAxis:{labelCount:4,itemCount:40,disableGrid:!0,gridColor:"#CCCCCC",gridType:"solid",dashLength:4,scrollShow:!0,scrollAlign:"left",scrollColor:"#A6A6A6",scrollBackgroundColor:"#EFEBEF"},yAxis:{},legend:{},extra:{candle:{color:{upLine:"#f04864",upFill:"#f04864",downLine:"#2fc25b",downFill:"#2fc25b"},average:{show:!0,name:["MA5","MA10","MA30"],day:[5,10,20],color:["#1890ff","#2fc25b","#facc14"]}},markLine:{type:"dash",dashLength:5,data:[{value:2150,lineColor:"#f04864",showLabel:!0},{value:2350,lineColor:"#f04864",showLabel:!0}]}}},mix:{type:"mix",color:Wa,padding:[15,15,0,15],xAxis:{disableGrid:!0},yAxis:{disabled:!1,disableGrid:!1,splitNumber:5,gridType:"dash",dashLength:4,gridColor:"#CCCCCC",padding:10,showTitle:!0,data:[]},legend:{},extra:{mix:{column:{width:20}}}},scatter:{type:"scatter",color:Wa,padding:[15,15,0,15],dataLabel:!1,xAxis:{disableGrid:!1,gridType:"dash",splitNumber:5,boundaryGap:"justify",min:0},yAxis:{disableGrid:!1,gridType:"dash"},legend:{},extra:{scatter:{}}},bubble:{type:"bubble",color:Wa,padding:[15,15,0,15],xAxis:{disableGrid:!1,gridType:"dash",splitNumber:5,boundaryGap:"justify",min:0,max:250},yAxis:{disableGrid:!1,gridType:"dash",data:[{min:0,max:150}]},legend:{},extra:{bubble:{border:2,opacity:.5}}}},Ha=["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],Ja={type:["pie","ring","rose","funnel","line","column","area","radar","gauge","candle","demotype"],categories:["line","column","area","radar","gauge","candle","demotype"],instance:{},option:{},formatter:{tooltipDemo1:function(e){let t="";for(let o in e){0==o&&(t+=e[o].axisValueLabel+"年销售额");let a="--";null!==e[o].data&&(a=e[o].data),t+="<br/>"+e[o].marker+e[o].seriesName+"："+a+" 万元"}return t},legendFormat:function(e){return"自定义图例+"+e},yAxisFormatDemo:function(e,t){return e+"元"},seriesFormatDemo:function(e){return e.name+"年"+e.value+"元"}},demotype:{color:Ha},column:{color:Ha,title:{text:""},tooltip:{trigger:"axis"},grid:{top:30,bottom:50,right:15,left:40},legend:{bottom:"left"},toolbox:{show:!1},xAxis:{type:"category",axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}},boundaryGap:!0,data:[]},yAxis:{type:"value",axisTick:{show:!1},axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}}},seriesTemplate:{name:"",type:"bar",data:[],barwidth:20,label:{show:!0,color:"#666666",position:"top"}}},line:{color:Ha,title:{text:""},tooltip:{trigger:"axis"},grid:{top:30,bottom:50,right:15,left:40},legend:{bottom:"left"},toolbox:{show:!1},xAxis:{type:"category",axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}},boundaryGap:!0,data:[]},yAxis:{type:"value",axisTick:{show:!1},axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}}},seriesTemplate:{name:"",type:"line",data:[],barwidth:20,label:{show:!0,color:"#666666",position:"top"}}},area:{color:Ha,title:{text:""},tooltip:{trigger:"axis"},grid:{top:30,bottom:50,right:15,left:40},legend:{bottom:"left"},toolbox:{show:!1},xAxis:{type:"category",axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}},boundaryGap:!0,data:[]},yAxis:{type:"value",axisTick:{show:!1},axisLabel:{color:"#666666"},axisLine:{lineStyle:{color:"#CCCCCC"}}},seriesTemplate:{name:"",type:"line",data:[],areaStyle:{},label:{show:!0,color:"#666666",position:"top"}}},pie:{color:Ha,title:{text:""},tooltip:{trigger:"item"},grid:{top:40,bottom:30,right:15,left:15},legend:{bottom:"left"},seriesTemplate:{name:"",type:"pie",data:[],radius:"50%",label:{show:!0,color:"#666666",position:"top"}}},ring:{color:Ha,title:{text:""},tooltip:{trigger:"item"},grid:{top:40,bottom:30,right:15,left:15},legend:{bottom:"left"},seriesTemplate:{name:"",type:"pie",data:[],radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!0,color:"#666666",position:"top"},labelLine:{show:!0}}},rose:{color:Ha,title:{text:""},tooltip:{trigger:"item"},legend:{top:"bottom"},seriesTemplate:{name:"",type:"pie",data:[],radius:"55%",center:["50%","50%"],roseType:"area"}},funnel:{color:Ha,title:{text:""},tooltip:{trigger:"item",formatter:"{b} : {c}%"},legend:{top:"bottom"},seriesTemplate:{name:"",type:"funnel",left:"10%",top:60,bottom:60,width:"80%",min:0,max:100,minSize:"0%",maxSize:"100%",sort:"descending",gap:2,label:{show:!0,position:"inside"},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{bordercolor:"#fff",borderwidth:1},emphasis:{label:{fontSize:20}},data:[]}},gauge:{color:Ha,tooltip:{formatter:"{a} <br/>{b} : {c}%"},seriesTemplate:{name:"业务指标",type:"gauge",detail:{formatter:"{value}%"},data:[{value:50,name:"完成率"}]}},candle:{xAxis:{data:[]},yAxis:{},color:Ha,title:{text:""},dataZoom:[{type:"inside",xAxisIndex:[0,1],start:10,end:100},{show:!0,xAxisIndex:[0,1],type:"slider",bottom:10,start:10,end:100}],seriesTemplate:{name:"",type:"k",data:[]}}},Ga=e=>{(e.$renderjs||(e.$renderjs=[])).push("rdcharts"),(e.$renderjsModules||(e.$renderjsModules={})).rdcharts="f9cb76fc"};function Qa(e={},...t){for(let o in t)for(let a in t[o])t[o].hasOwnProperty(a)&&(e[a]=t[o][a]&&"object"==typeof t[o][a]?Qa(Array.isArray(t[o][a])?[]:{},e[a],t[o][a]):t[o][a]);return e}function Ya(e,t){for(let o in e)e.hasOwnProperty(o)&&null!==e[o]&&"object"==typeof e[o]?Ya(e[o],t):"format"===o&&"string"==typeof e[o]&&(e.formatter=t[e[o]]?t[e[o]]:void 0);return e}const Xa={name:"qiun-data-charts",mixins:[Ua.mixinDatacom],props:{type:{type:String,default:null},canvasId:{type:String,default:"uchartsid"},canvas2d:{type:Boolean,default:!1},background:{type:String,default:"rgba(0,0,0,0)"},animation:{type:Boolean,default:!0},chartData:{type:Object,default:()=>({categories:[],series:[]})},opts:{type:Object,default:()=>({})},eopts:{type:Object,default:()=>({})},loadingType:{type:Number,default:2},errorShow:{type:Boolean,default:!0},errorReload:{type:Boolean,default:!0},errorMessage:{type:String,default:null},inScrollView:{type:Boolean,default:!1},reshow:{type:Boolean,default:!1},reload:{type:Boolean,default:!1},disableScroll:{type:Boolean,default:!1},optsWatch:{type:Boolean,default:!0},onzoom:{type:Boolean,default:!1},ontap:{type:Boolean,default:!0},ontouch:{type:Boolean,default:!1},onmouse:{type:Boolean,default:!0},onmovetip:{type:Boolean,default:!1},echartsH5:{type:Boolean,default:!1},echartsApp:{type:Boolean,default:!1},tooltipShow:{type:Boolean,default:!0},tooltipFormat:{type:String,default:void 0},tooltipCustom:{type:Object,default:void 0},startDate:{type:String,default:void 0},endDate:{type:String,default:void 0},textEnum:{type:Array,default:()=>[]},groupEnum:{type:Array,default:()=>[]},pageScrollTop:{type:Number,default:0},directory:{type:String,default:"/"},tapLegend:{type:Boolean,default:!0},menus:{type:Array,default:()=>[]}},data:()=>({cid:"uchartsid",inWx:!1,inAli:!1,inTt:!1,inBd:!1,inH5:!1,inApp:!1,inWin:!1,type2d:!0,disScroll:!1,openmouse:!1,pixel:1,cWidth:375,cHeight:250,showchart:!1,echarts:!1,echartsResize:{state:!1},uchartsOpts:{},echartsOpts:{},drawData:{},lastDrawTime:null}),created(){if(this.cid=this.canvasId,"uchartsid"==this.canvasId||""==this.canvasId){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t=e.length,o="";for(let a=0;a<32;a++)o+=e.charAt(Math.floor(Math.random()*t));this.cid=o}const e=uni.getSystemInfoSync();"windows"!==e.platform&&"mac"!==e.platform||(this.inWin=!0),this.type2d=!1,this.disScroll=this.disableScroll},mounted(){this.inApp=!0,!0===this.echartsApp&&(this.echarts=!0,this.openmouse=!1),this.$nextTick((()=>{this.beforeInit()}))},destroyed(){!0===this.echarts?(delete Ja.option[this.cid],delete Ja.instance[this.cid]):(delete Ka.option[this.cid],delete Ka.instance[this.cid]),uni.offWindowResize((()=>{}))},watch:{chartDataProps:{handler(e,t){"object"==typeof e?JSON.stringify(e)!==JSON.stringify(t)&&(this._clearChart(),e.series&&e.series.length>0?this.beforeInit():(this.mixinDatacomLoading=!0,this.showchart=!1,this.mixinDatacomErrorMessage=null)):(this.mixinDatacomLoading=!1,this._clearChart(),this.showchart=!1,this.mixinDatacomErrorMessage="参数错误：chartData数据类型错误")},immediate:!1,deep:!0},localdata:{handler(e,t){JSON.stringify(e)!==JSON.stringify(t)&&(e.length>0?this.beforeInit():(this.mixinDatacomLoading=!0,this._clearChart(),this.showchart=!1,this.mixinDatacomErrorMessage=null))},immediate:!1,deep:!0},optsProps:{handler(e,t){"object"==typeof e?JSON.stringify(e)!==JSON.stringify(t)&&!1===this.echarts&&1==this.optsWatch&&this.checkData(this.drawData):(this.mixinDatacomLoading=!1,this._clearChart(),this.showchart=!1,this.mixinDatacomErrorMessage="参数错误：opts数据类型错误")},immediate:!1,deep:!0},eoptsProps:{handler(e,t){"object"==typeof e?JSON.stringify(e)!==JSON.stringify(t)&&!0===this.echarts&&this.checkData(this.drawData):(this.mixinDatacomLoading=!1,this.showchart=!1,this.mixinDatacomErrorMessage="参数错误：eopts数据类型错误")},immediate:!1,deep:!0},reshow(e,t){!0===e&&!1===this.mixinDatacomLoading&&setTimeout((()=>{this.mixinDatacomErrorMessage=null,this.echartsResize.state=!this.echartsResize.state,this.checkData(this.drawData)}),200)},reload(e,t){!0===e&&(this.showchart=!1,this.mixinDatacomErrorMessage=null,this.reloading())},mixinDatacomErrorMessage(e,o){e&&(this.emitMsg({name:"error",params:{type:"error",errorShow:this.errorShow,msg:e,id:this.cid}}),this.errorShow&&t("log","at uni_modules/qiun-data-charts/components/qiun-data-charts/qiun-data-charts.vue:611","[秋云图表组件]"+e))},errorMessage(e,t){e&&this.errorShow&&null!==e&&"null"!==e&&""!==e?(this.showchart=!1,this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=e):(this.showchart=!1,this.mixinDatacomErrorMessage=null,this.reloading())}},computed:{optsProps(){return JSON.parse(JSON.stringify(this.opts))},eoptsProps(){return JSON.parse(JSON.stringify(this.eopts))},chartDataProps(){return JSON.parse(JSON.stringify(this.chartData))}},methods:{beforeInit(){this.mixinDatacomErrorMessage=null,"object"==typeof this.chartData&&null!=this.chartData&&void 0!==this.chartData.series&&this.chartData.series.length>0?(this.drawData=Qa({},this.chartData),this.mixinDatacomLoading=!1,this.showchart=!0,this.checkData(this.chartData)):this.localdata.length>0?(this.mixinDatacomLoading=!1,this.showchart=!0,this.localdataInit(this.localdata)):""!==this.collection?(this.mixinDatacomLoading=!1,this.getCloudData()):this.mixinDatacomLoading=!0},localdataInit(e){if(this.groupEnum.length>0)for(let u=0;u<e.length;u++)for(let t=0;t<this.groupEnum.length;t++)e[u].group===this.groupEnum[t].value&&(e[u].group=this.groupEnum[t].text);if(this.textEnum.length>0)for(let u=0;u<e.length;u++)for(let t=0;t<this.textEnum.length;t++)e[u].text===this.textEnum[t].value&&(e[u].text=this.textEnum[t].text);let t=!1,o={categories:[],series:[]},a=[],s=[];if(t=!0===this.echarts?Ja.categories.includes(this.type):Ka.categories.includes(this.type),!0===t){if(this.chartData&&this.chartData.categories&&this.chartData.categories.length>0)a=this.chartData.categories;else if(this.startDate&&this.endDate){let e=new Date(this.startDate),t=new Date(this.endDate);for(;e<=t;)a.push((i=void 0,r=void 0,c=void 0,i=(n=e).getFullYear(),r=n.getMonth()+1,c=n.getDate(),r>=1&&r<=9&&(r="0"+r),c>=0&&c<=9&&(c="0"+c),i+"-"+r+"-"+c)),e=e.setDate(e.getDate()+1),e=new Date(e)}else{let t={};e.map((function(e,o){null==e.text||t[e.text]||(a.push(e.text),t[e.text]=!0)}))}o.categories=a}var n,i,r,c;let l={};if(e.map((function(e,t){null==e.group||l[e.group]||(s.push({name:e.group,data:[]}),l[e.group]=!0)})),0==s.length)if(s=[{name:"默认分组",data:[]}],!0===t)for(let u=0;u<a.length;u++){let t=0;for(let o=0;o<e.length;o++)e[o].text==a[u]&&(t=e[o].value);s[0].data.push(t)}else for(let u=0;u<e.length;u++)s[0].data.push({name:e[u].text,value:e[u].value});else for(let u=0;u<s.length;u++)if(a.length>0)for(let t=0;t<a.length;t++){let o=0;for(let n=0;n<e.length;n++)s[u].name==e[n].group&&e[n].text==a[t]&&(o=e[n].value);s[u].data.push(o)}else for(let t=0;t<e.length;t++)s[u].name==e[t].group&&s[u].data.push(e[t].value);o.series=s,this.drawData=Qa({},o),this.checkData(o)},reloading(){!1!==this.errorReload&&(this.showchart=!1,this.mixinDatacomErrorMessage=null,""!==this.collection?(this.mixinDatacomLoading=!1,this.onMixinDatacomPropsChange(!0)):this.beforeInit())},checkData(e){let t=this.cid;!0===this.echarts?(Ja.option[t]=Qa({},this.eopts),Ja.option[t].id=t,Ja.option[t].type=this.type):this.type&&Ka.type.includes(this.type)?(Ka.option[t]=Qa({},Ka[this.type],this.opts),Ka.option[t].canvasId=t):(this.mixinDatacomLoading=!1,this.showchart=!1,this.mixinDatacomErrorMessage="参数错误：props参数中type类型不正确");let o=Qa({},e);void 0!==o.series&&o.series.length>0&&(this.mixinDatacomErrorMessage=null,!0===this.echarts?(Ja.option[t].chartData=o,this.$nextTick((()=>{this.init()}))):(Ka.option[t].categories=o.categories,Ka.option[t].series=o.series,this.$nextTick((()=>{this.init()}))))},resizeHandler(){let e=Date.now();e-(this.lastDrawTime?this.lastDrawTime:e-3e3)<1e3||uni.createSelectorQuery().in(this).select("#ChartBoxId"+this.cid).boundingClientRect((e=>{this.showchart=!0,e.width>0&&e.height>0&&(e.width===this.cWidth&&e.height===this.cHeight||this.checkData(this.drawData))})).exec()},getCloudData(){1!=this.mixinDatacomLoading&&(this.mixinDatacomLoading=!0,this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,this.localdataInit(this.mixinDatacomResData)})).catch((e=>{this.mixinDatacomLoading=!1,this.showchart=!1,this.mixinDatacomErrorMessage="请求错误："+e})))},onMixinDatacomPropsChange(e,t){1==e&&""!==this.collection&&(this.showchart=!1,this.mixinDatacomErrorMessage=null,this._clearChart(),this.getCloudData())},_clearChart(){let e=this.cid;if(!0!==this.echarts&&Ka.option[e]&&Ka.option[e].context){const t=Ka.option[e].context;"object"!=typeof t||Ka.option[e].update||(t.clearRect(0,0,this.cWidth*this.pixel,this.cHeight*this.pixel),t.draw())}},init(){let e=this.cid;uni.createSelectorQuery().in(this).select("#ChartBoxId"+e).boundingClientRect((t=>{t.width>0&&t.height>0?(this.mixinDatacomLoading=!1,this.showchart=!0,this.lastDrawTime=Date.now(),this.cWidth=t.width,this.cHeight=t.height,!0!==this.echarts&&(Ka.option[e].background="rgba(0,0,0,0)"==this.background?"#FFFFFF":this.background,Ka.option[e].canvas2d=this.type2d,Ka.option[e].pixelRatio=this.pixel,Ka.option[e].animation=this.animation,Ka.option[e].width=t.width*this.pixel,Ka.option[e].height=t.height*this.pixel,Ka.option[e].onzoom=this.onzoom,Ka.option[e].ontap=this.ontap,Ka.option[e].ontouch=this.ontouch,Ka.option[e].onmouse=this.openmouse,Ka.option[e].onmovetip=this.onmovetip,Ka.option[e].tooltipShow=this.tooltipShow,Ka.option[e].tooltipFormat=this.tooltipFormat,Ka.option[e].tooltipCustom=this.tooltipCustom,Ka.option[e].inScrollView=this.inScrollView,Ka.option[e].lastDrawTime=this.lastDrawTime,Ka.option[e].tapLegend=this.tapLegend),this.inH5||this.inApp?1==this.echarts?(Ja.option[e].ontap=this.ontap,Ja.option[e].onmouse=this.openmouse,Ja.option[e].tooltipShow=this.tooltipShow,Ja.option[e].tooltipFormat=this.tooltipFormat,Ja.option[e].tooltipCustom=this.tooltipCustom,Ja.option[e].lastDrawTime=this.lastDrawTime,this.echartsOpts=Qa({},Ja.option[e])):(Ka.option[e].rotateLock=Ka.option[e].rotate,this.uchartsOpts=Qa({},Ka.option[e])):(Ka.option[e]=Ya(Ka.option[e],Ka.formatter),this.mixinDatacomErrorMessage=null,this.mixinDatacomLoading=!1,this.showchart=!0,this.$nextTick((()=>{if(!0===this.type2d){uni.createSelectorQuery().in(this).select("#"+e).fields({node:!0,size:!0}).exec((o=>{if(o[0]){const a=o[0].node,s=a.getContext("2d");Ka.option[e].context=s,Ka.option[e].rotateLock=Ka.option[e].rotate,Ka.instance[e]&&Ka.option[e]&&!0===Ka.option[e].update?this._updataUChart(e):(a.width=t.width*this.pixel,a.height=t.height*this.pixel,a._width=t.width*this.pixel,a._height=t.height*this.pixel,setTimeout((()=>{Ka.option[e].context.restore(),Ka.option[e].context.save(),this._newChart(e)}),100))}else this.showchart=!1,this.mixinDatacomErrorMessage="参数错误：开启2d模式后，未获取到dom节点，canvas-id:"+e}))}else this.inAli&&(Ka.option[e].rotateLock=Ka.option[e].rotate),Ka.option[e].context=uni.createCanvasContext(e,this),Ka.instance[e]&&Ka.option[e]&&!0===Ka.option[e].update?this._updataUChart(e):setTimeout((()=>{Ka.option[e].context.restore(),Ka.option[e].context.save(),this._newChart(e)}),100)})))):(this.mixinDatacomLoading=!1,this.showchart=!1,1==this.reshow&&(this.mixinDatacomErrorMessage="布局错误：未获取到父元素宽高尺寸！canvas-id:"+e))})).exec()},saveImage(){uni.canvasToTempFilePath({canvasId:this.cid,success:e=>{uni.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){uni.showToast({title:"保存成功",duration:2e3})}})}},this)},getImage(){if(0==this.type2d)uni.canvasToTempFilePath({canvasId:this.cid,success:e=>{this.emitMsg({name:"getImage",params:{type:"getImage",base64:e.tempFilePath}})}},this);else{uni.createSelectorQuery().in(this).select("#"+this.cid).fields({node:!0,size:!0}).exec((e=>{if(e[0]){const t=e[0].node;this.emitMsg({name:"getImage",params:{type:"getImage",base64:t.toDataURL("image/png")}})}}))}},_error(e){this.mixinDatacomErrorMessage=e.detail.errMsg},emitMsg(e){this.$emit(e.name,e.params)},getRenderType(){!0===this.echarts&&!1===this.mixinDatacomLoading&&this.beforeInit()},toJSON(){return this}}};Ga(Xa);const Za=n(Xa,[["render",function(t,a,s,n,i,r){const c=o(e.resolveDynamicComponent("qiun-loading"),ja),l=o(e.resolveDynamicComponent("qiun-error"),za);return e.openBlock(),e.createElementBlock("view",{class:"chartsview",id:"ChartBoxId"+i.cid},[t.mixinDatacomLoading?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createVNode(c,{loadingType:s.loadingType},null,8,["loadingType"])])):e.createCommentVNode("",!0),t.mixinDatacomErrorMessage&&s.errorShow?(e.openBlock(),e.createElementBlock("view",{key:1,onClick:a[0]||(a[0]=(...e)=>r.reloading&&r.reloading(...e))},[e.createVNode(l,{errorMessage:s.errorMessage},null,8,["errorMessage"])])):e.createCommentVNode("",!0),i.echarts?e.withDirectives((e.openBlock(),e.createElementBlock("view",{key:2,style:e.normalizeStyle([{background:s.background},{width:"100%",height:"100%"}]),"data-directory":s.directory,id:"EC"+i.cid,prop:e.wp(i.echartsOpts),"change:prop":t.rdcharts.ecinit,resize:e.wp(i.echartsResize),"change:resize":t.rdcharts.ecresize},null,12,["data-directory","id","prop","change:prop","resize","change:resize"])),[[e.vShow,i.showchart]]):(e.openBlock(),e.createElementBlock("view",{key:3,onClick:a[2]||(a[2]=(...e)=>t.rdcharts.tap&&t.rdcharts.tap(...e)),onMousemove:a[3]||(a[3]=(...e)=>t.rdcharts.mouseMove&&t.rdcharts.mouseMove(...e)),onMousedown:a[4]||(a[4]=(...e)=>t.rdcharts.mouseDown&&t.rdcharts.mouseDown(...e)),onMouseup:a[5]||(a[5]=(...e)=>t.rdcharts.mouseUp&&t.rdcharts.mouseUp(...e)),onTouchstart:a[6]||(a[6]=(...e)=>t.rdcharts.touchStart&&t.rdcharts.touchStart(...e)),onTouchmove:a[7]||(a[7]=(...e)=>t.rdcharts.touchMove&&t.rdcharts.touchMove(...e)),onTouchend:a[8]||(a[8]=(...e)=>t.rdcharts.touchEnd&&t.rdcharts.touchEnd(...e)),id:"UC"+i.cid,prop:e.wp(i.uchartsOpts),"change:prop":t.rdcharts.ucinit},[e.withDirectives(e.createElementVNode("canvas",{id:i.cid,canvasId:i.cid,style:e.normalizeStyle({width:i.cWidth+"px",height:i.cHeight+"px",background:s.background}),"disable-scroll":s.disableScroll,onError:a[1]||(a[1]=(...e)=>r._error&&r._error(...e))},null,44,["id","canvasId","disable-scroll"]),[[e.vShow,i.showchart]])],40,["id","prop","change:prop"]))],8,["id"])}],["__scopeId","data-v-3e273927"]]),es={__name:"analysis",setup(o){const a=e.ref(!1),s=e.ref({id:0,user_id:0,analysis_date:"",total_practice_count:0,total_question_count:0,total_correct_count:0,total_wrong_count:0,overall_correct_rate:0,addition_correct_rate:0,subtraction_correct_rate:0,multiplication_correct_rate:0,division_correct_rate:0,mistake_completion_rate:0,average_time_per_question:0,created_time:"",updated_time:""}),n=e.ref(!1),i=e.ref(null),r=e.ref({color:["#48bb78","#f56565"],enableScroll:!1,touchMove:!1,dataLabel:!0,legend:{show:!0,position:"right",lineHeight:20},extra:{pie:{activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!0,borderWidth:3,borderColor:"#FFFFFF"}}}),c=e.ref({series:[{data:[{name:"已完成",value:68.5},{name:"未完成",value:31.5}]}]}),l=e.ref({color:["#4299e1"],padding:[15,15,0,15],enableScroll:!1,legend:{show:!1},xAxis:{disableGrid:!0,type:"category",boundaryGap:!1,axisLine:{color:"#cccccc"},axisTick:{show:!1}},yAxis:{gridType:"dash",splitNumber:5,min:0,axisLine:{show:!1},axisTick:{show:!1}},extra:{line:{type:"straight",width:3,activeType:"hollow"}}}),u=e.ref({categories:[],series:[{name:"做题数量",data:[]}]});e.ref({color:["#4285F4","#EA4335","#FBBC05"],padding:[15,15,0,15],enableScroll:!1,xAxis:{disableGrid:!0,itemCount:5},yAxis:{gridType:"dash",dashLength:2},legend:{show:!0,position:"top",lineHeight:25},extra:{column:{type:"group",width:25,seriesGap:2}}}),e.ref({categories:["简单混合","带括号","多步运算","复杂混合","应用题型"],series:[{name:"正确率",data:[92,78,65,58,72]},{name:"完成率",data:[95,85,75,68,80]},{name:"平均用时(秒)",data:[25,45,68,85,75]}]}),e.ref({color:["#4285F4"],padding:[15,15,0,15],enableScroll:!1,xAxis:{disableGrid:!0,itemCount:7},yAxis:{gridType:"dash",dashLength:2},extra:{column:{type:"group",width:30}}}),e.ref({categories:["加法","减法","乘法","除法"],series:[{name:"正确率",data:[88.5,82.3,79.8,76.2]}]});const d=e.ref({color:["#4285F4"],padding:[15,15,0,15],enableScroll:!1,xAxis:{disableGrid:!0,itemCount:6},yAxis:{gridType:"dash",dashLength:2},extra:{column:{type:"group",width:40}}}),h=e.ref({categories:["1年级","2年级","3年级","4年级","5年级","6年级"],series:[{name:"练题数量",data:[45,38,62,29,51,33]}]});e.ref({color:["#4285F4","#34A853"],padding:[5,5,5,5],enableScroll:!1,legend:{show:!0,position:"bottom",lineHeight:25},extra:{radar:{gridType:"radar",gridColor:"#CCCCCC",gridCount:5,opacity:.2,max:100}}}),e.ref({categories:[{name:"计算速度",max:100},{name:"正确率",max:100},{name:"专注力",max:100},{name:"理解力",max:100},{name:"记忆力",max:100},{name:"逻辑思维",max:100}],series:[{name:"当前水平",data:[85,92,78,88,82,90]},{name:"目标水平",data:[95,98,90,95,90,95]}]});const m=async()=>{try{if(!i.value)return void t("warn","at pages/analysis/analysis.vue:369","用户ID未找到，无法加载近7日统计数据");t("log","at pages/analysis/analysis.vue:373","开始加载用户近7日统计，用户ID:",i.value);const e=await(e=>b(`/statistics/daily/${e}`,{method:"GET"}))(i.value);if(e&&e.data){const o=e.data;t("log","at pages/analysis/analysis.vue:378","近7日统计数据:",o);const a=[],s=[];o.forEach((e=>{a.push(e.date),s.push(e.questionCount)})),u.value={categories:a,series:[{name:"做题数量",data:s}]},t("log","at pages/analysis/analysis.vue:399","近7日图表数据更新成功:",u.value)}else{t("log","at pages/analysis/analysis.vue:401","没有获取到近7日统计数据，使用默认值");const e=[],o=[];for(let t=6;t>=0;t--){const a=new Date;a.setDate(a.getDate()-t);const s=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");e.push(`${s}-${n}`),o.push(0)}u.value={categories:e,series:[{name:"做题数量",data:o}]}}}catch(e){t("error","at pages/analysis/analysis.vue:427","加载近7日统计数据失败:",e),uni.showToast({title:"近7日数据加载失败",icon:"none"});const o=[],a=[];for(let t=6;t>=0;t--){const e=new Date;e.setDate(e.getDate()-t);const s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");o.push(`${s}-${n}`),a.push(0)}u.value={categories:o,series:[{name:"做题数量",data:a}]}}},g=async()=>{try{if(!i.value)return void t("warn","at pages/analysis/analysis.vue:462","用户ID未找到，无法加载年级统计数据");t("log","at pages/analysis/analysis.vue:466","开始加载用户年级统计，用户ID:",i.value);const e=await(e=>b(`/statistics/grade/${e}`,{method:"GET"}))(i.value);if(e&&e.data){const o=e.data;t("log","at pages/analysis/analysis.vue:471","年级统计数据:",o);const a=[],s=[];o.forEach((e=>{a.push(`${e.grade}年级`),s.push(e.questionCount)})),h.value={categories:a,series:[{name:"练题数量",data:s}]},t("log","at pages/analysis/analysis.vue:492","年级图表数据更新成功:",h.value)}else t("log","at pages/analysis/analysis.vue:494","没有获取到年级统计数据，使用默认值"),h.value={categories:["1年级","2年级","3年级","4年级","5年级","6年级"],series:[{name:"练题数量",data:[0,0,0,0,0,0]}]}}catch(e){t("error","at pages/analysis/analysis.vue:507","加载年级统计数据失败:",e),uni.showToast({title:"年级数据加载失败",icon:"none"}),h.value={categories:["1年级","2年级","3年级","4年级","5年级","6年级"],series:[{name:"练题数量",data:[0,0,0,0,0,0]}]}}},f=async()=>{try{if(!i.value)return void t("warn","at pages/analysis/analysis.vue:529","用户ID未找到，无法加载错题完成率数据");t("log","at pages/analysis/analysis.vue:533","开始加载用户错题完成率，用户ID:",i.value);const e=await(e=>b(`/statistics/mistake-completion/${e}`,{method:"GET"}))(i.value);if(e&&e.data){const o=e.data;t("log","at pages/analysis/analysis.vue:538","错题完成率数据:",o);const a=o.completionRate||0,n=100-a;c.value.series[0].data=[{name:"已完成",value:a},{name:"未完成",value:n}],s.value.mistake_completion_rate=a,t("log","at pages/analysis/analysis.vue:552","错题完成率图表数据更新成功:",c.value)}else t("log","at pages/analysis/analysis.vue:554","没有获取到错题完成率数据，使用默认值"),c.value.series[0].data=[{name:"已完成",value:0},{name:"未完成",value:100}],s.value.mistake_completion_rate=0}catch(e){t("error","at pages/analysis/analysis.vue:563","加载错题完成率数据失败:",e),uni.showToast({title:"错题数据加载失败",icon:"none"}),c.value.series[0].data=[{name:"已完成",value:0},{name:"未完成",value:100}],s.value.mistake_completion_rate=0}},v=async()=>{try{if(!i.value)return void t("warn","at pages/analysis/analysis.vue:581","用户ID未找到，无法加载统计数据");t("log","at pages/analysis/analysis.vue:585","开始加载用户统计概览，用户ID:",i.value);const e=await(e=>b(`/statistics/overview/${e}`,{method:"GET"}))(i.value);if(e&&e.data){const o=e.data;s.value={id:1,user_id:i.value,analysis_date:(new Date).toISOString().split("T")[0],total_practice_count:0,total_question_count:o.totalQuestionCount||0,total_correct_count:o.totalCorrectCount||0,total_wrong_count:0,overall_correct_rate:o.overallCorrectRate||0,addition_correct_rate:88.5,subtraction_correct_rate:82.3,multiplication_correct_rate:79.8,division_correct_rate:76.2,mistake_completion_rate:0,average_time_per_question:0,created_time:(new Date).toISOString(),updated_time:(new Date).toISOString()},t("log","at pages/analysis/analysis.vue:610","统计概览数据加载成功:",s.value)}else t("log","at pages/analysis/analysis.vue:612","没有获取到统计数据，使用默认值"),s.value={id:0,user_id:i.value,analysis_date:(new Date).toISOString().split("T")[0],total_practice_count:0,total_question_count:0,total_correct_count:0,total_wrong_count:0,overall_correct_rate:0,addition_correct_rate:0,subtraction_correct_rate:0,multiplication_correct_rate:0,division_correct_rate:0,mistake_completion_rate:0,average_time_per_question:0,created_time:(new Date).toISOString(),updated_time:(new Date).toISOString()}}catch(e){t("error","at pages/analysis/analysis.vue:636","加载统计概览数据失败:",e),uni.showToast({title:"数据加载失败",icon:"none"}),s.value={id:0,user_id:i.value||0,analysis_date:(new Date).toISOString().split("T")[0],total_practice_count:0,total_question_count:0,total_correct_count:0,total_wrong_count:0,overall_correct_rate:0,addition_correct_rate:0,subtraction_correct_rate:0,multiplication_correct_rate:0,division_correct_rate:0,mistake_completion_rate:0,average_time_per_question:0,created_time:(new Date).toISOString(),updated_time:(new Date).toISOString()}}};e.onMounted((async()=>{n.value=!0;try{i.value=p(),t("log","at pages/analysis/analysis.vue:681","获取到用户ID:",i.value),i.value?await Promise.all([v(),g(),f(),m()]):(t("warn","at pages/analysis/analysis.vue:692","用户ID未找到，无法加载统计数据"),uni.showToast({title:"请先登录",icon:"none"}))}catch(e){t("error","at pages/analysis/analysis.vue:699","页面初始化失败:",e),uni.showToast({title:"页面加载失败",icon:"none"})}finally{n.value=!1}}));const y=e=>{const t=new URLSearchParams({grade:e.grade,questionCount:e.questionCount,timeLimit:e.timeLimit,practiceType:e.practiceType}).toString();uni.navigateTo({url:`/pages/practice/practice?${t}`})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"analysis-container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"∑"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"∫"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"∞"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"∠"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"∏")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"学习分析")]),e.createElementVNode("view",{class:"overview-section"},[n.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading-placeholder"},[e.createElementVNode("text",null,"加载中...")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"overview-card"},[e.createElementVNode("view",{class:"overview-item"},[e.createElementVNode("text",{class:"overview-value"},e.toDisplayString(s.value.overall_correct_rate)+"%",1),e.createElementVNode("text",{class:"overview-label"},"总体正确率")]),e.createElementVNode("view",{class:"overview-item"},[e.createElementVNode("text",{class:"overview-value"},e.toDisplayString(s.value.total_question_count),1),e.createElementVNode("text",{class:"overview-label"},"总题目数")]),e.createElementVNode("view",{class:"overview-item"},[e.createElementVNode("text",{class:"overview-value"},e.toDisplayString(s.value.total_correct_count),1),e.createElementVNode("text",{class:"overview-label"},"总正确数")])]))]),n.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"charts-section"},[e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-header"},[e.createElementVNode("text",{class:"chart-title"},"各年级练题数量")]),e.createVNode(Za,{type:"column",opts:d.value,chartData:h.value,style:{height:"300px"}},null,8,["opts","chartData"])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-header"},[e.createElementVNode("text",{class:"chart-title"},"错题完成率")]),e.createVNode(Za,{type:"pie",opts:r.value,chartData:c.value,style:{height:"300px"}},null,8,["opts","chartData"])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"chart-header"},[e.createElementVNode("text",{class:"chart-title"},"近7日做题总数")]),e.createVNode(Za,{type:"line",opts:l.value,chartData:u.value,style:{height:"300px"}},null,8,["opts","chartData"])])])),e.createVNode($,{onShowPracticeSetup:o[0]||(o[0]=e=>a.value=!0)}),e.createVNode(F,{visible:a.value,onClose:o[1]||(o[1]=e=>a.value=!1),onConfirm:y},null,8,["visible"])]))}},ts={__name:"result",setup(o){const s=e.ref({totalQuestions:10,correctCount:8,startTime:"2025-10-04 15:30",timeSpent:"15:22",timeLimit:"30分钟",grade:3});a((async e=>{if(e&&e.data)try{const t=JSON.parse(decodeURIComponent(e.data));s.value={...s.value,...t},await n()}catch(ot){t("error","at pages/result/result.vue:120","解析练习数据失败:",ot)}}));const n=async()=>{try{const e=uni.getStorageSync("userData");if(!e)return void t("warn","at pages/result/result.vue:131","用户未登录，无法保存练习记录");const o="string"==typeof e?JSON.parse(e):e,a=s.value.totalQuestions-s.value.correctCount,n=(s.value.correctCount/s.value.totalQuestions*100).toFixed(2),c=s.value.timeSpentSeconds||i(s.value.timeSpent),l=s.value.timeLimitSeconds||i(s.value.timeLimit),u=s.value.startTime&&s.value.startTime.includes("T")?s.value.startTime:r(s.value.startTime),d={userId:o.id,grade:String(s.value.grade),questionCount:s.value.totalQuestions,correctCount:s.value.correctCount,wrongCount:a,correctRate:parseFloat(n),timeLimit:l,timeSpent:c,startTime:u};t("log","at pages/result/result.vue:161","准备保存练习记录:",d);const p=await(e=>b("/practice-records/save",{method:"POST",data:e}))(d);t("log","at pages/result/result.vue:165","练习记录保存成功:",p)}catch(e){t("error","at pages/result/result.vue:175","保存练习记录失败:",e)}},i=e=>{if(!e)return 0;if(e.includes(":")){const t=e.split(":");return 60*(parseInt(t[0])||0)+(parseInt(t[1])||0)}if(e.includes("分钟")){return 60*(parseInt(e.replace("分钟",""))||0)}const t=parseInt(e);return isNaN(t)?0:t},r=e=>{if(!e)return(new Date).toISOString();try{let t;if(e.includes("-")&&e.includes(" "))t=new Date(e);else if(e.includes("月")&&e.includes("日")){const o=(new Date).getFullYear(),a=/(\d+)月(\d+)日\s+(\d+):(\d+)/,s=e.match(a);if(s){const[,e,a,n,i]=s;t=new Date(o,parseInt(e)-1,parseInt(a),parseInt(n),parseInt(i))}}return t&&!isNaN(t.getTime())||(t=new Date),t.toISOString()}catch(o){return t("error","at pages/result/result.vue:238","时间转换失败:",o),(new Date).toISOString()}},c=e.computed((()=>s.value.totalQuestions)),l=e.computed((()=>s.value.correctCount)),u=e.computed((()=>c.value-l.value)),d=e.computed((()=>Math.round(l.value/c.value*100))),p=e.computed((()=>{const e=d.value;return e>=90?"excellent":e>=80?"good":e>=70?"average":e>=60?"poor":"bad"})),h=e.computed((()=>["一年级","二年级","三年级","四年级","五年级","六年级"][s.value.grade-1]||"未知年级")),m=e.computed((()=>{const e=new Date(s.value.startTime);return`${e.getMonth()+1}月${e.getDate()}日 ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`})),g=e.computed((()=>s.value.startTime)),f=e.computed((()=>s.value.timeSpent)),v=e.computed((()=>s.value.timeLimit)),y=()=>{uni.redirectTo({url:"/pages/home/home"})},w=()=>{0!==u.value&&uni.navigateTo({url:"/pages/reviewing/reviewing"})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"result-container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"√"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"∞"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"∑"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"∫"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"∏")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"练习结果")]),e.createElementVNode("view",{class:"result-overview"},[e.createElementVNode("view",{class:"overview-card"},[e.createElementVNode("view",{class:"overview-header"},[e.createElementVNode("text",{class:"overview-title"},"本次练习"),e.createElementVNode("text",{class:"overview-time"},e.toDisplayString(m.value),1)]),e.createElementVNode("view",{class:"stats-grid"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(c.value),1),e.createElementVNode("text",{class:"stat-label"},"题目数量")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(l.value),1),e.createElementVNode("text",{class:"stat-label"},"答对题数")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-value"},e.toDisplayString(u.value),1),e.createElementVNode("text",{class:"stat-label"},"答错题数")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:e.normalizeClass(["stat-value",p.value])},e.toDisplayString(d.value)+"%",3),e.createElementVNode("text",{class:"stat-label"},"正确率")])])])]),e.createElementVNode("view",{class:"detail-section"},[e.createElementVNode("view",{class:"section-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"详细统计")]),e.createElementVNode("view",{class:"detail-grid"},[e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"年级"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(h.value),1)]),e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"开始时间"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(g.value),1)]),e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"用时"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(f.value),1)]),e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"detail-label"},"限时"),e.createElementVNode("text",{class:"detail-value"},e.toDisplayString(v.value),1)])])])]),e.createElementVNode("view",{class:"action-section"},[e.createElementVNode("view",{class:"button-row"},[e.createElementVNode("button",{class:"action-btn primary",onClick:y},[e.createElementVNode("text",{class:"btn-text"},"返回首页")]),e.createElementVNode("button",{class:"action-btn secondary",onClick:w,disabled:0===u.value},[e.createElementVNode("text",{class:"btn-text"},"查看错题")],8,["disabled"])])])]))}},os={__name:"reviewing",setup(o){const a=e.ref([]),s=e.ref(!1),n=e.ref(!1),i=e.ref(null),c=e.ref(null),l=e.ref(-1),u=e.ref(""),d=e.ref(null),h=()=>{d.value.close(),c.value=null,l.value=-1},m=async()=>{if(!u.value)return void uni.showToast({title:"请输入答案",icon:"none"});const e=parseInt(u.value);var o,s;if(isNaN(e))uni.showToast({title:"请输入有效数字",icon:"none"});else if(e===c.value.correctAnswer)try{const e=c.value.id;t("log","at pages/reviewing/reviewing.vue:166","更新错题纠正状态，错题ID:",e),await(o=e,s="1",b(`/mistake-records/${o}/corrected?corrected=${s}`,{method:"PUT"})),a.value[l.value].corrected=!0,uni.showToast({title:"回答正确！",icon:"success"}),t("log","at pages/reviewing/reviewing.vue:179","错题状态更新成功"),setTimeout((()=>{h()}),1e3)}catch(n){t("error","at pages/reviewing/reviewing.vue:186","更新错题状态失败:",n),uni.showToast({title:"更新失败",icon:"none"})}else uni.showToast({title:"回答错误，请再试一次",icon:"none"}),u.value=""},g=e=>{uni.showModal({title:"移除题目",content:"确定要移除这道已掌握的题目吗？",success:async function(o){if(o.confirm)try{const o=a.value[e].id;t("log","at pages/reviewing/reviewing.vue:213","删除错题记录，错题ID:",o),await(s=o,b(`/mistake-records/${s}`,{method:"DELETE"})),a.value.splice(e,1),uni.showToast({title:"已移除",icon:"success"}),t("log","at pages/reviewing/reviewing.vue:226","错题记录删除成功")}catch(n){t("error","at pages/reviewing/reviewing.vue:228","删除错题记录失败:",n),uni.showToast({title:"删除失败",icon:"none"})}var s}})},f=async()=>{try{if(!i.value)return void t("warn","at pages/reviewing/reviewing.vue:243","用户ID未找到，无法加载错题记录");t("log","at pages/reviewing/reviewing.vue:247","开始加载用户错题记录，用户ID:",i.value);const e=await(e=>b(`/mistake-records/user/${e}`,{method:"GET"}))(i.value);e&&e.data?(a.value=e.data.map((e=>({id:e.id,question:e.question.replace(" = ?",""),time:v(e.createdTime),correctAnswer:parseFloat(e.correctAnswer),corrected:"1"===e.corrected}))),t("log","at pages/reviewing/reviewing.vue:260","错题记录加载成功:",a.value)):(t("log","at pages/reviewing/reviewing.vue:262","没有获取到错题数据"),a.value=[])}catch(e){t("error","at pages/reviewing/reviewing.vue:266","加载错题数据失败:",e),uni.showToast({title:"数据加载失败",icon:"none"}),a.value=[]}},v=e=>{try{const t=new Date(e),o=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=t.getHours().toString().padStart(2,"0");return`${o}-${a}-${s} ${n}:${t.getMinutes().toString().padStart(2,"0")}`}catch(o){return t("error","at pages/reviewing/reviewing.vue:286","时间格式化失败:",o),e}};e.onMounted((async()=>{s.value=!0;try{i.value=p(),t("log","at pages/reviewing/reviewing.vue:310","获取到用户ID:",i.value),i.value?await f():(t("warn","at pages/reviewing/reviewing.vue:315","用户ID未找到，无法加载错题记录"),uni.showToast({title:"请先登录",icon:"none"}))}catch(e){t("error","at pages/reviewing/reviewing.vue:322","页面初始化失败:",e),uni.showToast({title:"页面加载失败",icon:"none"})}finally{s.value=!1}}));const y=e=>{const t=new URLSearchParams({grade:e.grade,questionCount:e.questionCount,timeLimit:e.timeLimit,practiceType:e.practiceType}).toString();uni.navigateTo({url:`/pages/practice/practice?${t}`})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"reviewing-container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"✗"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"√"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"∑"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"∫"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"∏")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"错题复习")]),e.createElementVNode("view",{class:"mistakes-section"},[s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-placeholder"},[e.createElementVNode("text",null,"加载中...")])):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(a.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"section-card",key:o},[e.createElementVNode("view",{class:e.normalizeClass(["mistake-item",{corrected:t.corrected}])},[e.createElementVNode("view",{class:"mistake-content",onClick:e=>t.corrected?g(o):((e,t)=>{e.corrected||(c.value=e,l.value=t,u.value="",d.value.open())})(t,o)},[e.createElementVNode("text",{class:"mistake-question"},e.toDisplayString(t.question)+" = ?",1),e.createElementVNode("view",{class:"mistake-meta"},[e.createElementVNode("text",{class:"mistake-time"},e.toDisplayString(t.time),1)])],8,["onClick"]),e.createElementVNode("view",{class:"mistake-actions"},[e.createVNode(r,{type:t.corrected?"checkmarkempty":"closeempty",color:t.corrected?"#48bb78":"#f56565",size:"24"},null,8,["type","color"])])],2)])))),128))]),e.createVNode(O,{ref_key:"mistakePopup",ref:d,type:"center"},{default:e.withCtx((()=>[c.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"popup-container"},[e.createElementVNode("view",{class:"popup-header"},[e.createElementVNode("text",{class:"popup-title"},"错题练习"),e.createVNode(r,{type:"closeempty",size:"24",color:"#999",onClick:h,class:"close-icon"})]),e.createElementVNode("view",{class:"popup-content"},[e.createElementVNode("view",{class:"question-display"},[e.createElementVNode("text",{class:"question-text"},e.toDisplayString(c.value.question)+" = ?",1)]),e.createElementVNode("view",{class:"answer-input-container"},[e.withDirectives(e.createElementVNode("input",{class:"answer-input",type:"number","onUpdate:modelValue":o[0]||(o[0]=e=>u.value=e),placeholder:"请输入答案",onConfirm:m},null,544),[[e.vModelText,u.value]])]),e.createElementVNode("view",{class:"popup-actions"},[e.createElementVNode("button",{class:"action-btn submit-btn",onClick:m},"提交答案")])])])):e.createCommentVNode("",!0)])),_:1},512),s.value||0!==a.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"暂无错题记录")])),e.createVNode($,{onShowPracticeSetup:o[1]||(o[1]=e=>n.value=!0)}),e.createVNode(F,{visible:n.value,onClose:o[2]||(o[2]=e=>n.value=!1),onConfirm:y},null,8,["visible"])]))}},as={__name:"import",setup(o){const a=e.ref([]),s=e.ref(!1),n=e.ref(null),i=e.ref(!1),c=e=>{if(!e)return"";try{const t=new Date(e),o=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${o}-${a}-${s} ${n}:${i}:${String(t.getSeconds()).padStart(2,"0")}`}catch(o){return t("error","at pages/import/import.vue:151","日期格式化失败:",o),String(e)}},l=async e=>{try{const o="csv"===e?[".csv"]:[".docx",".doc"];plus.io.chooseFile({title:"选择上传的文件",filetypes:o,multiple:!1,count:1},(async e=>{t("log","at pages/import/import.vue:556","App端选择文件成功:",e);try{if(!e||!e.files||0===e.files.length)throw new Error("未选择任何文件");const o=e.files[0];let a;if(t("log","at pages/import/import.vue:565","App端选择的文件路径:",o),uni.showLoading({title:"正在上传文件..."}),t("log","at pages/import/import.vue:572","App端开始调用uploadFileInApp接口上传文件"),t("log","at pages/import/import.vue:573","App端上传参数 - filePath:",o,"userId:",n.value),o.startsWith("content://")){t("log","at pages/import/import.vue:578","App端检测到Content URI，根据文件类型选择上传方法");o.toLowerCase().includes(".doc")?(t("log","at pages/import/import.vue:584","检测到Word文件，使用简化上传方法（避免复杂的二进制读取）"),a=await(async(e,o)=>{t("log","at pages/import/import.vue:493","=== 简化Word文件上传开始 ==="),t("log","at pages/import/import.vue:494","文件路径:",e);try{t("log","at pages/import/import.vue:498","使用Word测试数据进行上传（CSV格式）");const a="Word测试题目集,\n5+5,10\n6+6,12\n7+7,14\n8+8,16";t("log","at pages/import/import.vue:506","Word测试内容:",a);const s=btoa(unescape(encodeURIComponent(a)));t("log","at pages/import/import.vue:510","Word测试数据Base64转换成功，长度:",s.length);let n="word_test.csv";if(e.includes("/")){const t=e.split("/"),o=t[t.length-1];o&&o.includes(".doc")&&(n=decodeURIComponent(o).replace(/\.docx?$/i,".csv"))}t("log","at pages/import/import.vue:524","使用Word文件名:",n);const i=await N(s,n,o);return t("log","at pages/import/import.vue:528","简化Word上传响应:",i),i}catch(a){throw t("error","at pages/import/import.vue:533","简化Word上传失败:",a),a}})(o,n.value)):(t("log","at pages/import/import.vue:587","检测到CSV文件，使用文本上传方法"),a=await(async(e,o)=>{t("log","at pages/import/import.vue:272","=== 读取实际文件上传开始 ==="),t("log","at pages/import/import.vue:273","文件路径:",e);try{const s=plus.android.runtimeMainActivity(),n=plus.android.importClass("android.net.Uri"),i=plus.android.importClass("java.io.BufferedReader"),r=plus.android.importClass("java.io.InputStreamReader"),c=n.parse(e);t("log","at pages/import/import.vue:284","URI解析成功");const l=s.getContentResolver();t("log","at pages/import/import.vue:288","获取ContentResolver成功");const u=plus.android.invoke(l,"openInputStream",c);if(!u)throw new Error("无法打开文件输入流");t("log","at pages/import/import.vue:295","文件输入流打开成功");const d=new r(u,"UTF-8"),p=new i(d);t("log","at pages/import/import.vue:301","开始逐行读取文件内容");let h,m="",g=0;for(;null!==(h=plus.android.invoke(p,"readLine"));)if(g>0&&(m+="\n"),m+=h,g++,g%50==0&&t("log","at pages/import/import.vue:315",`已读取${g}行`),g>1e3){t("warn","at pages/import/import.vue:320","文件行数过多，截断到1000行");break}plus.android.invoke(p,"close"),plus.android.invoke(d,"close"),plus.android.invoke(u,"close"),t("log","at pages/import/import.vue:330",`文件读取完成，总共${g}行`),t("log","at pages/import/import.vue:331","文件内容长度:",m.length),t("log","at pages/import/import.vue:332","文件内容前200字符:",m.substring(0,200));const f=btoa(unescape(encodeURIComponent(m)));t("log","at pages/import/import.vue:336","Base64转换成功，长度:",f.length);let v="upload.csv";try{const e=plus.android.invoke(l,"query",c,null,null,null,null);if(e&&plus.android.invoke(e,"moveToFirst")){const t=plus.android.invoke(e,"getColumnIndex","_display_name");-1!==t&&(v=plus.android.invoke(e,"getString",t)),plus.android.invoke(e,"close")}}catch(a){t("warn","at pages/import/import.vue:350","获取文件名失败，使用默认名称:",a.message)}t("log","at pages/import/import.vue:353","使用文件名:",v),t("log","at pages/import/import.vue:354","开始调用uploadBase64File接口上传实际文件内容");const y=await N(f,v,o);return t("log","at pages/import/import.vue:358","实际文件上传响应:",y),y}catch(a){throw t("error","at pages/import/import.vue:363","读取实际文件失败:",a),a}})(o,n.value))}else a=await C(o,n.value);if(t("log","at pages/import/import.vue:593","App端文件上传API响应:",a),uni.hideLoading(),0===a.code){t("log","at pages/import/import.vue:598","App端文件上传成功");const e=a.data.questionCount||0;uni.showToast({title:`成功导入${e}道题目！`,icon:"success"}),await _()}else t("error","at pages/import/import.vue:608","App端文件上传API返回错误:",a.message),uni.showToast({title:a.message||"文件上传失败",icon:"none",duration:3e3})}catch(o){t("error","at pages/import/import.vue:617","App端文件上传处理失败:",o),uni.hideLoading(),uni.showToast({title:o.message||"文件上传失败，请重试",icon:"none",duration:3e3})}}),(e=>{t("error","at pages/import/import.vue:627","App端选择文件失败:",e),uni.showToast({title:"文件选择失败，请重试",icon:"none",duration:2e3})}))}catch(o){t("error","at pages/import/import.vue:700","文件处理失败:",o),uni.showToast({title:"文件处理失败",icon:"none"})}},u=()=>{uni.showActionSheet({itemList:["选择Word文档","选择CSV文件"],success:function(e){const o=e.tapIndex;t("log","at pages/import/import.vue:719",`用户选择了：${["选择Word文档","选择CSV文件"][o]}`),l(["word","csv"][o])}})},d=()=>{uni.showActionSheet({itemList:["下载CSV模板","下载Word模板"],success:function(e){const t=["question_template.csv","question_template.docx"][e.tapIndex],o=0===e.tapIndex;uni.showToast({title:`正在下载：${["下载CSV模板","下载Word模板"][e.tapIndex]}`,icon:"loading",duration:1e3}),h(t,o)}})},h=(e,o)=>{try{let a;t("log","at pages/import/import.vue:773","使用plus.io API下载模板到手机:",e),o?a="测试模板,\n1+1,2\n5+9,14\n(9-3)*2,12\n":(a="测试模板\n\n1+1 = 2\n5+9 = 14\n(9-3)*2 = 12\n",e=e.replace(".docx",".txt"));const s="\ufeff"+a;plus.io.requestFileSystem(plus.io.PUBLIC_DOCUMENTS,(o=>{o.root.getFile(e,{create:!0},(o=>{o.createWriter((a=>{a.onwriteend=()=>{t("log","at pages/import/import.vue:805","模板文件保存成功:",o.fullPath),uni.showToast({title:"模板下载完成！",icon:"success"}),setTimeout((()=>{uni.showModal({title:"下载完成",content:`模板下载成功！\n\n文件名：${e}\n保存位置：文件管理器 → Android → data → io.dcloud.HBuilder → documents\n\n请按照上述路径在文件管理器中查找文件`,showCancel:!0,cancelText:"我知道了",confirmText:"复制路径",success:e=>{e.confirm&&uni.setClipboardData({data:o.fullPath,success:()=>{uni.showToast({title:"路径已复制到剪贴板",icon:"success"})}})}})}),1e3)},a.onerror=e=>{t("error","at pages/import/import.vue:841","模板文件写入失败:",e),uni.showToast({title:"下载失败",icon:"none"})},a.write(s)}))}),(e=>{t("error","at pages/import/import.vue:852","创建模板文件失败:",e),uni.showToast({title:"下载失败",icon:"none"})}))}),(e=>{t("error","at pages/import/import.vue:859","请求文件系统失败:",e),uni.showToast({title:"下载失败",icon:"none"})}))}catch(a){t("error","at pages/import/import.vue:867","下载模板失败:",a),uni.showToast({title:"下载失败",icon:"none"})}},m=(e,o,a)=>{try{t("log","at pages/import/import.vue:979",`开始导出${a}文件到手机:`,e),t("log","at pages/import/import.vue:982","使用plus.io API保存导出文件"),((e,o,a)=>{t("log","at pages/import/import.vue:879",`使用plus.io导出${a}文件:`,e);const s="CSV"===a?"\ufeff"+o:o;plus.io.requestFileSystem(plus.io.PUBLIC_DOCUMENTS,(o=>{o.root.getFile(e,{create:!0},(o=>{o.createWriter((n=>{n.onwriteend=()=>{o.file((n=>{t("log","at pages/import/import.vue:892",`${a}文件验证结果:`,{path:o.fullPath,size:n.size,expectedSize:s.length}),n.size>0?(t("log","at pages/import/import.vue:899",`${a}文件导出成功:`,o.fullPath),uni.showToast({title:`${a}导出成功！`,icon:"success"}),setTimeout((()=>{uni.showModal({title:"导出完成",content:`文件导出成功！\n                  \n文件名：${e}\n文件大小：${n.size} 字节\n保存位置：文件管理器 → Android → data → io.xanfro.everymath → documents\n\n请按照上述路径在文件管理器中查找文件`,showCancel:!0,cancelText:"我知道了",confirmText:"复制路径",success:e=>{e.confirm&&uni.setClipboardData({data:o.fullPath,success:()=>{uni.showToast({title:"路径已复制到剪贴板",icon:"success"})}})}})}),1e3)):(t("error","at pages/import/import.vue:934",`${a}文件导出失败: 文件大小为0`),uni.showToast({title:"导出失败：文件为空",icon:"none"}))}),(e=>{t("error","at pages/import/import.vue:941","验证文件失败:",e),uni.showToast({title:"导出状态未知",icon:"none"})}))},n.onerror=e=>{t("error","at pages/import/import.vue:950","文件写入失败:",e),uni.showToast({title:"导出失败",icon:"none"})},n.write(s)}))}),(e=>{t("error","at pages/import/import.vue:961","创建文件失败:",e),uni.showToast({title:"导出失败",icon:"none"})}))}),(e=>{t("error","at pages/import/import.vue:968","请求文件系统失败:",e),uni.showToast({title:"导出失败",icon:"none"})}))})(e,o,a)}catch(s){t("error","at pages/import/import.vue:986",`导出${a}文件失败:`,s),uni.showToast({title:"导出失败",icon:"none"})}},g=e=>{const t=[e];for(;t.length<4;){const o=Math.floor(3*Math.random())+1,a=e+(Math.random()>.5?1:-1)*o;a>0&&!t.includes(a)&&t.push(a)}for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},f=e=>{if(!e)return"";let t=String(e);return(t.includes(",")||t.includes('"')||t.includes("\n")||t.includes("\r"))&&(t=t.replace(/"/g,'""'),t=`"${t}"`),t},v=async e=>{try{t("log","at pages/import/import.vue:1176","开始导出CSV，习题集ID:",e.id),uni.showLoading({title:"加载题目中..."});const o=await S(e.id);if(t("log","at pages/import/import.vue:1184","导出题目数据API响应:",o),0!==o.code||!o.data||0===o.data.length)return uni.hideLoading(),void uni.showToast({title:"暂无题目数据",icon:"none"});let a=`${e.name},\n`;o.data.forEach((e=>{const t=f(e.question),o=f(e.answer);a+=`${t},${o}\n`})),uni.hideLoading();const s=`${e.name}_${(new Date).toLocaleDateString().replace(/\//g,"-")}.csv`;uni.showToast({title:"正在导出CSV文件...",icon:"loading",duration:2e3}),m(s,a,"CSV")}catch(o){t("error","at pages/import/import.vue:1272","导出CSV失败:",o),uni.hideLoading(),uni.showToast({title:"CSV导出失败",icon:"none"})}},y=async e=>{try{t("log","at pages/import/import.vue:1284","开始导出Word，习题集ID:",e.id),uni.showLoading({title:"加载题目中..."});const o=await S(e.id);if(t("log","at pages/import/import.vue:1292","导出题目数据API响应:",o),0!==o.code||!o.data||0===o.data.length)return uni.hideLoading(),void uni.showToast({title:"暂无题目数据",icon:"none"});let a=`${e.name}\n`;o.data.forEach((e=>{a+=`${e.question} = ${e.answer}\n`})),uni.hideLoading();const s=`${e.name}_${(new Date).toLocaleDateString().replace(/\//g,"-")}.txt`;uni.showToast({title:"正在导出Word文档...",icon:"loading",duration:2e3}),m(s,a,"Word")}catch(o){t("error","at pages/import/import.vue:1383","导出Word失败:",o),uni.hideLoading(),uni.showToast({title:"Word导出失败",icon:"none"})}},w=async e=>{const o=a.value[e];uni.showModal({title:"确认删除",content:`确定要删除题目集"${o.name}"吗？`,success:async function(s){if(s.confirm)try{t("log","at pages/import/import.vue:1401","开始删除习题集:",o.id);const s=await(n=o.id,b(`/question-sets/${n}`,{method:"DELETE"}));t("log","at pages/import/import.vue:1404","删除习题集API响应:",s),0===s.code?(a.value.splice(e,1),uni.showToast({title:"删除成功",icon:"success"})):(t("error","at pages/import/import.vue:1415","删除习题集API返回错误:",s.message),uni.showToast({title:s.message||"删除失败",icon:"none"}))}catch(i){t("error","at pages/import/import.vue:1422","删除题目集失败:",i),uni.showToast({title:"删除失败",icon:"none"})}var n}})},_=async()=>{try{if(!n.value)return void t("error","at pages/import/import.vue:1437","用户ID不存在");t("log","at pages/import/import.vue:1441","开始加载习题集数据，用户ID:",n.value);const e=await(e=>b(`/question-sets/user/${e}`,{method:"GET"}))(n.value);t("log","at pages/import/import.vue:1444","习题集API响应:",e),0===e.code&&e.data?(a.value=e.data.map((e=>({id:e.id,name:e.name,importTime:c(e.createdTime||e.importTime),questionCount:parseInt(e.questionCount)||0,questions:[]}))),t("log","at pages/import/import.vue:1456","习题集数据加载成功:",a.value)):(t("error","at pages/import/import.vue:1458","习题集API返回错误:",e.message),a.value=[])}catch(e){t("error","at pages/import/import.vue:1462","加载题目集数据失败:",e),uni.showToast({title:"数据加载失败",icon:"none"}),a.value=[]}};e.onMounted((async()=>{s.value=!0;try{n.value=p(),t("log","at pages/import/import.vue:1479","获取到用户ID:",n.value),n.value?await _():(t("error","at pages/import/import.vue:1484","用户ID不存在，请先登录"),uni.showToast({title:"请先登录",icon:"none"}))}catch(e){t("error","at pages/import/import.vue:1491","页面初始化失败:",e)}finally{s.value=!1}}));const k=e=>{const t=new URLSearchParams({grade:e.grade,questionCount:e.questionCount,timeLimit:e.timeLimit,practiceType:e.practiceType}).toString();uni.navigateTo({url:`/pages/practice/practice?${t}`})};return(o,n)=>(e.openBlock(),e.createElementBlock("view",{class:"import-container"},[e.createElementVNode("view",{class:"bg-elements"},[e.createElementVNode("view",{class:"math-symbol",style:{top:"5%",left:"5%",animationDelay:"0s"}},"+"),e.createElementVNode("view",{class:"math-symbol",style:{top:"70%",left:"10%",animationDelay:"0.5s"}},"-"),e.createElementVNode("view",{class:"math-symbol",style:{top:"30%",left:"20%",animationDelay:"1s"}},"×"),e.createElementVNode("view",{class:"math-symbol",style:{top:"50%",left:"80%",animationDelay:"1.5s"}},"÷"),e.createElementVNode("view",{class:"math-symbol",style:{top:"15%",left:"70%",animationDelay:"2s"}},"+")]),e.createElementVNode("view",{class:"navbar"},[e.createElementVNode("text",{class:"navbar-title"},"导入导出")]),e.createElementVNode("view",{class:"import-section"},[e.createElementVNode("view",{class:"section-background"},[e.createElementVNode("view",{class:"section-title"},"习题导入"),e.createElementVNode("view",{class:"import-actions"},[e.createElementVNode("view",{class:"action-card",onClick:u},[e.createElementVNode("view",{class:"action-icon"},[e.createVNode(r,{type:"upload",size:"36",color:"#4299e1"})]),e.createElementVNode("view",{class:"action-content"},[e.createElementVNode("text",{class:"action-title"},"上传文件"),e.createElementVNode("text",{class:"action-desc"},"支持Word或CSV格式")]),e.createElementVNode("view",{class:"action-arrow"},[e.createVNode(r,{type:"arrowright",size:"20",color:"#999"})])]),e.createElementVNode("view",{class:"action-card",onClick:d},[e.createElementVNode("view",{class:"action-icon"},[e.createVNode(r,{type:"download",size:"36",color:"#48bb78"})]),e.createElementVNode("view",{class:"action-content"},[e.createElementVNode("text",{class:"action-title"},"下载模板"),e.createElementVNode("text",{class:"action-desc"},"获取题目格式模板")]),e.createElementVNode("view",{class:"action-arrow"},[e.createVNode(r,{type:"arrowright",size:"20",color:"#999"})])])])])]),e.createElementVNode("view",{class:"import-list-section"},[e.createElementVNode("view",{class:"section-background"},[e.createElementVNode("view",{class:"section-title"},"导入习题列表"),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-placeholder"},[e.createElementVNode("text",null,"加载中...")])):a.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:1,class:"import-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((o,s)=>(e.openBlock(),e.createElementBlock("view",{class:"question-item",key:s},[e.createElementVNode("view",{class:"delete-btn-corner",onClick:e=>w(s)},[e.createVNode(r,{type:"closeempty",size:"16",color:"#999"})],8,["onClick"]),e.createElementVNode("view",{class:"question-content"},[e.createElementVNode("view",{class:"question-header"},[e.createElementVNode("text",{class:"question-title"},e.toDisplayString(o.name),1),e.createElementVNode("view",{class:"preview-btn",onClick:e=>(async(e,o)=>{try{t("log","at pages/import/import.vue:1086","开始加载题目详情:",e.id),uni.showLoading({title:"加载中..."});const o=await S(e.id);if(t("log","at pages/import/import.vue:1093","题目列表API响应:",o),uni.hideLoading(),0===o.code&&o.data&&o.data.length>0){let e="";o.data.forEach(((t,o)=>{e+=`${o+1}. ${t.question} = ${t.answer}\n`})),uni.showModal({title:"题目详情",content:e,showCancel:!1,confirmText:"确定"})}else uni.showToast({title:"暂无题目数据",icon:"none"})}catch(a){t("error","at pages/import/import.vue:1117","加载题目详情失败:",a),uni.hideLoading(),uni.showToast({title:"加载失败",icon:"none"})}})(o)},[e.createVNode(r,{type:"eye",size:"14",color:"#666"})],8,["onClick"])]),e.createElementVNode("view",{class:"question-meta"},[e.createElementVNode("text",{class:"question-time"},e.toDisplayString(o.importTime),1),e.createElementVNode("view",{class:"question-count"},e.toDisplayString(o.questionCount)+"题 ",1)])]),e.createElementVNode("view",{class:"question-actions"},[e.createElementVNode("view",{class:"action-btn practice-btn",onClick:e=>(async(e,o)=>{try{t("log","at pages/import/import.vue:998","开始练习，习题集ID:",e.id),uni.showLoading({title:"加载题目中..."});const o=await S(e.id);if(t("log","at pages/import/import.vue:1006","题目数据API响应:",o),uni.hideLoading(),0!==o.code||!o.data||0===o.data.length)return void uni.showToast({title:"暂无题目数据",icon:"none"});const a=o.data.map(((e,t)=>{const o=e.question,a=parseFloat(e.answer),s=g(a);return{question:o,options:s,correctAnswer:s.indexOf(a),difficulty:a>50?2:a>100?3:1,userAnswer:-1,answered:!1}}));t("log","at pages/import/import.vue:1037","转换后的练习题目:",a),uni.setStorageSync("practiceQuestions",a),uni.setStorageSync("practiceTitle",e.name),uni.setStorageSync("practiceTimeLimit",300),uni.navigateTo({url:"/pages/practice/practice?fromImport=true"})}catch(a){t("error","at pages/import/import.vue:1050","加载练习题目失败:",a),uni.hideLoading(),uni.showToast({title:"加载失败",icon:"none"})}})(o)},[e.createVNode(r,{type:"paperplane-filled",size:"16",color:"#007bff"})],8,["onClick"]),e.createElementVNode("view",{class:"action-btn export-btn",onClick:e=>(async(e,o)=>{try{uni.showActionSheet({itemList:["导出为CSV文件","导出为Word文档"],success:async function(o){const a=["csv","word"][o.tapIndex];t("log","at pages/import/import.vue:1154",`用户选择导出格式：${a}`),"csv"===a?await v(e):await y(e)}})}catch(a){t("error","at pages/import/import.vue:1165","导出题目集失败:",a),uni.showToast({title:"导出失败",icon:"none"})}})(o)},[e.createVNode(r,{type:"redo-filled",size:"16",color:"#ff9500"})],8,["onClick"])]),s<a.value.length-1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"question-divider"})):e.createCommentVNode("",!0)])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"empty-state"},[e.createVNode(r,{type:"list",size:"48",color:"#CBD5E0"}),e.createElementVNode("text",{class:"empty-text"},"暂无导入题目"),e.createElementVNode("text",{class:"empty-desc"},"请先上传文件导入题目")]))])]),e.createVNode($,{onShowPracticeSetup:n[0]||(n[0]=e=>i.value=!0)}),e.createVNode(F,{visible:i.value,onClose:n[1]||(n[1]=e=>i.value=!1),onConfirm:k},null,8,["visible"])]))}},ss=n(as,[["__scopeId","data-v-6929b99e"]]);__definePage("pages/login/login",T),__definePage("pages/register/register",V),__definePage("pages/practice/practice",M),__definePage("pages/home/home",q),__definePage("pages/profile/profile",U),__definePage("pages/analysis/analysis",es),__definePage("pages/result/result",ts),__definePage("pages/reviewing/reviewing",os),__definePage("pages/import/import",ss);const ns={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:is,Vuex:rs,Pinia:cs}={app:e.createVueApp(ns)};uni.Vuex=rs,uni.Pinia=cs,is.provide("__globalStyles",__uniConfig.styles),is._component.mpType="app",is._component.render=()=>{},is.mount("#app")}(Vue);
